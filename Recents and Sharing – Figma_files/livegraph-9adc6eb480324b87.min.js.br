"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="2c2371d7-7c61-5662-81ef-e1f02ddaff26")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[8515],{209411:(e,t,i)=>{i.d(t,{sG:()=>a,np:()=>l,wy:()=>n.wy,V_:()=>r.Z,wh:()=>n.wh});var s=i(844784);i(879978);var n=i(924620),r=i(266515),o=i(656762);class a{constructor(e,t){for(let i in this.views=new Map,e)this.views.set(i,new o.Z(i,e[i],t.objects.get("root"),t,{shouldValidateDeprecated:!0,shouldUseMissingFields:!1}))}get(e){return this.views.get(e)||null}}i(230596);class l extends s.Z{optimisticallyCreate(e,t){return this.applyMutations(e,t,"create")}optimisticallyUpdate(e,t){return this.applyMutations(e,t,"update")}optimisticallyDelete(e,t){return this.applyMutations(e,t,"delete")}optimisticallyCreateWithUUID(e,t){return this.applyMutationsWithUUID(e,t,"create")}optimisticallyUpdateWithUUID(e,t){return this.applyMutationsWithUUID(e,t,"update")}optimisticallyDeleteWithUUID(e,t){return this.applyMutationsWithUUID(e,t,"delete")}getIdFromUuid(e,t){return super.getIdFromUuid(e,t)}deprecatedOptimisticallyCreateByView(e,t,i){return this.deprecatedApplyMutationsByView(e,t,i,"create")}deprecatedOptimisticallyUpdateByView(e,t,i){return this.deprecatedApplyMutationsByView(e,t,i,"update")}deprecatedOptimisticallyDeleteByView(e,t,i){return this.deprecatedApplyMutationsByView(e,t,i,"delete")}}},281374:(e,t,i)=>{i.d(t,{_:()=>s._,bm:()=>s.bm,jt:()=>s.jt,lj:()=>s.lj,nP:()=>s.nP,qm:()=>s.qm,tn:()=>s.tn}),i(266515);var s=i(730629)},84057:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(395409),n=i(31e3);class r{constructor(e){this.client=e,this.stableArgs=new Map,this.inputArgsToStableArgs=new WeakMap,this.subscriptions=new Map}recomputeViewResult(e,t){let i=e.map(e=>{var t,i;let n=this.getStableArgs(e),r={args:n,result:this.subscriptions.get(n)&&(null==(t=this.subscriptions.get(n))?void 0:t.lastResult)?null==(i=this.subscriptions.get(n))?void 0:i.lastResult:s.br};return r});t(i)}getStableArgs(e){if(this.inputArgsToStableArgs.has(e))return this.inputArgsToStableArgs.get(e);let t=(0,n.h)(e),i=this.stableArgs.get(t);return i?(this.inputArgsToStableArgs.set(e,i),i):(this.stableArgs.set(t,e),e)}unsubscribeStaleSubscriptions(e){let t=new Set;for(let i of e)t.add(this.getStableArgs(i));for(let e of this.subscriptions.keys())t.has(e)||(this.client.getUnsubscribeFunction(this.subscriptions.get(e))(),this.subscriptions.delete(e))}clearSubscriptions(){for(let e of this.subscriptions.values())this.client.getUnsubscribeFunction(e)();this.subscriptions.clear()}}},844784:(e,t,i)=>{i.d(t,{S:()=>f,Z:()=>p});var s,n=i(924620),r=i(879978),o=i(230596);class a{constructor(){this.listeners=new Set}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}emit(e){this.listeners.forEach(t=>{try{t(e)}catch(e){console.error(e)}})}}let l=["AWSALBTG","AWSALBTGCORS","AWSALB","AWSALBCORS"],d={backoffInitialMs:250,backoffMaxMs:12e4,backoffMultiplier:2,spreadMultiplier:.3};class u{constructor(e,t,i,s,n={}){this.url=e,this.wsImpl=t,this.args=i,this.emitter=s,this.clientOptions=n,this.ws=null,this.state={type:"disconnected"},this.backoff=new o.FP(d),this.onCloseResolve=null,this.alreadyConnectedOnce=!1,this.reconnectTimeout=null,this.inactivityDisconnect=null,this.preventReconnectForDebugging=!1,this.preventAutoReconnectOnNextClose=!1,this.connectionCount=0,this.observers=new Set,this.visibilityChange=()=>{var e;(null==(e=this.clientOptions.document)?void 0:e.visibilityState)==="visible"?(this.clearInactivityDisconnect(),this.connect()):this.scheduleInactivityDisconnect()},this._lastAckTime=new Date(0),n.document&&n.document.addEventListener("visibilitychange",this.visibilityChange),this.registerPingInterval()}cleanup(){this.clientOptions.document&&this.clientOptions.document.removeEventListener("visibilitychange",this.visibilityChange),this.clearInactivityDisconnect(),this.closeWithoutReconnecting()}registerPingInterval(){setInterval(()=>{this.ready()&&this.send({messageType:"ping"})},this.getIntervalWithJitter())}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}get debug(){return{disconnect:()=>{this.preventReconnectForDebugging=!0,this.ws&&this.ws.close(1e3,"for-testing")},reconnect:()=>{this.preventReconnectForDebugging=!1,this.connect()},sendPingNow:()=>{this.sendPingNow()}}}async connect(){var e;let[t,i]=(0,o.uy)(),s=!1,r=this.alreadyConnectedOnce,a=(null==(e=this.clientOptions.document)?void 0:e.visibilityState)==="hidden"&&r;if(this.preventReconnectForDebugging||a||"connected"===this.state.type||"connecting"===this.state.type)return"skipped";this.clearReconnect(),this.ws=this.wsImpl(this.url),this.setConnectionState({type:"connecting"});let d=this.ws;return this.ws.onopen=async()=>{var e,t,n,r,a;let l=this.ws;if((0,o.jx)(d===l,"Current websocket is different from newly-opened websocket"),(0,o.hu)(null!==this.ws,"websocket should be non-null"),(null==(e=this.ws)?void 0:e.readyState)!==(null==(t=this.ws)?void 0:t.OPEN))return;this.setConnectionState({type:"connected",authenticated:!1,count:this.backoff.attemptsSoFar()}),i("success"),s=!0;let u=(null==(n=this.clientOptions.tags)?void 0:n.clientType)||"unknown",h={...this.clientOptions.tags,...(null==(r=this.clientOptions.document)?void 0:r.URL)&&{clientUrl:null==(a=this.clientOptions.document)?void 0:a.URL}};this.connectionCount+=1;let c={messageType:"auth",clientType:u,args:this.args,tags:h};for(let e of(this.emitter.emit({type:"REQUEST_MESSAGE",message:c}),this.ws.send(JSON.stringify(c)),this.observers))e.onConnectionOpen()},this.ws.onclose=e=>{var t;if(this.setConnectionState({type:"disconnected"}),this.emitter.emit({type:"CONNECTION_CLOSED",url:this.url,closeEvent:e}),4001===e.code&&"object"==typeof document)for(let e of l)document.cookie=`${e}=; max-age=-1; path=/;`;if(s||i("failure"),null==(t=this.onCloseResolve)||t.call(this),this.preventAutoReconnectOnNextClose){this.preventAutoReconnectOnNextClose=!1;return}this.reconnectTimeout||(this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=null,this.connect()},this.backoff.nextBackoffMs()))},this.ws.onerror=e=>{this.emitter.emit({type:"ERROR",error:e})},this.ws.onmessage=({data:e})=>{var t,i,s;let r=JSON.parse(e);if(r){switch(this.emitter.emit({type:"RESPONSE_MESSAGE",message:r}),r.messageType){case"authSuccess":this.setConnectionState({type:"connected",authenticated:!0,count:this.backoff.attemptsSoFar()}),this.backoff.reset();break;case"authFail":this.emitter.emit({type:"ERROR",error:new n.l4}),this.setConnectionState({type:"error",errorType:"authFail"}),this.closeWithoutReconnecting();break;case"ack":this._lastAckTime=new Date;break;case"requestError":this.setConnectionState({type:"error",errorType:"requestError"}),null==(t=this.ws)||t.close();break;case"requestBeforeAuth":this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg=!1,this.setConnectionState({type:"error",errorType:"requestBeforeAuth"}),null==(i=this.ws)||i.close();break;case"serverError":this.setConnectionState({type:"error",errorType:"serverError"}),null==(s=this.ws)||s.close()}for(let e of this.observers)e.handleMessage(r)}},t}clearReconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}async closeWithoutReconnecting(){var e,t;let[i,s]=(0,o.uy)();this.onCloseResolve=s,this.clearReconnect(),this.preventAutoReconnectOnNextClose=!0,null!==this.ws&&(null==(e=this.ws)?void 0:e.readyState)!==(null==(t=this.ws)?void 0:t.CLOSED)&&(this.ws.close(),await i)}async reconnect(){return this.preventAutoReconnectOnNextClose=!1,this.connect()}getIntervalWithJitter(){return 3e4+(Math.random()-.5)*5e3}ready(){var e,t;return"connected"===this.state.type&&!!this.ws&&(null==(e=this.ws)?void 0:e.readyState)===(null==(t=this.ws)?void 0:t.OPEN)&&(this.state.authenticated||!!this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg)}send(e){this.ready()?(this.emitter.emit({type:"REQUEST_MESSAGE",message:e}),this.ws.send(JSON.stringify(e))):(0,o.jx)(!1,`ClientConnection.send called with message type ${e.messageType} while in non-ready state`)}sendPingNow(){this.ready()&&this.send({messageType:"ping"})}getConnectionCount(){return this.connectionCount}getLastAckTime(){return this._lastAckTime}scheduleInactivityDisconnect(){this.inactivityDisconnect=setTimeout(()=>{this.closeWithoutReconnecting()},36e5)}clearInactivityDisconnect(){this.inactivityDisconnect&&(clearTimeout(this.inactivityDisconnect),this.inactivityDisconnect=null)}setConnectionState(e){"connected"===e.type&&(this.alreadyConnectedOnce=!0),this.state=e,this.emitter.emit({type:"CONNECTION_STATE",state:e,url:this.url})}getState(){return this.state}isReconnectScheduled(){return"disconnected"===this.state.type&&null!==this.reconnectTimeout}getBackoff(){return this.backoff}}var h=i(769183),c=i(415289),f=((s=f||{})[s.CONNECTED=0]="CONNECTED",s[s.DISCONNECTED=1]="DISCONNECTED",s[s.RECONNECTING=2]="RECONNECTING",s);class p{constructor(e,t,i,s,n,o={}){if(this.args=e,this.viewRegistry=i,this.clientOptions=o,this.transactionId=1,this.syncDelayForDebugging=0,this.syncQueryIds=new Map,this.syncCallbacks=new Map,this.pendingGlobalOptimisticUpdates=new Set,this.globalOptimisticUpdateResolutionCallbacks=[],this.emitter=new a,this.healthListeners=new Set,this.pendingOptimisticMutationList=[],this.pendingMutationList=[],this.initialSubscriptionMsgBuffer=[],this.session=new r.Z(e,t,i,this.emitter,(e,t)=>{this.requestPaginationChange(e,t)},o.enableCrossViewIncompleteInstanceCheck),this.connection=new u(s,n,e,this.emitter,o),this.connection.addObserver(this),this.addEventListener(this.healthListener.bind(this)),!o.preloadedViews||!o.preloadedViewArgs)return;for(let e=0;e<(o.preloadedViews.length??0);e++)this.session.subscribe(o.preloadedViews[e],o.preloadedViewArgs[e],()=>{})}cleanup(){this.connection.cleanup()}async connect(){await this.connection.connect()}async close(){await this.connection.closeWithoutReconnecting()}addEventListener(e){return this.emitter.addListener(e)}removeEventListener(e){return this.emitter.removeListener(e)}healthListener(e){if("CONNECTION_STATE"===e.type){let t=this.getHealthStatusForConnectionState(e.state);for(let e of this.healthListeners)e(t)}}getHealthStatus(){return this.getHealthStatusForConnectionState(this.connection.getState())}getHealthStatusForConnectionState(e){return"connected"===e.type?0:"connecting"===e.type?2:1}addHealthListener(e){return this.healthListeners.add(e),()=>this.removeHealthListener(e)}removeHealthListener(e){this.healthListeners.delete(e)}handleMessage(e){switch(e.messageType){case"authSuccess":if(this.args.sessionId=e.sessionId,!this.connection.ready()){(0,o.jx)(!1,"Expected connection to be in ready state");break}let t=1===this.connection.getConnectionCount();if(this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg&&t)break;for(let{viewRef:e,args:i,traceId:s}of(this.session.startReconnectionStateForPaginationQueries(),this.session.uniqueSubscriptions()))this.requestSubscription(e,i,t?"initial_load":"refresh",s);for(let e of(this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg&&(this.initialSubscriptionMsgBuffer=[]),this.syncCallbacks.keys()))this.requestSync(e,this.syncQueryIds.get(e));break;case"pendingMutations":this.hasUnresolvedGlobalOptimisticUpdates()?(this.globalOptimisticUpdateResolutionCallbacks.push(()=>{this.session.applyMutations(e.mutations)}),this.pendingMutationList.push(e.mutations),this.session.resolvePendingServerIdList(e.mutations)):this.session.applyMutations(e.mutations);break;case"synced":let i=this.syncCallbacks.get(e.transactionId);i&&i();break;case"viewSubscriptionFailed":this.emitter.emit({type:"ERROR",error:new n.Q7(e.errorCode)}),this.session.cleanupFailedSubscribeView(e.liveViewKey)}}onConnectionOpen(){if(this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg){for(let e of this.initialSubscriptionMsgBuffer)this.requestSubscription(e.view,e.args,e.loadType,e.traceId);this.initialSubscriptionMsgBuffer=[]}}requestSubscription(e,t,i,s){let n={messageType:"subscribe",viewName:e._name,viewHash:e._hash,loadType:i,args:t,traceId:s};if(this.connection.ready())this.connection.send(n),this.emitter.emit({type:"SUBSCRIBE_VIEW_SERVER",view:e,args:t,traceId:s});else{let n=0===this.connection.getConnectionCount();this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg&&n&&this.initialSubscriptionMsgBuffer.push({view:e,args:t,loadType:i,traceId:s})}}requestPaginationChange(e,t){this.connection.ready()&&this.connection.send({messageType:"paginationChangeMessage",operationType:"LoadNext",queryId:e,count:t})}subscribeAndUnsubscribeInBatches(e,t,i,s){for(let n of(i.unsubscribeStaleSubscriptions(t),t)){let r=i.getStableArgs(n);if(i.subscriptions.has(r))continue;let o=this.subscribeBase(e,r,e=>{o.lastResult=e,i.recomputeViewResult(t,s)});i.subscriptions.set(r,o)}i.recomputeViewResult(t,s)}subscribeBase(e,t,i,s){let n=this.session.hasActiveSubscriptions(e._name,t),r=this.session.subscribe(e,t,i,s);return n||(this.emitter.emit({type:"SUBSCRIBE_VIEW_CLIENT",view:e,args:t,traceId:s}),this.requestSubscription(e,t,"initial_load",s)),r}getUnsubscribeFunction(e){return()=>{e.clientUnsubscribed=!0,(0,o.TM)(()=>{e.unsubscribe(),!this.session.hasActiveSubscriptions(e.view._name,e.args)&&this.connection.ready()&&(this.connection.send({messageType:"unsubscribe",viewName:e.view._name,args:e.args}),this.emitter.emit({type:"UNSUBSCRIBE_VIEW_SERVER",view:e.view,args:e.args}))},2e3)}}subscribe(e,t,i,s){var n;let r=t;(null==(n=this.viewRegistry.get(e._name))?void 0:n.hasStaticQueries())&&(r={...t,__requestId:(0,h.Z)()});let o=this.subscribeBase(e,r,i,s);return this.getUnsubscribeFunction(o)}hasUnresolvedGlobalOptimisticUpdates(){return this.pendingGlobalOptimisticUpdates.size>0}handleBeforeOptimisticUpdateApplied(e){this.pendingGlobalOptimisticUpdates.add(e)}handleAfterOptimisticUpdateResolved(e){if(this.pendingGlobalOptimisticUpdates.delete(e),!this.hasUnresolvedGlobalOptimisticUpdates()){let e=this.globalOptimisticUpdateResolutionCallbacks;this.globalOptimisticUpdateResolutionCallbacks=[],this.emitter.emit({type:"MUTATIONS_BLOCKED_ON_OPTIMISTIC_UPDATE",count:e.length}),this.session.batchMutations(()=>{for(let t of e)t()}),this.checkMissingMutations()}}checkUUIDExistenceInPendingMutation(e,t){for(let i of t)for(let t in i)for(let s in i[t].instances){let n=i[t].instances[s];if(e===n.uuid)return!0}return!1}checkMissingMutations(){for(let e of this.pendingOptimisticMutationList)for(let t in e)for(let i in e[t]){let s=e[t][i];(null==s?void 0:s.uuid)&&(this.checkUUIDExistenceInPendingMutation(s.uuid,this.pendingMutationList)?this.emitter.emit({type:"PENDING_MUTATION_EXISTENCE",exist:!0,objectName:t,optimisticInstance:s}):this.emitter.emit({type:"PENDING_MUTATION_EXISTENCE",exist:!1,objectName:t,optimisticInstance:s}))}this.pendingOptimisticMutationList=[],this.pendingMutationList=[]}async applyMutations(e,t,i){let s;let n=this.transactionId;this.transactionId++;let r=this.session.applyShadowMutations(n,e,i);this.handleBeforeOptimisticUpdateApplied(n);try{s=await t}catch(t){throw this.session.removeShadowMutations(n,e,!1),this.handleAfterOptimisticUpdateResolved(n),t}let o=!1;try{await this.sync(n,r),o=!0}finally{this.pendingOptimisticMutationList.push(e),this.globalOptimisticUpdateResolutionCallbacks.push(()=>{this.session.removeShadowMutations(n,e,o)}),this.handleAfterOptimisticUpdateResolved(n)}return s}waitForServerSideObjectsWithUUIDs(e){let t=[];for(let i in e)for(let s in e[i])t.push(this.getIdFromUuid(i,s));return Promise.all(t)}async applyMutationsWithUUID(e,t,i){let s;let n=this.transactionId;this.transactionId++;let r=this.session.applyShadowMutationsWithUUID(n,e,i);this.handleBeforeOptimisticUpdateApplied(n);try{s=await t}catch(t){throw this.session.removeShadowMutationsWithUUID(n,e,!1),this.handleAfterOptimisticUpdateResolved(n),t}let a=!1;try{"create"===i?(this.emitter.emit({type:"WAIT_SERVER_OBJECTS_STARTED",mutations:e}),await this.waitForServerSideObjectsWithUUIDs(e),await (0,o._v)(this.syncDelayForDebugging),this.emitter.emit({type:"WAIT_SERVER_OBJECTS_ENDED",mutations:e})):await this.sync(n,r),a=!0}finally{this.pendingOptimisticMutationList.push(e),this.globalOptimisticUpdateResolutionCallbacks.unshift(()=>{this.session.removeShadowMutationsWithUUID(n,e,a)}),this.handleAfterOptimisticUpdateResolved(n)}return s}getIdFromUuid(e,t){return this.session.getIdFromUuid(e,t)}async deprecatedApplyMutationsByView(e,t,i,s){let n;let r=this.transactionId;this.transactionId++,this.session.applyShadowMutationsByView(e._name,r,t,s);try{n=await i}catch(i){throw this.session.removeShadowMutationsByView(e._name,r,t,!1),i}let o=!1;try{let e=[];for(let i of this.session.getAllQueryIds()){let s=(0,c.Q)(this.session.schema,i);s.name in t&&e.push(i)}await this.sync(r,e),o=!0}finally{this.session.removeShadowMutationsByView(e._name,r,t,o)}return n}requestSync(e,t){this.connection.ready()&&(this.connection.send({messageType:"sync",transactionId:e,queryIds:t}),this.emitter.emit({type:"SYNC_STARTED",transactionId:e}))}async sync(e=this.transactionId++,t){let[i,s]=(0,o.uy)();this.syncCallbacks.set(e,s),void 0!==t&&this.syncQueryIds.set(e,t),this.requestSync(e,t),await i,this.syncDelayForDebugging&&await (0,o._v)(this.syncDelayForDebugging),this.syncCallbacks.delete(e),this.syncQueryIds.delete(e),this.emitter.emit({type:"SYNC_COMPLETED",transactionId:e})}get debug(){return{subscriptions:this.session.getViewSubscriptionsForDebugging(),prettyPrintLiveViewTree:e=>this.session.prettyPrintLiveViewTree(e),setOptimisticUpdateResolutionDelay:e=>this.syncDelayForDebugging=e,...this.connection.debug}}}},879978:(e,t,i)=>{i.d(t,{Z:()=>D});var s=i(230596),n=i(666110);class r{constructor(e,t){this.key=e,this.value=t}orInsert(){return this.value}orInsertWith(){return this.value}andModify(e){return e(this.value),this}}class o{constructor(e,t){this.key=e,this.map=t}orInsert(e){return this.map.set(this.key,e),e}orInsertWith(e){return this.orInsert(e())}andModify(){return this}}class a extends Map{entry(e){return this.has(e)?new r(e,this.get(e)):new o(e,this)}}class l extends r{orDefault(){return this.value}}class d extends o{orDefault(){return this.orInsert(this.map.default(this.key))}}class u extends Map{constructor(e,t){super(t),this.default=e}entry(e){return this.has(e)?new l(e,this.get(e)):new d(e,this)}}class h{constructor(e,t){this.serverId=null,this.shadowMutations=new Set,this.shadowQueries=new Set,this.serverQueries=new Set,this.serverIdResolveList=[],this.serverFields=e,this.shadowFields=e,t||(this.serverId=e.id)}fields(){return 0===this.shadowMutations.size?this.serverFields:this.shadowFields}dependentQueries(){return 0===this.shadowMutations.size?this.serverQueries:this.shadowQueries}resolvePendingServerIdList(e){for(let t of(this.serverId=e.id,this.serverIdResolveList))t(this.serverId);this.serverIdResolveList=[]}applyMutation(e){if(this.serverFields={...this.serverFields,...e},this.shadowFields={...this.shadowFields,id:e.id},this.resolvePendingServerIdList(e),0===this.shadowMutations.size)for(let e of this.dependentQueries().values())for(let t of e.observers)t.onUpdateResult(this.serverFields,e.missingFields)}applyShadowMutation(e,t,i){0===this.shadowMutations.size&&(this.shadowFields={...this.serverFields},this.shadowQueries=new Set(this.serverQueries)),this.shadowMutations.add(e),i&&(this.shadowFields={...this.shadowFields,...i,...t})}removeShadowMutation(e,t){t?this.shadowMutations.delete(e):this.shadowMutations=new Set}getServerSideId(){if(this.serverId)return Promise.resolve(this.serverId);let[e,t]=(0,s.uy)();return this.serverIdResolveList.push(t),e}}class c{constructor(e,t){this.objectDef=e,this.emitter=t,this.instanceStates=new a,this.instanceStatesByUuid=new a,this.shadowInstances=new Set,this.queryStates=new a,this.possiblyOrphanedQueryResults=new a,this.possiblyOrphanInstances=new Set}getAllQueryIds(){return Array.from(this.queryStates.keys())}addInstance(e,t){if(this.emitter.emit({type:"STORE.ADD_INSTANCE",objectName:this.objectDef.name,instance:t.fields()}),(0,s.hu)("failed"!==e.results.type),!e.results.instances.has(t)){if(e.results.instances.add(t),"loaded"===e.results.type)for(let i of e.observers)i.onAddResult(t.fields(),e.missingFields);t.dependentQueries().add(e)}}removeInstance(e,t,i){if(this.emitter.emit({type:"STORE.REMOVE_INSTANCE",objectName:this.objectDef.name,instance:t.fields()}),(0,s.hu)("failed"!==e.results.type),!e.results.instances.has(t)){(0,s.jx)(!1,"tried to remove instance that does not exist");return}for(let s of(e.results.instances.delete(t),e.observers))i?s.onRemoveResult(t.fields()):s.detachChild(t.fields());t.dependentQueries().delete(e)}applyShadowMutationAdd(e,t,i){let s=this.instanceStates.entry(t).orInsertWith(()=>new h({id:t},!0));this.shadowInstances.add(s),s.applyShadowMutation(e,{id:t},i);let n=[];for(let[e,t]of this.queryStates.entries()){let i=t.query.matches(s.fields());i&&"failed"!==t.results.type&&(n.push(e),this.addInstance(t,s))}return n}applyShadowMutationAddWithUUID(e,t,i){let s=this.instanceStatesByUuid.entry(t).orInsertWith(()=>new h({id:t,uuid:t},!0));this.shadowInstances.add(s),s.applyShadowMutation(e,{uuid:t},{...i,id:t});let n=[];for(let[e,t]of this.queryStates.entries()){let i=t.query.matches(s.fields());i&&"failed"!==t.results.type&&(n.push(e),this.addInstance(t,s))}return n}applyShadowMutationDelete(e,t,i){this.shadowInstances.add(i),i.applyShadowMutation(e,{id:t},null);let s=[];for(let e of i.dependentQueries().values())"failed"!==e.results.type&&(this.removeInstance(e,i,!1),s.push(e.queryId));return s}applyShadowMutationDeleteWithUUID(e,t,i){this.shadowInstances.add(i),i.applyShadowMutation(e,{uuid:t},null);let s=[];for(let e of i.dependentQueries().values())"failed"!==e.results.type&&(this.removeInstance(e,i,!1),s.push(e.queryId));return s}applyShadowMutationUpdate(e,t,i,s){this.shadowInstances.add(i),i.applyShadowMutation(e,{id:t},s);let n=i.fields(),r=[];for(let e of this.queryStates.values())if("failed"!==e.results.type){if(e.results.instances.has(i)){if(e.query.matches(n))for(let t of e.observers)t.onUpdateResult(n,e.missingFields);else this.removeInstance(e,i,!1);r.push(e.queryId)}else e.query.matches(n)&&(this.addInstance(e,i),r.push(e.queryId))}return r}applyShadowMutationUpdateWithUUID(e,t,i,s){this.shadowInstances.add(i),i.applyShadowMutation(e,{uuid:t},s);let n=i.fields(),r=[];for(let e of this.queryStates.values())if("failed"!==e.results.type){if(e.results.instances.has(i)){if(e.query.matches(n))for(let t of e.observers)t.onUpdateResult(n,e.missingFields);else this.removeInstance(e,i,!1);r.push(e.queryId)}else e.query.matches(n)&&(this.addInstance(e,i),r.push(e.queryId))}return r}removeShadowMutations(e,t,i){for(let s in t){let t=this.instanceStates.get(s);if(void 0!==t&&t.shadowMutations.has(e)&&(t.removeShadowMutation(e,i),0===t.shadowMutations.size)){this.shadowInstances.delete(t);let e=t.fields();for(let i of t.dependentQueries().values())for(let t of i.observers)t.restoreChild(e);for(let i of this.queryStates.values())if("failed"!==i.results.type){if(i.results.instances.has(t)){if(t.dependentQueries().has(i))for(let t of i.observers)t.onUpdateResult(e,i.missingFields);else this.removeInstance(i,t,!0)}else t.dependentQueries().has(i)&&this.addInstance(i,t)}this.checkOrphanInstance(t)}}}removeShadowMutationsWithUUID(e,t,i){for(let s in t){let t=this.instanceStatesByUuid.get(s);if(void 0!==t&&t.shadowMutations.has(e)&&(t.removeShadowMutation(e,i),0===t.shadowMutations.size)){this.shadowInstances.delete(t);let e=t.fields();for(let i of t.dependentQueries().values())for(let t of i.observers)t.restoreChild(e);for(let i of this.queryStates.values())if("failed"!==i.results.type){if(i.results.instances.has(t)){if(t.dependentQueries().has(i))for(let t of i.observers)t.onUpdateResult(e,i.missingFields);else this.removeInstance(i,t,!0)}else t.dependentQueries().has(i)&&this.addInstance(i,t)}this.checkOrphanInstance(t)}}}resolvePendingServerIdList(e){for(let t in e){let i=this.objectDef.readPlainObject(e[t]);if(i.uuid&&this.instanceStatesByUuid.has(i.uuid)){let e=this.instanceStatesByUuid.get(i.uuid);e.resolvePendingServerIdList(i)}}}applyMutations(e,t){for(let t in e){let i=this.objectDef.readPlainObject(e[t]);if(this.instanceStates.has(t))this.instanceStates.get(t).applyMutation(i);else if(i.uuid&&this.instanceStatesByUuid.has(i.uuid)){let e=this.instanceStatesByUuid.get(i.uuid);this.instanceStates.set(i.id,e),e.applyMutation(i)}else{let e=new h(i,!1);i.uuid&&this.instanceStatesByUuid.set(i.uuid,e),this.instanceStates.set(i.id,e),this.possiblyOrphanInstances.add(e)}}for(let i in t){let s=t[i];if(!this.queryStates.has(i)){this.possiblyOrphanedQueryResults.set(i,s);continue}let n=this.queryStates.get(i);this.setQueryStateResults(n,s,e)}}subscribe(e,t){let i=this.queryStates.entry(e.queryId).orInsertWith(()=>({queryId:e.queryId,results:{type:"loading",instances:new Set},query:e.substituted(),observers:new Set,missingFields:[]}));if((0,s.hu)(!i.observers.has(t)),i.observers.add(t),this.possiblyOrphanedQueryResults.has(e.queryId))this.setQueryStateResults(i,this.possiblyOrphanedQueryResults.get(e.queryId)),this.possiblyOrphanedQueryResults.delete(e.queryId);else if("loaded"===i.results.type){let e={};for(let t of i.results.instances.values()){let i=t.fields();e[i.id]=i}t.onInitialResults(e,!1,void 0,i.missingFields)}else"failed"===i.results.type&&t.onError(i.results.error);return()=>{if((0,s.hu)(i.observers.has(t)),i.observers.delete(t),0===i.observers.size){if("failed"!==i.results.type)for(let e of i.results.instances.values())e.dependentQueries().delete(i),this.checkOrphanInstance(e);this.queryStates.delete(e.queryId)}}}getIdFromUuid(e){if(!this.instanceStatesByUuid.has(e))throw Error(`uuid ${e} doesn't exist in object store ${this.objectDef.name}`);return this.instanceStatesByUuid.get(e).getServerSideId()}setQueryStateResults(e,t,i){if("error"in t){for(let i of(e.results={type:"failed",error:t.error},e.observers))i.onError(t.error);return}let{results:n,fullResults:r,pagination:o,missingFields:a}=t;if(e.missingFields=a||[],"loaded"===e.results.type){for(let i in n){this.instanceStates.has(i)||(0,s.hu)(this.instanceStates.has(i),`objectId ${i} is missing from ${this.objectDef.name} store. queryResults is ${JSON.stringify(t)}`);let r=this.instanceStates.get(i);if(this.shadowInstances.has(r)){!0===n[i]?r.serverQueries.add(e):r.serverQueries.delete(e);continue}!0===n[i]?this.addInstance(e,r):(this.removeInstance(e,r,!0),this.possiblyOrphanInstances.add(r))}if(r){for(let t of e.results.instances)this.shadowInstances.has(t)||n[t.fields().id]||(this.removeInstance(e,t,!0),this.possiblyOrphanInstances.add(t));for(let t of this.shadowInstances.values())n[t.fields().id]||t.serverQueries.delete(e)}}else{(0,s.hu)(r),e.results={type:"loaded",instances:"loading"===e.results.type?e.results.instances:new Set};let t={};for(let i in n){(0,s.hu)(n[i]),(0,s.hu)(this.instanceStates.has(i));let r=this.instanceStates.get(i);r.serverQueries.add(e),this.shadowInstances.has(r)||(t[i]=r.fields(),e.results.instances.add(r))}for(let i of this.shadowInstances.values()){let s=i.fields();e.query.matches(s)&&(t[s.id]=s)}for(let i of e.observers)i.onInitialResults(t,!0,o,a)}}cleanupOrphans(){for(let e of(this.possiblyOrphanedQueryResults.clear(),this.possiblyOrphanInstances))this.checkOrphanInstance(e)}checkOrphanInstance(e){let t=this.instanceStates.has(e.fields().id),i=this.instanceStates.get(e.fields().id)===e,s=0===e.dependentQueries().size,n=this.shadowInstances.has(e);if(t&&i&&s&&!n){this.instanceStates.delete(e.fields().id);let t=e.fields().uuid;t&&this.instanceStatesByUuid.delete(t)}}}class f{constructor(e){this.objectDef=e,this.states=new u(()=>({state:{type:"loading"},observers:new Set}))}applyMutations(e){for(let t in e){let i=e[t],s=this.states.entry(t).orDefault();if("error"in i)s.state={type:"failed",errors:[{code:"computedFieldError",path:["computedFieldFunction"],error:Error(i.error.message)}]};else{let{value:e}=i,{fieldName:t}=i;this.objectDef.fields.has(t)&&(e=this.objectDef.readPlainObjectField(t,e),s.state={type:"loaded",value:e})}for(let e of s.observers.values())"loaded"===s.state.type?e.onUpdateResult(s.state.value):"failed"===s.state.type&&e.onErrors(s.state.errors)}}subscribe({computationId:e},t){let i=this.states.entry(e).orDefault();return(0,s.hu)(!i.observers.has(t)),i.observers.add(t),"loaded"===i.state.type?t.onUpdateResult(i.state.value):"failed"===i.state.type&&t.onErrors(i.state.errors),()=>{i.observers.delete(t),0===i.observers.size&&this.states.delete(e)}}}var p=i(60334),g=i(693055),y=i(450335),m=i(395409),b=i(228185);class v{constructor(e){this.observable=e}subscribeQuery(e,t){return this.observable.subscribeQuery(e,new w(t))}subscribeComputation(e,t){return this.observable.subscribeComputation(e,new S(t))}requestPaginationChange(e,t){}}class w{constructor(e){this.next=e}onInitialResults(e,t){this.next.onInitialResults(e,t)}onAddResult(e){}onRemoveResult(e,t){}onUpdateResult(e){}onError(e){}detachChild(e){}restoreChild(e){}identifier(){return this.next.identifier()}}class S{constructor(e){this.next=e,this.receivedInitialResults=!1}onUpdateResult(e){this.receivedInitialResults||(this.next.onUpdateResult(e),this.receivedInitialResults=!0)}onErrors(e){}}class I{constructor(e,t,i,s,r,o){this.key=e,this.viewRef=t,this.observable=r,this.traceId=o,this.frozenView=null,this.subscriptions=[],this.view=new n.Z(e,i,s,r)}getSubscriptionObservers(){return this.subscriptions}addSubscription(e){this.subscriptions.push(e)}removeSubscription(e){this.subscriptions=this.subscriptions.filter(t=>t!==e)}updateOverrides(e){if(!this.frozenView){let e="loaded"===this.view.result().status;this.frozenView=new n.Z(this.key,this.view.viewDef,new p.Z(this.view.context.sessionArgs,this.view.context.viewArgs,this.view.context.options),new v(this.observable)),e&&(0,s.hu)("loaded"===this.frozenView.result().status,`Expected frozen view to be loaded but has loading paths: ${this.frozenView.root.getLoadingPathsForDebugging()}`)}this.frozenView.context.overrides=e,this.frozenView.overridesChanged()}resolveOptimisticUpdates(){this.frozenView=null}viewArgs(){return this.view.viewArgs}activeView(){return this.frozenView?this.frozenView:this.view}destroy(){this.view.destroy()}}function O(e){let t=new Map;for(let i of e)for(let e in i.mutations){let s=i.mutations[e],n=t.get(e);for(let r in n||(n=new Map,t.set(e,n)),s){let t=s[r];if(t&&"delete"!==i.type){if("create"===i.type)n.has(r)&&console.warn(`Optimistically creating ${e} with id ${r} detected but an optimistic operation with that ID already exists.`),n.set(r,{type:"create",instance:{id:r,...t}});else{let e=n.get(r);e?"create"===e.type?n.set(r,{type:"create",instance:{...e.instance,...t}}):"update"===e.type&&n.set(r,{type:"update",delta:{...e.delta,...t}}):n.set(r,{type:"update",delta:t})}}else n.set(r,{type:"delete"})}}return t}class _{constructor(e){this.emitter=e}criticalAndPage(e){}error(e){}warn(e){}info(e){}debug(e,...t){switch(e){case"VIEW_QUERY_NODE.ADD_RESULT":case"VIEW_QUERY_NODE.UPDATE_RESULT":case"VIEW_QUERY_NODE.REMOVE_RESULT":this.emitter.emit({type:e,queryId:t[0],instance:t[1]});break;case"VIEW_QUERY_NODE.INITIAL_RESULT":this.emitter.emit({type:e,queryId:t[0],instances:t[1]});break;case"CROSS_VIEW_INCOMPLETE_INSTANCES":this.emitter.emit({type:e,queryInfo:t[0],missingProjectedFields:t[1],status:t[2]})}}}class D{constructor(e,t,i,s,n,r){for(let[o,a]of(this.args=e,this.schema=t,this.viewRegistry=i,this.emitter=s,this.onPaginationChange=n,this.enableCrossViewIncompleteInstanceCheck=r,this.viewSubscriptions=new Map,this.failedViewSubscriptions=new Map,this.nextSubscriptionId=1,this.orderedMutationsByView=new Map,this.paginationQueryNodeMap=new Map,this.stores={},this.isInMutationBatch=!1,this.shouldNotifyOnMutationBatchCompletion=!1,this.contextLogger=new _(this.emitter),t.objects))this.stores[o]={queries:new c(a,this.emitter),computations:new f(a)}}getAllQueryIds(){let e=[];for(let t in this.stores){let i=this.stores[t];i&&e.push(...i.queries.getAllQueryIds())}return e}resolvePendingServerIdList(e){for(let t in e){let{instances:i}=e[t],s=this.getStores(t);s&&s.queries.resolvePendingServerIdList(i)}}applyMutations(e){for(let t in this.emitter.emit({type:"SESSION.APPLY_MUTATIONS",mutations:e}),e){let{instances:i,queries:s,computations:n}=e[t],r=this.getStores(t);r&&(r.queries.applyMutations(i,s),r.computations.applyMutations(n))}for(let t in this.notifyObservers(),e){let e=this.getStores(t);e&&e.queries.cleanupOrphans()}}applyShadowMutations(e,t,i){var n;this.emitter.emit({type:"SESSION.APPLY_SHADOW_MUTATIONS",transactionId:e,mutations:t,operationType:i});let r=new Set,o={};for(let[e,t]of this.viewSubscriptions.entries())o[e]=t.activeView().root.result().status;for(let o in t){let a=this.getStores(o);if(!a)continue;let l=t[o];for(let d in t[o]){let t=a.queries.instanceStates.get(d),u=l[d];for(let e in u){let t=null==(n=this.schema.objects.get(o))?void 0:n.fields.get(e);t&&(0,g.M)(t)&&console.warn(`Optimistic updates for computed fields are not supported. Optimistically updating computed field '${e}' on object '${o}' may not work`)}if(void 0===t){if("update"===i||"delete"===i){console.warn(`Update triggered on non-existent instance of object type ${o}, id ${d}`);continue}for(let t of((0,s.hu)(u),a.queries.applyShadowMutationAdd(e,d,u)))r.add(t)}else if(null===u)for(let i of a.queries.applyShadowMutationDelete(e,d,t))r.add(i);else for(let i of a.queries.applyShadowMutationUpdate(e,d,t,u))r.add(i)}}let a=[],l=[];for(let[e,t]of this.viewSubscriptions.entries())"loaded"===o[e]&&"loading"===t.activeView().root.result().status&&(a.push(t.activeView().root.queryDef.objectFieldDef.name),l.push(t.activeView().root.getLoadingPathsForDebugging()));return a.length>0&&console.error(`[Livegraph] It seems like an optimistic update did not provide sufficient data to generate a complete view result. This caused the view(s): ${a.join()} to appear as if they had been dropped. If you need to update a subtree(an object and its children objects), the full children instances need to be included. Paths that became loading: ${l}`),this.notifyObservers(),Array.from(r.values())}removeShadowMutations(e,t,i){for(let s in this.emitter.emit({type:"SESSION.REMOVE_SHADOW_MUTATIONS",transactionId:e,mutations:t,success:i}),t){let n=this.getStores(s);n&&n.queries.removeShadowMutations(e,t[s],i)}this.notifyObservers()}applyShadowMutationsWithUUID(e,t,i){var n;this.emitter.emit({type:"SESSION.APPLY_SHADOW_MUTATIONS",transactionId:e,mutations:t,operationType:i});let r=new Set,o={};for(let[e,t]of this.viewSubscriptions.entries())o[e]=t.activeView().root.result().status;for(let o in t){let a=this.getStores(o);if(!a)continue;let l=t[o];for(let d in t[o]){let t=a.queries.instanceStatesByUuid.get(d),u=l[d];for(let e in u){let t=null==(n=this.schema.objects.get(o))?void 0:n.fields.get(e);t&&(0,g.M)(t)&&console.warn(`Optimistic updates for computed fields are not supported. Optimistically updating computed field '${e}' on object '${o}' may not work`)}if(void 0===t){if("update"===i||"delete"===i){console.warn(`Update triggered on non-existent instance of object type ${o}, uuid ${d}`);continue}for(let t of((0,s.hu)(u),a.queries.applyShadowMutationAddWithUUID(e,d,u)))r.add(t)}else if("delete"===i)for(let i of a.queries.applyShadowMutationDeleteWithUUID(e,d,t))r.add(i);else if(null!==u)for(let i of a.queries.applyShadowMutationUpdateWithUUID(e,d,t,u))r.add(i)}}let a=[],l=[];for(let[e,t]of this.viewSubscriptions.entries())"loaded"===o[e]&&"loading"===t.activeView().root.result().status&&(a.push(t.activeView().root.queryDef.objectFieldDef.name),l.push(t.activeView().root.getLoadingPathsForDebugging()));return a.length>0&&console.error(`[Livegraph] It seems like an optimistic update did not provide sufficient data to generate a complete view result. This caused the view(s): ${a.join()} to appear as if they had been dropped. If you need to update a subtree(an object and its children objects), the full children instances need to be included. Paths that became loading: ${l}`),this.notifyObservers(),Array.from(r.values())}removeShadowMutationsWithUUID(e,t,i){for(let s in this.emitter.emit({type:"SESSION.REMOVE_SHADOW_MUTATIONS",transactionId:e,mutations:t,success:i}),t){let n=this.getStores(s);n&&n.queries.removeShadowMutationsWithUUID(e,t[s],i)}this.notifyObservers()}getIdFromUuid(e,t){let i=this.getStores(e);if(!i)throw Error(`objectName ${e} doesn't exist`);return i.queries.getIdFromUuid(t)}applyShadowMutationsByView(e,t,i,s){this.emitter.emit({type:"SESSION.APPLY_SHADOW_MUTATIONS_BY_VIEW",viewName:e,transactionId:t,mutations:i,operationType:s});let n=this.orderedMutationsByView.get(e);n||(n=[],this.orderedMutationsByView.set(e,n)),n.push({transactionId:t,mutations:i,type:s,resolved:!1});let r=O(n);for(let[t,i]of this.viewSubscriptions)i.viewRef._name===e&&i.updateOverrides(r);this.notifyObservers()}removeShadowMutationsByView(e,t,i,n){this.emitter.emit({type:"SESSION.REMOVE_SHADOW_MUTATIONS_BY_VIEW",viewName:e,transactionId:t,mutations:i,success:n});let r=this.orderedMutationsByView.get(e);if(!r){(0,s.jx)(!1,"Removing a shadow mutation from a view that has no mutations.");return}let o=r.findIndex(e=>e.transactionId===t);o>=0&&(n?r[o].resolved=!0:r.splice(o,1));let a=r.filter(e=>!e.resolved);if(0===a.length){for(let[t,i]of this.viewSubscriptions)i.viewRef._name===e&&i.resolveOptimisticUpdates();this.orderedMutationsByView.delete(e)}else{let t=O(r);for(let[i,s]of this.viewSubscriptions)s.viewRef._name===e&&s.updateOverrides(t)}this.notifyObservers()}subscribe(e,t,i,r){let o;let a=this.viewRegistry.get(e._name);if(!a)throw Error(`View with name ${e._name} not found`);a.validateArguments(t).unwrap();let l=(0,n.L)(a.name,t);this.viewSubscriptions.has(l)?o=this.viewSubscriptions.get(l):(this.args.sessionId||this.emitter.emit({type:"SESSION.SUBSCRIBE_BEFORE_SESSION_ID_SET",sessionArgs:this.args,viewName:a.name}),o=new I(l,e,a,new p.Z(this.args,t,{logger:this.contextLogger,isContextForComputedField:!1,paginationQueryNodeMap:this.paginationQueryNodeMap,enableCrossViewIncompleteInstanceCheck:this.enableCrossViewIncompleteInstanceCheck}),this,r),this.viewSubscriptions.set(l,o));let d={id:this.nextSubscriptionId++,view:e,args:t,observer:i,unsubscribe:(0,s.IH)(()=>{o.removeSubscription(d),0===o.getSubscriptionObservers().length&&(this.viewSubscriptions.delete(l),o.destroy())}),clientUnsubscribed:!1,lastResult:null};return o.addSubscription(d),D.nextTick(()=>{d.clientUnsubscribed||this.notifyObserver(o,d)}),d}cleanupFailedSubscribeView(e){let t=this.viewSubscriptions.get(e);if(t){for(let e of t.getSubscriptionObservers()){let t={status:"errors",data:null,errors:[]};D.nextTick(()=>{e.clientUnsubscribed||(e.observer(t),e.lastResult=t)})}this.failedViewSubscriptions.set(e,t),this.viewSubscriptions.delete(e)}}hasActiveSubscriptions(e,t){let i=(0,n.L)(e,t),s=this.viewSubscriptions.get(i);return!!s&&s.getSubscriptionObservers().length>0}uniqueSubscriptions(){let e=[];for(let[t,i]of this.failedViewSubscriptions.entries())this.viewSubscriptions.has(t)||e.push({viewRef:i.viewRef,args:i.viewArgs()});for(let t of(this.failedViewSubscriptions.clear(),this.viewSubscriptions.values()))e.push({viewRef:t.viewRef,args:t.viewArgs(),traceId:t.traceId});return e}startReconnectionStateForPaginationQueries(){for(let e of this.paginationQueryNodeMap.values())e.startReconnectionState()}subscribeQuery(e,t){this.emitter.emit({type:"SESSION.SUBSCRIBE_QUERY",query:e});let i=this.getStores(e.objectName);return i?i.queries.subscribe(e,t):()=>{}}requestPaginationChange(e,t){this.onPaginationChange(e.queryId,t),this.notifyObservers()}subscribeComputation(e,t){this.emitter.emit({type:"SESSION.SUBSCRIBE_COMPUTATION",computation:e});let i=this.getStores(e.objectName);return i?i.computations.subscribe(e,t):()=>{}}batchMutations(e){this.isInMutationBatch=!0,this.shouldNotifyOnMutationBatchCompletion=!1;try{e()}finally{this.isInMutationBatch=!1,this.shouldNotifyOnMutationBatchCompletion&&this.notifyObservers()}}notifyObservers(){if(this.isInMutationBatch){this.shouldNotifyOnMutationBatchCompletion=!0;return}for(let e of this.viewSubscriptions.values())for(let t of e.getSubscriptionObservers())this.notifyObserver(e,t)}notifyObserver(e,t){var i;let s=e.activeView().result();t.lastResult!==s&&((null==(i=t.lastResult)?void 0:i.status)!=="loaded"||"loading"!==s.status)&&(this.emitter.emit({type:"SESSION.NOTIFY_OBSERVERS",view:e.viewRef,args:e.viewArgs(),result:s,subscriptionId:t.id}),t.clientUnsubscribed||(t.observer(s),t.lastResult=s))}getStores(e){let t=this.stores[e];return t||(this.emitter.emit({type:"SESSION.UNEXPECTED_OBJECT_NAME",objectName:e}),null)}static nextTick(e){setTimeout(e,0)}static async tick(){return new Promise(e=>{this.nextTick(()=>{e()})})}getViewSubscriptionsForTesting(){return this.viewSubscriptions}getViewSubscriptionsForDebugging(){let e={};for(let[t,i]of this.viewSubscriptions.entries()){let s=i.activeView().root.result();"loading"===s.status&&(s={...s,loadingPaths:i.activeView().root.getLoadingPathsForDebugging()}),e[t]=s}return e}prettyPrintLiveViewTree(e){let t="",i=null;if("string"==typeof e){if(!this.viewSubscriptions.has(e)){let e=[...this.viewSubscriptions.keys()].join("\n").replace(/"/g,'\\"');throw Error(`Subscription key not found, possible options: 
${e}`)}t=e,i=this.viewSubscriptions.get(t).activeView().root}else if(e instanceof y.Z){let s=e.parent;t=s.key,i=e}else throw Error("Please enter a subscription key or a LiveViewInstanceNode");let s=`Logging LiveView tree for subscription: ${t} 
View Name: ${i.queryDef.objectFieldDef.name} 
`,n=[[i,0]];for(;n.length>0;){let[e,t]=n.pop();if(s+="  ".repeat(t),e instanceof y.Z){e.children.forEach(e=>{n.push([e,t+1])});let i=e.instance.id;s+=`I: ${i||"Root Instance"} 
`}else if(e instanceof m.ZP){e.children.forEach(e=>{n.push([e,t+1])});let i=e.query.queryDef,r=[],o=e.query.context.viewArgs;o&&Object.keys(o).forEach(e=>{r.push(`${i.objectDef.name}.${e} = ${o[e]}`)}),s+=`Q: ${i.objectFieldDef.name} `,r.length>0?s+=`args:(${r.join()})
`:s+=`(${i.objectDef.name})
`}else if(e instanceof b.Z){let t=e.result();"loaded"===t.status?s+=`C: ${e.fieldName} = ${t.data} 
`:s+=`C: ${e.fieldName} is loading 
`}}return s}}},60334:(e,t,i)=>{i.d(t,{Z:()=>n});var s=i(924620);class n{constructor(e={},t={},i){var s;this.sessionArgs=e,this.viewArgs=t,this.options=i,this.statsCollector={queryNodes:0,instanceNodes:0,computations:0,queriesSubscribed:0,hiddenInstances:0,errorsNullableSoaked:0},this.overrides=null,(null==(s=this.options)?void 0:s.inheritedStats)&&(this.statsCollector=this.options.inheritedStats)}get tracingContext(){var e;return null==(e=this.options)?void 0:e.tracingContext}get isContextForComputedField(){var e;return null==(e=this.options)?void 0:e.isContextForComputedField}substituteFieldArgument(e){return(0,s.U4)(e)?"session"===e.type?this.sessionArgs[e.ref]:this.viewArgs[e.ref]:e}substituteExpressionArgument(e,t,i){return(0,s.U4)(e)?"parent"===e.type?i[e.ref]:this.substituteFieldArgument(t[e.ref]):e}substituteExpression(e,t,i){let s=e=>{switch(e.type){case"binary":case"in":return{...e,right:this.substituteExpressionArgument(e.right,t,i)};case"or":case"and":return{...e,expressions:e.expressions.map(s)}}};return e?s(e):void 0}substituteIndexingHint(e,t,i){if(!e)return null;if(Array.isArray(e.values))return e;let s=this.substituteExpressionArgument(e.values,t,i);return Array.isArray(s)||"object"!=typeof s||null===s?{field:e.field,values:Array.isArray(s)?s:[s]}:null}}},666110:(e,t,i)=>{i.d(t,{L:()=>o,Z:()=>a});var s=i(450335),n=i(230596),r=i(31e3);function o(e,t){return(0,r.h)([e,t])}class a{constructor(e,t,i,r,o){this.key=e,this.viewDef=t,this.context=i,this.observable=r,this.cancelNextTick=()=>{},this.initResultReady=!1,o=o||{},this.root=new s.Z(this,i,{},t.root,[]),(0,n.hu)(!o.onResultsResolved||o.onNextTick),0===this.root.children.length&&o.onNextTick&&(this.cancelNextTick=o.onNextTick(()=>this.resultsUpdated())),this.onResultsResolved=o.onResultsResolved}get path(){return[this.key]}get viewArgs(){return this.context.viewArgs}resultsUpdated(){this.onResultsResolved&&this.onResultsResolved(this.result()),this.reportTime()}overridesChanged(){this.root.overridesChanged()}destroy(){this.cancelNextTick(),this.root.destroy()}result(){return this.root.result()}resultWithLoadingStates(){return this.root.resultWithLoadingStates()}resetResult(){}isLoaded(){return this.root.isLoaded()}getQueryIds(){return this.root.getQueryIds()}reportTime(){let{tracingContext:e}=this.context;if(e&&!this.initResultReady&&this.isLoaded()){this.initResultReady=!0;let t=Date.now()-e.startTime,i=this.root.getInitStats();i&&e.viewInitReporter(e.viewName,this.context.viewArgs,this.context.sessionArgs,i,this.context.statsCollector,!!this.context.isContextForComputedField,t,this.context.tracingContext.originalViewName)}}}},228185:(e,t,i)=>{i.d(t,{Z:()=>n,x:()=>r});let s=Object.freeze({status:"loading"});class n{constructor({parent:e,computationDef:t,observable:i,context:s,instance:n}){this.initStats=null,this.parent=e,this.observable=i,this.computation=t.parameterizedComputation(s,n,e.queryDef.objectDef.naturalKey),this.computation.trackEvent("LiveViewComputationNode.constructor");let r=t.computedFieldDef.name;r in n?(this.unsubscribe=()=>{},this.onUpdateResult(n[r])):this.unsubscribe=i.subscribeComputation(this.computation,this)}get path(){return[...this.parent.path,this.computation.computationId]}get fieldName(){return this.computation.fieldName}overridesChanged(){}destroy(){this.unsubscribe()}onUpdateResult(e){this.computation.trackEvent("LiveViewComputationNode.onUpdateResult"),this._result={status:"loaded",errors:[],data:e},this.parent.resetResult(),this.parent.resultsUpdated()}onErrors(e){this.computation.trackEvent("LiveViewComputationNode.onErrors",e);let{name:t}=this.computation.fieldDef;this._result={status:"errors",data:null,errors:e.map(e=>({...e,path:[t,...e.path]}))},this.parent.resetResult(),this.parent.resultsUpdated()}recreateIfStale(e,t){}getLoadingPathsForDebugging(){return this._result?[]:[this.computation.fieldDef.name]}result(){return this._result?this._result:s}resultWithLoadingStates(){let e=this.result();return{id:this.computation.computationId,status:e.status,children:[],data:"errors"===e.status?e.errors:void 0}}isLoaded(){return!!this._result}getInitStats(){return this.initStats?this.initStats:this.isLoaded()?(this.initStats={queryNodes:0,instanceNodes:0,maxDepth:1,computations:1,failedQueries:0},this.initStats):null}}function r(e){return e instanceof n}},450335:(e,t,i)=>{i.d(t,{Z:()=>d});var s=i(924620),n=i(395409),r=i(228185),o=i(133645),a=i(230596),l=i(374743);class d{constructor(e,t,i,s,o){var a,d;for(let[r,a]of(this.parent=e,this.context=t,this.instance=i,this.queryDef=s,this.missingOptionalFields=o,this.children=[],this._isLoaded=!1,this.initStats=null,t.statsCollector.instanceNodes++,s.queries.entries())){let i=this.missingOptionalFields.some(e=>r===e.fieldName);i||(a.objectFieldDef.pagination?this.children.push(new l.Z({parent:this,queryDef:a,observable:e.observable,context:t})):this.children.push(new n.ZP({parent:this,queryDef:a,observable:e.observable,context:t})))}for(let[n,o]of s.computations.entries()){let s=this.missingOptionalFields.some(e=>n===e.fieldName);s||this.children.push(new r.Z({parent:this,computationDef:o,observable:e.observable,context:t,instance:i}))}null==(d=null==(a=t.options)?void 0:a.logger)||d.debug("VIEW_INSTANCE_NODE.CREATE",this.debugFields)}get debugFields(){return{object:this.queryDef.name,parent:this.parent.path,instanceFields:JSON.stringify(Array.from(Object.getOwnPropertyNames(this.instance))),queryFields:JSON.stringify(Array.from(this.queryDef.queries.keys())),projectedBaseFields:JSON.stringify(Array.from(this.queryDef.projectedFields.keys()))}}get path(){return[...this.parent.path,this.instance.id||"root"]}get queriedChildren(){return this.children.filter(n.Kv)}get computedChildren(){return this.children.filter(r.x)}overridesChanged(){for(let e of this.children)e.overridesChanged()}destroy(){for(let e of this.children)e.destroy()}resultsUpdated(){this.parent.resultsUpdated()}onUpdateResult(e,t){let i=(0,a.Qk)(e,this.instance,this.queryDef.projectedFields)&&(0,a._w)(this.missingOptionalFields,t),s=this.instance;this.instance=e;for(let t=0;t<this.children.length;t++){let i=this.children[t],n=i.recreateIfStale(s,e);n&&(i.destroy(),this.children[t]=n)}return!i&&(this.missingOptionalFields=t,this.resetResult(),!0)}getLoadingPathsForDebugging(){let e=[];for(let t of this.children){let i=t.getLoadingPathsForDebugging();e.push.apply(e,i)}return e}result(){if(this._result)return this._result;let e=[],t=this.queryDef.projectInstance(this.instance),i=!0;for(let n of this.children){let o=n.result();switch(o.status){case"loading":if(this.queryDef.optionalFields.has(n.fieldName)&&"root"===this.queryDef.name){t[this.queryDef.dealias(n.fieldName)]={status:s.wy.Error,error:`'root.${n.fieldName}' is missing, marked optional. Check server logs for more details.`};continue}return this._result=o,this._result;case"errors":i=!1,e.push.apply(e,o.errors);break;case"loaded":n.fieldName in this.instance&&n instanceof r.Z?t[this.queryDef.dealias(n.fieldName)]=this.instance[n.fieldName]:(e.push.apply(e,o.errors),t[this.queryDef.dealias(n.fieldName)]=o.data),this.queryDef.optionalFields.has(n.fieldName)&&(t[this.queryDef.dealias(n.fieldName)]={status:s.wy.Loaded,data:o.data})}}for(let e of this.missingOptionalFields)t[this.queryDef.dealias(e.fieldName)]={status:s.wy.Error,error:e.info||""};return i?this._result={status:"loaded",errors:e,data:t}:this._result={status:"errors",data:null,errors:e},this._result}resultWithLoadingStates(){return{id:this.instance.id,status:this.result().status,children:this.children.map(e=>e.resultWithLoadingStates()),data:this.instance}}resetResult(){this._result=void 0,this._isLoaded=!1,this.parent.resetResult()}isLoaded(){if(this._isLoaded)return!0;for(let e of this.children)if(!e.isLoaded())return!1;return this._isLoaded=!0,this._isLoaded}getQueryIds(){let e=[];for(let t of this.queriedChildren)e.push(...t.getQueryIds());return e}getInitStats(){if(this.initStats)return this.initStats;if(!this.isLoaded())return null;for(let e of(this.initStats={queryNodes:0,instanceNodes:1,maxDepth:1,computations:0,failedQueries:0},this.children))(0,o.Y)(this.initStats,e.getInitStats());return this.initStats}}},374743:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(395409),n=i(415289),r=i(133645);class o{constructor({parent:e,queryDef:t,observable:i,context:r}){var o,a;this.children=[],this._status={type:"loading"},this.initStats=null,this.nextCursor={start:null,end:null},this.previousPageCountsForReconnection=null,this.isPaginatedNodeFetching=!1,this.clientIsFetching=!1,this.parent=e,this.queryDef=t,this.observable=i,this.context=r,this.query=new n.Z(t,r,e.instance),this.isPaginatedNodeFetching=!0,this.clientIsFetching=!0;let l=s.ZP.DEFAULT_INITIAL_COUNT;this.children.push(new s.ZP({parent:this,queryDef:this.queryDef,observable:this.observable,context:this.context,paginationData:{before:this.nextCursor.start,after:this.nextCursor.end,count:l}})),null==(a=null==(o=this.context.options)?void 0:o.paginationQueryNodeMap)||a.set(this.query.queryId,this)}get fieldName(){return this.queryDef.objectFieldDef.name}get path(){return[...this.parent.path,"pagination-"+this.fieldName]}result(){if("loading"===this._status.type)return{status:"loading",data:null,errors:null};if("failed"===this._status.type){let e=this._status.error.code;return this._result={status:"errors",data:null,errors:[{code:e,path:[this.fieldName],error:Error(this._status.error.message)}]},this._result}if(this._result)return this._result;let e=[],t=[],i=!0;for(let s of this.children){let n=s.result();switch(n.status){case"loading":return this._result=n,this._result;case"errors":for(let e of(i=!1,n.errors))t.push({...e,path:[this.fieldName,...e.path]});break;case"loaded":for(let e of n.errors)t.push({...e,path:[this.fieldName,...e.path]});Array.isArray(n.data)?e.push(...n.data):n.data&&e.push(n.data)}}if(!i)return this._result={status:"errors",data:null,errors:t},this.clientIsFetching=!1,this._result;let s=Object.assign(e,{loadNext:e=>{var t,i;(null==(t=this._result)?void 0:t.data)&&(this._result={...this._result},(null==(i=this._result.data)?void 0:i.isLoadingNextPage)!==void 0&&(this._result.data.isLoadingNextPage=!0),this.parent.resetResult(),this.parent.resultsUpdated(),this.loadNextPage(e))},hasNextPage:()=>this.hasNextPage(),isLoadingNextPage:!1});return this._result={status:"loaded",errors:t,data:s},this.clientIsFetching=!1,this._result}resultsUpdated(){this.children.every(e=>e.isLoaded())&&(this._status.type="loaded"),"loading"!==this._status.type&&this.parent.resultsUpdated()}resetResult(){this._result=void 0,this.parent.resetResult()}identifier(){return{viewArgs:this.context.viewArgs,sessionArgs:this.context.sessionArgs,queryId:this.query.queryId}}onError(e){this.resetResult(),this._status={type:"failed",error:e},this.parent.resultsUpdated(),this.isPaginatedNodeFetching=!1}hasNextPage(){return!!this.nextCursor.end}isLoadingNextPage(){return this.clientIsFetching}loadNextPage(e){var t,i,n,r;if(this.isPaginatedNodeFetching){null==(i=null==(t=this.context.options)?void 0:t.logger)||i.error(Error(`Trying to fetch next page for query ${this.query.queryId} when there is an ongoing fetch more request.`));return}if(this.isPaginatedNodeFetching=!0,this.clientIsFetching=!0,!this.hasNextPage()){null==(r=null==(n=this.context.options)?void 0:n.logger)||r.error(Error(`Trying to fetch next page for query ${this.query.queryId} when there are no more pages left`));return}this.children.push(new s.ZP({parent:this,queryDef:this.queryDef,observable:this.observable,context:this.context,paginationData:{before:this.nextCursor.start,after:this.nextCursor.end,count:e}})),this.observable.requestPaginationChange(this.query,e)}destroy(){var e,t;for(let e of this.children)e.destroy();null==(t=null==(e=this.context.options)?void 0:e.paginationQueryNodeMap)||t.delete(this.query.queryId)}recreateIfStale(e,t){for(let i=0;i<this.children.length;i++){let s=this.children[i],n=s.recreateIfStale(e,t);n&&(s.destroy(),this.children[i]=n)}}onPaginationResults(e){if(this.isPaginatedNodeFetching=!1,this.nextCursor=e,this.previousPageCountsForReconnection){if(this.previousPageCountsForReconnection.length&&this.nextCursor.end){let e=this.previousPageCountsForReconnection.shift();this.loadNextPage(e)}else this.previousPageCountsForReconnection=null}}isLoaded(){return"loaded"===this._status.type}getInitStats(){if(this.initStats)return this.initStats;if(!this.isLoaded())return null;for(let e of(this.initStats={queryNodes:1,instanceNodes:0,maxDepth:1,computations:0,failedQueries:0},this.children.values()))(0,r.Y)(this.initStats,e.getInitStats());return this.initStats}startReconnectionState(){for(let e of(this.previousPageCountsForReconnection=this.children.map(e=>e.paginationArgs.count),this.children))e.destroy();this.children=[],this.nextCursor={start:null,end:null};let e=this.previousPageCountsForReconnection.shift();this.children.push(new s.ZP({parent:this,queryDef:this.queryDef,observable:this.observable,context:this.context,paginationData:{before:this.nextCursor.start,after:this.nextCursor.end,count:e}})),this.isPaginatedNodeFetching=!0,this.clientIsFetching=!0}onInitialResults(e,t,i){throw Error("PaginationNode should never directly receive results.")}onAddResult(e){throw Error("Method not implemented.")}onRemoveResult(e,t){throw Error("Method not implemented.")}onUpdateResult(e){throw Error("Method not implemented.")}detachChild(e){throw Error("Method not implemented.")}restoreChild(e){throw Error("Method not implemented.")}overridesChanged(){throw Error("Method not implemented.")}getLoadingPathsForDebugging(){let e=[];for(let t of("loading"===this._status.type&&e.push(this.fieldName),this.children.values()))e.push(...t.getLoadingPathsForDebugging());return e}resultWithLoadingStates(){throw Error("Method not implemented.")}}},395409:(e,t,i)=>{i.d(t,{Kv:()=>f,ZP:()=>c,br:()=>l,rr:()=>d});var s=i(415289),n=i(450335),r=i(133645),o=i(230596),a=i(374743);let l=Object.freeze({status:"loading",data:null,errors:null}),d=Object.freeze({status:"disabled",data:null,errors:null}),u=new Map,h=class{constructor({parent:e,queryDef:t,observable:i,context:r,paginationData:l}){var d,u;let h;this.children=new Map,this.detachedChildren=new Set,this._isLoaded=!1,this._status={type:"loading"},this.initStats=null,this.parent=e,this.observable=i,this.context=r,this.unsubscribe=()=>{},e instanceof a.Z&&l?(h=this.parent.parent.instance,this.paginationArgs=l,this.query=new s.Z(t,r,h,{before:l.before,after:l.after,count:l.count})):((0,o.hu)(e instanceof n.Z),h=e.instance,this.query=new s.Z(t,r,h)),r.statsCollector.queryNodes++;let{objectFieldDef:c}=t;if(this.isEmbedded||c.name in h){let e=h[c.name],t=h.id;if(e){if(Array.isArray(e)){let i={};e.forEach((e,s)=>{var n,r;let o=`${t}-${s.toString().padStart(10,"0")}`;e instanceof Object?i[o]={id:o,...e}:"string"==typeof e?i[o]={id:e}:null==(r=null==(n=this.context.options)?void 0:n.logger)||r.warn("EMBEDDED_INSTANCE_INVALID_TYPE",this.query.queryId,e)});let s=[];for(let e in h){s=this.query.queryDef.missingOptionalFieldsForEmbeddedInstance(i[e]);break}this.onInitialResults(i,!1,void 0,s)}else{let i=`${t}-0`,s={id:i,...e},n=this.query.queryDef.missingOptionalFieldsForEmbeddedInstance(s);this.onInitialResults({[i]:s},!1,void 0,n)}}else this.onInitialResults({},!1,void 0,[])}else this.unsubscribe=this.observable.subscribeQuery(this.query,this);null==(u=null==(d=this.context.options)?void 0:d.logger)||u.debug("VIEW_QUERY_NODE.CREATE",this.debugFields)}get isEmbedded(){return this.query.queryDef.objectFieldDef.embedded}get fieldName(){return this.query.queryDef.objectFieldDef.name}get path(){return[...this.parent.path,this.fieldName]}get debugFields(){var e;return{query:this.query.queryId,canonicalShapeID:null==(e=this.query.queryDef.shape)?void 0:e.id,path:this.path,embedded:this.isEmbedded}}identifier(){return{viewArgs:this.context.viewArgs,sessionArgs:this.context.sessionArgs}}overridesChanged(){var e;for(let[t,i]of((null==(e=this.context.overrides)?void 0:e.has(this.query.objectName))&&this.resetResult(),this.children))i.overridesChanged()}destroy(){for(let e of this.children.values())e.destroy();this.unsubscribe()}onError(e){this.resetResult(),this._status={type:"failed",error:e},this.parent.resultsUpdated()}onInitialResults(e,t,i,s){var r,l;for(let d in i&&((0,o.hu)(this.parent instanceof a.Z),this.parent.onPaginationResults(i)),null==(l=null==(r=this.context.options)?void 0:r.logger)||l.debug("VIEW_QUERY_NODE.INITIAL_RESULT",this.query.queryId,e),t&&this.context.statsCollector.queriesSubscribed++,(0,o.hu)("loaded"!==this._status.type,"Unexpected initial results on already loaded node"),e)this.children.set(d,new n.Z(this,this.context,e[d],this.query.queryDef,s||[]));this._status={type:"loaded"},this.resetResult(),this.parent.resultsUpdated()}onAddResult(e,t){var i,s;null==(s=null==(i=this.context.options)?void 0:i.logger)||s.debug("VIEW_QUERY_NODE.ADD_RESULT",this.query.queryId,e),(0,o.hu)("loaded"===this._status.type,"Unexpected incremental results on node that hasn't loaded yet"),this.children.set(e.id,new n.Z(this,this.context,e,this.query.queryDef,t||[])),this.resetResult(),this.parent.resultsUpdated()}onUpdateResult(e,t){var i,s;if(null==(s=null==(i=this.context.options)?void 0:i.logger)||s.debug("VIEW_QUERY_NODE.UPDATE_RESULT",this.query.queryId,e),(0,o.hu)("loaded"===this._status.type,"Unexpected incremental results on node that hasn't loaded yet"),(0,o.hu)(this.children.has(e.id)||e.uuid&&this.children.has(e.uuid),`onUpdateResult: this.children.has(instance.id) = ${this.children.has(e.id)}, instance.id = ${e.id}
       (instance.uuid && this.children.has(instance.uuid)) = ${e.uuid&&this.children.has(e.uuid)}, instance.uuid = ${e.uuid}`),e.uuid&&this.children.has(e.uuid)&&e.id!==e.uuid){let t=this.children.get(e.uuid);this.children.delete(e.uuid),this.children.set(e.id,t)}this.children.get(e.id).onUpdateResult(e,t||[])&&this.parent.resultsUpdated()}onRemoveResult(e){var t,i;let{id:s}=e;if(null==(i=null==(t=this.context.options)?void 0:t.logger)||i.debug("VIEW_QUERY_NODE.REMOVE_RESULT",this.query.queryId,e),(0,o.hu)("loaded"===this._status.type,"Unexpected incremental results on node that hasn't loaded yet"),(0,o.hu)(this.children.has(e.id)||e.uuid&&this.children.has(e.uuid),`onRemoveResult: this.children.has(instance.id) = ${this.children.has(e.id)}, instance.id = ${e.id}
       (instance.uuid && this.children.has(instance.uuid)) = ${e.uuid&&this.children.has(e.uuid)}, instance.uuid = ${e.uuid}`),e.uuid&&this.children.has(e.uuid)&&e.id!==e.uuid){let t=this.children.get(e.uuid);this.children.delete(e.uuid),this.children.set(e.id,t)}this.children.get(s).destroy(),this.children.delete(s),this.detachedChildren.delete(s),this.resetResult(),this.parent.resultsUpdated()}detachChild({id:e}){this.detachedChildren.add(e),this.children.delete(e),this.resetResult(),this.parent.resultsUpdated()}restoreChild(e){this.detachedChildren.delete(e.id),this.onAddResult(e),this.resetResult()}resultsUpdated(){"loading"!==this._status.type&&this.parent.resultsUpdated()}recreateIfStale(e,t){if(this.isEmbedded){if((0,o.iv)(e[this.query.queryDef.objectFieldDef.name],t[this.query.queryDef.objectFieldDef.name]))return}else if(!this.query.isContextStale(t))return;return new h({parent:this.parent,queryDef:this.query.queryDef,observable:this.observable,context:this.context})}getLoadingPathsForDebugging(){let e=[];"loading"===this._status.type&&e.push(this.fieldName);let t=[...this.children.values()],i=this.query.order();for(let s of(i&&t.sort(({instance:e},{instance:t})=>i(e,t)),t)){let t=s.getLoadingPathsForDebugging();e.push(...t.map(e=>`${this.fieldName}["${s.instance.id}"].${e}`))}return e}result(){var e,t,i,s,n,r,a,d;if("loading"===this._status.type)return l;if("failed"===this._status.type){let e=this._status.error.code;return this._result={status:"errors",data:null,errors:[{code:e,path:[this.fieldName],error:Error(this._status.error.message)}]},this._result}if(this._result)return this._result;let h=(null==(e=this.context.overrides)?void 0:e.get(this.query.objectName))||u,c=[];for(let e of this.children.values()){let t=e.instance,i=e.result();if("loaded"===i.status){let s=h.get(e.instance.id);if(s){if("delete"===s.type)continue;if("create"===s.type)continue;if("update"===s.type){if(t={...t,...s.delta},!this.query.substituted().matches(t))continue;i.data=this.query.queryDef.projectResults({...i.data,...s.delta})}else(0,o.vE)(s)}}c.push({instance:t,result:i})}for(let[e,t]of h)"create"===t.type&&this.query.substituted().matches(t.instance)&&c.push({instance:t.instance,result:{status:"loaded",data:this.query.queryDef.projectResults(t.instance),errors:[]}});let f=this.query.order();f&&c.sort(({instance:e},{instance:t})=>f(e,t));let{fieldName:p}=this,g=[],y=[],m=!0;for(let{result:e}of c)switch(e.status){case"loading":return this._result=e,this._result;case"errors":for(let t of(m=!1,e.errors))g.push({...t,path:[p,...t.path]});break;case"loaded":for(let t of e.errors)g.push({...t,path:[p,...t.path]});y.push(e.data)}if(!m)return this.query.queryDef.isNullable()?(this.context.statsCollector.errorsNullableSoaked++,null==(i=null==(t=this.context.options)?void 0:t.logger)||i.info("VIEW_QUERY_NODE.NULLABLE_ERROR_SOAK",{errors:g,...this.debugFields}),this._result={status:"loaded",errors:g,data:null}):this._result={status:"errors",data:null,errors:g},this._result;if(y.length){let e=this.query.queryDef.getMissingProjectedFields(y[0]);if(e.length&&(null==(s=this.context.options)?void 0:s.enableCrossViewIncompleteInstanceCheck))return null==(r=null==(n=this.context.options)?void 0:n.logger)||r.debug("CROSS_VIEW_INCOMPLETE_INSTANCES",this.query.queryInfo(),e,"ff_enabled_and_set_loading"),this._result=l,this._result;null==(d=null==(a=this.context.options)?void 0:a.logger)||d.debug("CROSS_VIEW_INCOMPLETE_INSTANCES",this.query.queryInfo(),e,"set_loaded")}return this.query.queryDef.isList()?this._result={status:"loaded",errors:g,data:y}:y.length>0?this._result={status:"loaded",errors:g,data:y[0]}:this.query.queryDef.isNullable()?this._result={status:"loaded",errors:g,data:null}:this._result={status:"errors",data:null,errors:[...g,{code:"nonNullableResult",path:[p]}]},this._result}resultWithLoadingStates(){let e=this.result();return{id:this.query.queryId,status:e.status,children:Array.from(this.children.entries()).map(([e,t])=>t.resultWithLoadingStates()),data:"errors"===e.status?e.errors:void 0}}resetResult(){this._result=void 0,this._isLoaded=!1,this.parent.resetResult()}isLoaded(){if("loading"===this._status.type)return!1;if(this._isLoaded)return!0;for(let e of this.children.values())if(!e.isLoaded())return!1;return this._isLoaded=!0,this._isLoaded}getQueryIds(){let e=[this.query.queryId];for(let[t,i]of this.children)e.push(...i.getQueryIds());return e}getInitStats(){if(this.initStats)return this.initStats;if(!this.isLoaded())return null;for(let e of(this.initStats={queryNodes:1,instanceNodes:0,maxDepth:1,computations:0,failedQueries:"failed"===this._status.type?1:0},this.children.values()))(0,r.Y)(this.initStats,e.getInitStats());return this.initStats}},c=h;function f(e){return e instanceof c}c.DEFAULT_INITIAL_COUNT=10},415289:(e,t,i)=>{i.d(t,{Z:()=>l,Q:()=>d});var s=i(924620),n=i(28719),r=i(379934);class o{constructor({fields:e,filter:t,limit:i}){this.fields=e,this.limit=i,this.filter=t}matches(e){if(!this.filter)return!0;let t=i=>{switch(i.type){case"binary":let s=e[i.left],n=i.right;switch(i.op){case"=":return s===n;case"<>":return s!==n}if(null===s||null===n)return!1;switch(i.op){case">":return s>n;case">=":return s>=n;case"<":return s<n;case"<=":return s<=n}case"in":let r=e[i.left],o=i.right;return o.some(e=>e===r);case"or":return i.expressions.some(t);case"and":return i.expressions.every(t)}};return t(this.filter)}singleMatchingId(){if(this.filter&&"binary"===this.filter.type){let{left:e,right:t}=this.filter;if("id"===e&&"string"==typeof t)return t}return null}}var a=i(320717);class l{constructor(e,t,i,a){this.queryDef=e,this.context=t,this.parent=i,this.paginationArgs=a;let l=[];for(let e of this.queryDef.objectFieldDef.args){let t=this.queryDef.fieldArgs[e.name];(0,s.U4)(t)?"session"===t.type?l.push(this.context.sessionArgs[t.ref]):l.push(this.context.viewArgs[t.ref]):l.push(t)}this.usedResolverValues=(0,n.a)(this.filter).filter(({type:e})=>"parent"===e).map(({ref:e})=>i[e]),this.usedResolverValues.push(...this.getUsedHttpResolverValues());let d=[l,this.usedResolverValues];this.isStaticQuery()&&t.viewArgs.__requestId&&d.push(t.viewArgs.__requestId),this.isPaginationQuery()&&d.push(a),this.queryId=function(e,t){let i=e.parent instanceof r.Z?e.parent.objectDef.name:null;if(e.isComputedFieldDependency&&"root"===i&&"root"===e.objectFieldDef.name)return JSON.stringify(["computed","root",e.objectDef.name].concat(t));let s=JSON.stringify([i,e.objectFieldDef.name].concat(t));return s}(this.queryDef,d),this._substituted=new o({fields:this.queryDef.objectDef.queriedFields,filter:this.context.substituteExpression(this.filter,this.queryDef.fieldArgs,i)||null,limit:this.queryDef.objectFieldDef.expectedMaxCount??200}),this.indexingHint=this.context.substituteIndexingHint(this.queryDef.indexingHint,this.queryDef.fieldArgs,i)}queryInfo(){return{objectName:this.queryDef.objectDef.name,parent:{objectName:this.queryDef.parent instanceof r.Z?this.queryDef.parent.objectDef.name:null,fieldName:this.queryDef.objectFieldDef.name}}}get objectName(){return this.queryDef.objectFieldDef.type.name}get filter(){return this.queryDef.objectFieldDef.filter}get orderBy(){return this.queryDef.objectFieldDef.orderBy}substituted(){return this._substituted}getResolvedHttpResolverConfig(){let e=this.queryDef.objectFieldDef.resolver;if((null==e?void 0:e.type)!=="HTTP")return null;let t={};for(let i in e.queryParams){let s=e.queryParams[i],n=this.context.substituteExpressionArgument(s,this.queryDef.fieldArgs,this.parent);t[i]=n}let i=[];if("RedisPubsub"===e.realtimePolicy.type){let t=e.realtimePolicy.channelPostfix;for(let e of t){let t=this.context.substituteExpressionArgument(e,this.queryDef.fieldArgs,this.parent);i.push(t)}}return{...e,queryParams:t,realtimePolicy:"RedisPubsub"===e.realtimePolicy.type?{...e.realtimePolicy,channelPostfix:i}:e.realtimePolicy}}getUsedHttpResolverValues(){let e=this.queryDef.objectFieldDef.resolver;if((null==e?void 0:e.type)!=="HTTP")return[];let t=[];for(let i of Object.keys(e.queryParams).sort()){let n=e.queryParams[i];if(!(0,s.U4)(n)||"parent"!==n.type)continue;let r=this.context.substituteExpressionArgument(n,this.queryDef.fieldArgs,this.parent);t.push(r)}if("RedisPubsub"===e.realtimePolicy.type){let i=e.realtimePolicy.channelPostfix;for(let e of i){if(!(0,s.U4)(e)||"parent"!==e.type)continue;let i=this.context.substituteExpressionArgument(e,this.queryDef.fieldArgs,this.parent);t.push(i)}}return t}isContextStale(e){return(0,n.a)(this.filter).filter(({type:e})=>"parent"===e).some(({ref:t},i)=>this.usedResolverValues[i]!==e[t])}isPaginationQuery(){return void 0!==this.paginationArgs}isStaticQuery(){var e;return(null==(e=this.queryDef.objectFieldDef.resolver)?void 0:e.realtimePolicy.type)==="Static"}getBinaryFilterResolvedParentValue(e){return this.filter&&"binary"===this.filter.type&&(0,s.U4)(this.filter.right)&&this.filter.left===e&&"parent"===this.filter.right.type?this.parent[this.filter.right.ref]:null}getFirstPageSizeOrDefault(e){var t;let i=null==(t=this.queryDef.objectFieldDef.pagination)?void 0:t.firstPageSize;if(!i)return e;let s=this.context.substituteFieldArgument(i);return"number"==typeof s?s:e}getSelectedCursorColumns(){var e,t;let i=null==(e=this.queryDef.objectFieldDef.pagination)?void 0:e.selectedCursorColumn;if(!i)return null;let s=this.context.substituteFieldArgument(i),n=null==(t=this.queryDef.objectFieldDef.pagination)?void 0:t.cursorColumnSet;return"string"==typeof s&&n&&n[s]||null}getPaginationSortOrder(){var e;let t=null==(e=this.queryDef.objectFieldDef.pagination)?void 0:e.sortOrder;if(!t)return null;let i=this.context.substituteFieldArgument(t);return"ASC"===i||"DESC"===i?i:null}order(){let e=this.orderBy;return"Unordered"===e?null:(t,i)=>{for(let[s,n]of[...e||[],["id","ASC"]]){let e=t[s],r=i[s];if(null!==e||null!==r){if(null===e)return"ASC"===n?1:-1;if(null===r||e<r)return"ASC"===n?-1:1;if(e>r)return"ASC"===n?1:-1}}return 0}}}function d(e,t){let i=JSON.parse(t);if("computed"===i[0])return{kind:"object",name:i[2]};let s=i[0],n=i[1],r=e.objectDef({kind:"object",name:s}),o=r.fieldDef(n);if(!(o instanceof a.Z))throw Error(`queryId ${t} references a non-object field`);return o.type}},133645:(e,t,i)=>{i.d(t,{Y:()=>s});function s(e,t){t&&(e.queryNodes+=t.queryNodes,e.instanceNodes+=t.instanceNodes,e.maxDepth=Math.max(e.maxDepth,t.maxDepth+1),e.computations+=t.computations,e.failedQueries+=t.failedQueries)}},235459:(e,t,i)=>{i.d(t,{W:()=>function e(t,i,s,n=!0){let{type:r,name:o}=i;if(void 0===s)return{argName:o,type:"error",msg:"must not be undefined"};if(null===s){if(!i.nullable)return{argName:o,type:"error",msg:"must not be null"}}else{if("list"===r.kind){if(!(s instanceof Array))return{argName:o,type:"error",msg:"expected an array"};let i=[];for(let a in s){let l=e(t,{name:`${o}[${a}]`,type:r.ofType},s[a],n);if("error"===l.type)return l;i.push(l.parsedValue)}return{argName:o,type:"parsing",value:s,parsedValue:i}}if("map"===r.kind){if("object"!=typeof s||s instanceof Array||s instanceof Date)return{argName:o,type:"error",msg:"expected a map"};let i={};for(let a in s){let l=e(t,{name:`${o}["${a}"]`,type:r.valueType},s[a],n);if("error"===l.type)return l;i[a]=l.parsedValue}return{argName:o,type:"parsing",value:s,parsedValue:i}}if("enum"===r.kind){let e=t.enumDef(r);if("string"!=typeof s||!e.isValidValue(s))return{argName:o,type:"error",msg:`expected one of: ${e.values.join(", ")}`}}else{let e,t;switch(r.kind){case"datetime":case"date":n?(e=`string representation of ${r.kind}`,t=e=>{if("string"!=typeof e)return null;let t=Date.parse(e);return Number.isNaN(t)?null:new Date(t)}):(e="Date",t=e=>e instanceof Date?e:null);break;case"bigint":e="string representation of bigint",t=e=>"string"!=typeof e?null:/^-?[0-9]+$/.test(e)?e:null;break;case"uuid":e="string representation of uuid",t=e=>"string"!=typeof e?null:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(e)?e:null;break;case"string":e="string",t=e=>"string"==typeof e?e:null;break;case"int":case"float":e="number",t=e=>"number"==typeof e?e:null;break;case"bool":e="boolean",t=e=>"boolean"==typeof e?e:null}let i=t(s);return null===i?{argName:o,type:"error",msg:`expected ${e}, got ${typeof s} from ${JSON.stringify(s)}`}:{argName:o,type:"parsing",value:s,parsedValue:i}}}return{argName:o,type:"parsing",value:s,parsedValue:s}}})},693055:(e,t,i)=>{i.d(t,{M:()=>d,Z:()=>l});var s=i(126220),n=i(656762),r=i(730629),o=i(921814),a=i(498142);class l{constructor(e,t,i){let o;if(this.objectDef=t,this.name=e.name,this.type=e.type,this.nullable=!1,this.deprecated=e.deprecated,this.dependencies=e.dependencies,!t.naturalKey){this.args=(e.args||[]).concat([{name:"_rootId",type:{kind:"string"}}]),this.view=new n.Z(this.name,{fields:{root:[{_rootId:r.lj("_rootId")},e.dependencies]},args:this.args},new s.Z({name:"root",fields:[{name:"root",args:[{name:"_rootId",type:{kind:"string"}}],type:{kind:"object",name:t.name},filter:["id","=",r.tn("_rootId")]}]}),i,{isComputedFieldDependency:!0,computedObjectName:t.name,shouldUseMissingFields:!0});return}let l=[],d={};Array.from(t.naturalKey).forEach(i=>{let s=t.fields.get(i);if(!s)throw Error(`cannot create computed field def for ${e.name}; natural key ${i} is not found on object def for ${t.name}`);if(!(0,a.o)(s))throw Error(`cannot create computed field def for ${e.name}; natural key ${s.name} is not of scalar type on object def for ${t.name}`);l.push({name:"_nk_"+i,type:s.type}),d["_nk_"+i]=r.lj("_nk_"+i)}),this.args=(e.args||[]).concat(...l);let u=[];Array.from(t.naturalKey).forEach(e=>{u.push([e,"=",r.tn("_nk_"+e)])}),o=u.length>1?{and:u}:u[0],this.view=new n.Z(this.name,{fields:{root:[d,e.dependencies]},args:this.args},new s.Z({name:"root",fields:[{name:"root",args:l,type:{kind:"object",name:t.name},filter:o}]}),i,{isComputedFieldDependency:!0,computedObjectName:t.name,shouldUseMissingFields:!0},void 0,i.scopedQueryShapeFromRoot(t.name))}get displayName(){return`${this.objectDef.name}.${this.name}`}validate(e,t){(0,o.iU)(`Computed field '${this.name}' of object type '${t.name}'`,this.args)}}function d(e){return"object"==typeof e.view}},730629:(e,t,i)=>{i.d(t,{HK:()=>r,XB:()=>a,_:()=>s,bm:()=>c,cR:()=>o,jt:()=>f,lj:()=>d,nP:()=>u,qm:()=>h,tn:()=>l,vX:()=>n});let s=null;function n(e){return!!e&&"fields"in e}function r(e){return"object"===e.type.kind||"objects"===e.type.kind}function o(e){return"embedded"in e&&e.embedded}function a(e){return"computed"in e}let l=e=>({type:"field",ref:e}),d=e=>({type:"view",ref:e}),u=e=>({type:"session",ref:e}),h=e=>({type:"parent",ref:e});function c(e,t){return t&&n(t)?{aliasedField:e,optional:t.optional,fields:t.fields}:{aliasedField:e,fields:t}}function f(e){return e?n(e)?e.aliasedField?{aliasedField:e.aliasedField,optional:!0,fields:e.fields}:{optional:!0,fields:e.fields}:{optional:!0,fields:e}:{optional:!0,fields:null}}},28719:(e,t,i)=>{i.d(t,{a:()=>r,f:()=>n});var s=i(924620);function n(e){let t=new Set,i=e=>{switch(e.type){case"binary":case"in":t.add(e.left);break;case"or":case"and":e.expressions.forEach(i)}};return e&&i(e),t}function r(e){let t=[],i=e=>{switch(e.type){case"binary":case"in":(0,s.U4)(e.right)&&t.push(e.right);break;case"or":case"and":e.expressions.forEach(i)}};return e&&i(e),t}},126220:(e,t,i)=>{i.d(t,{Z:()=>u});var s=i(230596),n=i(730629),r=i(320717),o=i(498142),a=i(693055),l=i(299711),d=i(846316);class u{constructor(e){for(let t of(this.queriedFields=[],this.pendingComputedFields=new Set,this.name=e.name,this.fields=new Map,this.embedded=e.embedded,this.naturalKey=e.naturalKey,this.annotations=e.annotations,this.deprecated=e.deprecated,e.fields))(0,n.HK)(t)?(this.fields.set(t.name,new r.Z(t)),(0,n.cR)(t)&&this.queriedFields.push(t.name)):(0,n.XB)(t)?this.pendingComputedFields.add(t.name):(this.fields.set(t.name,new o.Z(t)),this.queriedFields.push(t.name));this.needsTransform=e.fields.some(({type:e})=>h(e)||"list"===e.kind&&h(e.ofType))}constructComputedFields(e,t){for(let i of e.fields)(0,n.XB)(i)&&(this.fields.set(i.name,new a.Z(i,this,t)),this.pendingComputedFields.delete(i.name))}validate(e){if("root"===this.name)for(let e of this.fields.values())if(e instanceof r.Z){if(e.embedded)throw new l.Z((0,d.oneLine)`
               root fields cannot be embedded type, but '${e.name}'
               is embedded`)}else throw new l.Z((0,d.oneLine)`
            root fields must be of object type, but '${e.name}' is
            '${e.type.kind}'`);else this.embedded||this.fieldDef("id");for(let t of this.fields.values())t.validate(e,this)}fieldDef(e){let t=this.fields.get(e);if(t)return t;if(this.pendingComputedFields.has(e))throw new l.Z((0,d.oneLine)`
        field '${e}' is a computed field of '${this.name}', but computed fields haven't yet been constructed.
        You may need to re-order objects in the Schema definition.
      `);throw new l.Z((0,d.oneLine)`
      field '${e}' isn't present in object type '${this.name}'`)}readPlainObject(e){if(!this.needsTransform)return e;let t={id:e.id};for(let[i,{type:s}]of this.fields.entries()){if(!(i in e))continue;let n=e[i];t[i]=this.readPlainObjectField(i,n,s)}return t}readPlainObjectField(e,t,i){if(!this.needsTransform)return t;if(i||(i=this.fields.get(e).type),null!==t){if(h(i))return c(t);if("list"===i.kind&&h(i.ofType))return t.map(c)}return t}}function h(e){return"date"===e.kind||"datetime"===e.kind}function c(e){return(0,s.hu)("string"==typeof e),new Date(e)}},320717:(e,t,i)=>{i.d(t,{T:()=>h,Z:()=>u});var s=i(924620),n=i(730629),r=i(28719),o=i(299711),a=i(921814),l=i(846316),d=i(693055);class u{constructor(e){if(this.name=e.name,this.type=e.type,this.nullable=e.nullable||!1,this.deprecated=e.deprecated,n.cR(e))this.embedded=!0,this.args=[],this.checkCanRead=void 0;else{if(this.embedded=!1,this.args=e.args||[],this.expectedMaxCount=e.expectedMaxCount,this.filter=e.filter?function e(t){if("or"in t)return{type:"or",expressions:t.or.map(e)};if("and"in t)return{type:"and",expressions:t.and.map(e)};let[i,s,n]=t;return"in"===s?{type:"in",left:i,right:n}:{type:"binary",left:i,op:s,right:n}}(e.filter):void 0,e.neverCheckCanRead&&e.checkCanRead)throw Error("neverCheckCanRead: true cannot be declared alongside checkCanRead.");this.neverCheckCanRead=e.neverCheckCanRead||!1,this.checkCanRead=e.checkCanRead||void 0,this.pagination=e.pagination,this.resolver=e.resolver}this.orderBy=function(e){return e?"Unordered"===e?"Unordered":e.map(e=>e instanceof Array?e:[e,"ASC"]):void 0}(e.orderBy)}isNullable(){return this.nullable}isList(){return"objects"===this.type.kind}get filterFields(){let e=new Set;for(let{type:t,ref:i}of(0,r.a)(this.filter))"parent"===t&&e.add(i);return e}get dependentFields(){let e=new Set;if(this.orderBy&&"Unordered"!==this.orderBy)for(let[t]of this.orderBy)e.add(t);for(let t of(0,r.f)(this.filter))e.add(t);return e}validate(e,t){var i,n,r,u,h,c,f,p,g,y,m,b,v,w,S,I,O,_,D,E,C,R,F;e.objects.has(this.type.name)||this.throwFieldError(t,`refers to undefined object type '${this.type.name}'`);let j=new Set;if(this.checkCanRead)for(let i in 0===Object.keys(this.checkCanRead).length&&this.throwFieldError(t,"uses checkCanRead attribute and it doesn't take any arguments. checkCanRead must take arguments such as { userId: fieldArg('userId') } or { userId: session('userId') }. This also means the corresponding canRead field must take these arguments as well."),this.checkCanRead){let n=this.checkCanRead[i];(0,s.U4)(n)&&((0,s.PK)(this.args,n.ref)||(0,s.PK)(e.session.args,n.ref)?j.add(n.ref):this.throwFieldError(t,`uses argument '${n.ref}' in its checkCanRead call but does not declare it`))}let A=e.objectDef(this.type);this.embedded&&!A.embedded&&this.throwFieldError(t,`refers to object '${this.type.name}' as an embedded field, but object '${this.type.name}' is not marked as embedded`),A.embedded&&!this.embedded&&this.throwFieldError(t,`refers to embedded object type '${this.type.name}' without marking as embedded. Add embedded: true`),this.isResolvable(t)||this.throwFieldError(t,"does not contain a filter or resolver and is not embedded"),this.checkCanRead&&(this.checkCanRead.fieldName||A.fields.has("canRead")||this.throwFieldError(t,`has checkCanRead set to true but '${A.name}' does not have a 'canRead' field`),this.checkCanRead.fieldName&&!A.fields.has(this.checkCanRead.fieldName.toString())&&this.throwFieldError(t,`has checkCanRead set to true and with fieldName set to '${this.checkCanRead.fieldName.toString()}' but '${A.name}' does not have a this field`),this.checkCanRead.fieldName&&"bool"!==A.fields.get(this.checkCanRead.fieldName.toString()).type.kind&&this.throwFieldError(t,`has checkCanRead set to true and with fieldName set to '${this.checkCanRead.fieldName.toString()}' but '${this.checkCanRead.fieldName.toString()}' return type is not bool`)),(0,a.iU)(`field '${this.name}' of object type '${t.name}'`,this.args);let N=e=>{let i=A.fields.get(e.left);return i||this.throwFilterError(t,`refers to field '${e.left}', which does not exist on object '${this.type.name}'`),i},k=e=>{if((0,s.U4)(e.right)&&"field"===e.right.type){let i=(0,s.PK)(this.args,e.right.ref);return i||this.throwFieldError(t,`uses argument '${e.right.ref}' in its filter but does not declare it`),j.add(e.right.ref),i}if((0,s.U4)(e.right)&&"parent"===e.right.type){let i=t.fields.get(e.right.ref);return i||this.throwFieldError(t,`refers to unknown parent field '${e.right.ref}' in its filter`),i}throw new o.Z((0,l.oneLine)`
        Filter condition of '${this.name}' in object type ${t.name} expects an argument or parent field,
        but is a ${typeof e.right} with the value '${e.right}'`)},M=i=>{if(!i)return;let n=null,r=null;switch(i.type){case"binary":if(["list","map","object","objects"].indexOf((n=N(i)).type.kind)>-1)throw new o.Z((0,l.oneLine)`
              Cannot filter on field '${i.left}' in object type '${t.name}'. Filter on type
              '${n.type.kind}' is not supported.`);if(("date"===n.type.kind||"datetime"===n.type.kind)&&("="===i.op||"<>"===i.op)&&null!==i.right)throw new o.Z((0,l.oneLine)`
              Cannot filter on field '${i.left}' in object type '${t.name}'. '${i.op}' filter
              on type '${n.type.kind}' is not is not supported for non-null values.`);if((0,d.M)(n))throw new o.Z((0,l.oneLine)`
              Cannot filter on field '${i.left}' in object type '${t.name}'. Filters on computed fields
              are not supported since filter conditions get translated directly to SQL queries and there are no
              column in the database corresponding directly to the computed field.`);if((0,s.U4)(i.right)){if(r=k(i),!(0,a.BD)(r.type,n.type)&&!e.legacyConfig.isTypeConversionExempted("filterArg",r.type.kind,n.type.kind,`${t.name}.${this.name}.${i.left}`))throw new o.Z((0,l.oneLine)`
                Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                LHS is a '${n.type.kind}' but RHS is a '${r.type.kind}'`)}else if(null!==i.right)switch(n.type.kind){case"int":case"float":if("number"!=typeof i.right)throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a number but RHS is a '${typeof i.right}'`);break;case"string":case"bigint":case"uuid":if("string"!=typeof i.right)throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a string but RHS is a '${typeof i.right}'`);break;case"enum":if("string"!=typeof i.right)throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a string but RHS is a '${typeof i.right}'`);let u=e.enumDef(n.type);if(!u.isValidValue(i.right))throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to invalid enum value '${i.right}'.
                      Expecting one of ${u.values.join(", ")}`);break;case"bool":if("boolean"!=typeof i.right)throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a boolean but RHS is a '${typeof i.right}'`);break;case"datetime":case"date":if(!(i.right instanceof Date))throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a date but RHS is a '${typeof i.right}'`);break;default:throw new o.Z((0,l.oneLine)`
                    Filter on field '${i.left}' in object type '${t.name}' has unexpected type ${n.type.kind}`)}else if([">","<",">=","<="].indexOf(i.op)>-1)throw new o.Z((0,l.oneLine)`
                  Cannot filter on field '${i.left}' in object type '${t.name}'. '${i.op}' filter
                  on type '${n.type.kind}' is not is not supported for null values.`);break;case"in":if(["list","map","object","objects","date","datetime"].indexOf((n=N(i)).type.kind)>-1)throw new o.Z((0,l.oneLine)`
              Cannot filter on field '${i.left}' in object type '${t.name}'. Filter on type
              ${n.type.kind} is not supported.`);if((0,s.U4)(i.right)){if("list"!==(r=k(i)).type.kind)throw new o.Z((0,l.oneLine)`
                Cannot filter on field '${i.left}' in object type '${t.name}' because
                argument ${i.right.ref} has invalid type ${r.type.kind}`);if(!(0,a.BD)(r.type.ofType,n.type))throw new o.Z((0,l.oneLine)`
                Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                LHS is a '${n.type.kind}' but RHS is a list of '${r.type.ofType.kind}'`)}else if(i.right.length>0)switch(n.type.kind){case"int":case"float":if("number"!=typeof i.right[0])throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a number but RHS is a list of ${typeof i.right[0]}`);break;case"string":if("string"!=typeof i.right[0])throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a string but RHS is a list of ${typeof i.right[0]}`);break;case"enum":if("string"!=typeof i.right[0])throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a string but RHS is a list of ${typeof i.right[0]}`);let h=e.enumDef(n.type);for(let e of i.right)if(!h.isValidValue(e))throw new o.Z((0,l.oneLine)`
                        Cannot filter on field '${i.left}' in object type '${t.name}' due to invalid enum value '${e}'.
                        Expecting one of ${h.values.join(", ")}`);break;case"bool":if("boolean"!=typeof i.right[0])throw new o.Z((0,l.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a boolean but RHS is a list of ${typeof i.right[0]}`);break;default:throw new o.Z((0,l.oneLine)`
                    Filter on field '${i.left}' in object type '${t.name}' has unexpected type ${n.type.kind}`)}break;case"or":case"and":i.expressions.map(e=>M(e))}};for(let e in M(this.filter),this.resolver&&!((null==(i=this.resolver.queryParams)?void 0:i.userId)&&(0,s.U4)(this.resolver.queryParams.userId))&&this.throwFieldError(t,`uses resolver and it doesn't define userId in its queryParams attribute.
      This is required. Please choose one of the following options and add to queryParams:
      1. If current userId comes from viewArgs, e.g. session('userId'):
         queryParams: { userId: fieldArg('userId') }
         and add an field arg to ${this.name} object field. When using it in views, fill the arg with session('userId').
      2. If current userId can come from parent object:
         queryParams: { userId: parent('the_user_id_field_name') }
      `),(null==(n=this.resolver)?void 0:n.queryParams)||{}){let i=null==(r=this.resolver)?void 0:r.queryParams[e];i&&(0,s.U4)(i)&&("field"===i.type&&((0,s.PK)(this.args,i.ref)||this.throwFieldError(t,`uses argument ${i.ref}' in its resolver config but does not declare it`),j.add(i.ref)),"parent"!==i.type||t.fields.get(i.ref)||this.throwFieldError(t,`refers to unknown parent field '${i.ref}' in its resolver config`))}if((null==(u=this.resolver)?void 0:u.realtimePolicy.type)==="RedisPubsub")for(let e of(null==(h=this.resolver)?void 0:h.realtimePolicy.channelPostfix)||[])(0,s.U4)(e)&&("field"===e.type&&((0,s.PK)(this.args,e.ref)||this.throwFieldError(t,`uses argument '${e.ref}' in its resolver config but does not declare it`),j.add(e.ref)),"parent"!==e.type||t.fields.get(e.ref)||this.throwFieldError(t,`refers to unknown parent field '${e.ref}' in its resolver config`));if((null==(c=this.pagination)?void 0:c.firstPageSize)&&(0,s.U4)(null==(f=this.pagination)?void 0:f.firstPageSize)){let e=(0,s.PK)(this.args,null==(p=this.pagination)?void 0:p.firstPageSize.ref);e||this.throwFieldError(t,`uses argument '${null==(g=this.pagination)?void 0:g.firstPageSize.ref}' in its pagination config but does not declare it`),"int"!==e.type.kind&&this.throwFieldError(t,`uses argument '${null==(y=this.pagination)?void 0:y.firstPageSize.ref}' in its pagination config but it's not int type. It's ${e.type.kind}`),j.add(null==(m=this.pagination)?void 0:m.firstPageSize.ref)}if((null==(b=this.pagination)?void 0:b.selectedCursorColumn)&&(0,s.U4)(null==(v=this.pagination)?void 0:v.selectedCursorColumn)){let e=(0,s.PK)(this.args,null==(w=this.pagination)?void 0:w.selectedCursorColumn.ref);e||this.throwFieldError(t,`uses argument '${null==(S=this.pagination)?void 0:S.selectedCursorColumn.ref}' in its pagination cursor column config but does not declare it`),"string"!==e.type.kind&&this.throwFieldError(t,`uses argument '${null==(I=this.pagination)?void 0:I.selectedCursorColumn.ref}' in its pagination cursor column config but it's not string type. It's ${e.type.kind}`),j.add(null==(O=this.pagination)?void 0:O.selectedCursorColumn.ref)}if((null==(_=this.pagination)?void 0:_.sortOrder)&&(0,s.U4)(null==(D=this.pagination)?void 0:D.sortOrder)){let e=(0,s.PK)(this.args,null==(E=this.pagination)?void 0:E.sortOrder.ref);e||this.throwFieldError(t,`uses argument '${null==(C=this.pagination)?void 0:C.sortOrder.ref}' in its pagination sort order config but does not declare it`),"string"!==e.type.kind&&this.throwFieldError(t,`uses argument '${null==(R=this.pagination)?void 0:R.sortOrder.ref}' in its pagination sort order config but it's not string type. It's ${e.type.kind}`),j.add(null==(F=this.pagination)?void 0:F.sortOrder.ref)}for(let e of this.args)if(!j.has(e.name)){if("initialPageSize"===e.name)continue;this.throwFieldError(t,`declares argument '${e.name}' but does not use it`)}}throwFilterError(e,t){throw new o.Z(`filter condition of '${this.name}' of type '${this.type.name}' on '${e.name}' ${t}`)}throwFieldError(e,t){throw new o.Z(`field '${this.name}' of type '${this.type.name}' on '${e.name}' ${t}`)}isResolvable(e){return this.filter||this.resolver||this.embedded&&"root"!==e.name}}function h(e){return"boolean"==typeof e.embedded}},379934:(e,t,i)=>{i.d(t,{Z:()=>f});var s=i(924620),n=i(730629),r=i(320717),o=i(693055),a=i(921814),l=i(60334);class d{constructor(e,t,i){this.computationDef=e,this.context=t;let s={};for(let e in t.viewArgs){let i=t.viewArgs[e];e.startsWith("_nk_")||(s[e]=i)}this.computationId=JSON.stringify([this.objectName,this.fieldName,i,s])}get fieldDef(){return this.computationDef.computedFieldDef}get objectName(){return this.fieldDef.objectDef.name}get fieldName(){return this.fieldDef.name}trackEvent(e,t){var i;null==(i=this.context.tracingContext)||i.trackComputationEvent(this,e,t)}}class u{constructor(e,t,i,s,n,r,o){this.parent=e,this.computedFieldDef=t,this.fieldArgs=i,this.viewArgs=s,this.optional=o;let l=this.computedFieldDef.name;(0,a.Oh)([...r,l],{...this.fieldArgs,...this.dummyArgs(e.objectDef)},this.computedFieldDef.args,this.viewArgs,!0,n)}dummyArgs(e){if(e.naturalKey){let t={};return Array.from(e.naturalKey).forEach(i=>{let s=e.fields.get(i);switch(s.type.kind){case"string":t["_nk_"+i]="";break;case"bigint":t["_nk_"+i]="0";break;case"uuid":t["_nk_"+i]="00000000-0000-0000-0000-000000000000";break;case"int":case"float":t["_nk_"+i]=0;break;case"bool":t["_nk_"+i]=!1;break;case"enum":case"list":case"map":t["_nk_"+i]=[];break;default:throw Error("this natural key type is unsupported, add a dummy type to this switch for computed fields to work")}}),t}return{_rootId:""}}parameterizedComputation(e,t,i){var s;let n={_rootId:t.id};for(let s in Array.from(i||[]).forEach(e=>{n["_nk_"+e]=t[e]}),this.fieldArgs){let t=this.fieldArgs[s];n[s]=e.substituteFieldArgument(t)}return new d(this,new l.Z(e.sessionArgs,n,{logger:null==(s=e.options)?void 0:s.logger,tracingContext:e.tracingContext,isContextForComputedField:!0,inheritedStats:e.statsCollector}),t.id)}}var h=i(299711);class c{constructor(e,t){this.def=e,this.optional=t}}class f{constructor({parent:e,objectDef:t,objectFieldDef:i,fieldArgs:l,fields:d,viewArgs:p,schema:g,metadata:y,optional:m,context:b,shapeOverride:v}){var w,S,I;for(let s of(this.queries=new Map,this.computations=new Map,this.projectedFields=new Map,this.transmittedFields=new Set,this.aliasMappings=new Map,this.optionalFields=new Set,this._missingOptionalFields=new Map,this.parent=e,this.objectDef=t,this.objectFieldDef=i,this.fieldArgs=l,this.optional=m,this.context=b,this.metadata=y,this.shape=v??g.scopedQueryShape(this.parent.name,this.objectFieldDef.name),i.args))s.name in this.fieldArgs||(void 0!==s.defaultValue?this.fieldArgs={...this.fieldArgs,[s.name]:s.defaultValue}:"initialPageSize"===s.name&&(this.fieldArgs={...this.fieldArgs,initialPageSize:0}));if((null==y?void 0:y.shouldValidateDeprecated)&&this.objectDef.deprecated&&!this.objectDef.deprecated.skipValidation)throw new h.Z(`Object ${this.objectDef.name} was deprecated on ${this.objectDef.deprecated.date} and cannot be used in views. Reason: ${this.objectDef.deprecated.reason}`);for(let e in(0,a.Oh)(this.path,this.fieldArgs,i.args,p,this.isComputedFieldDependency,g),d){let t,i=e,s=d[e],l=!1;s&&(0,n.vX)(s)&&(s.aliasedField&&(i=s.aliasedField,this.aliasMappings.set(i,e)),(l=!!s.optional)&&this.optionalFields.add(i),s=s.fields);let[m,b]=Array.isArray(s)?s:[{},s];try{t=this.objectDef.fieldDef(i)}catch(e){if(e instanceof h.Z){if(l&&(null==y?void 0:y.shouldUseMissingFields)){this._missingOptionalFields.set(i,{fieldName:i,info:e.message}),this.transmittedFields.add(i);continue}throw e}}if(t){if((null==y?void 0:y.shouldValidateDeprecated)&&t.deprecated&&!t.deprecated.skipValidation)throw new h.Z(`The field ${i} was deprecated on ${t.deprecated.date} and cannot be used in views. Reason: ${t.deprecated.reason}`);if(t instanceof r.Z){if(b===n._)throw(0,a.iK)(this.path,`expected nested fields for '${i}' but got '_'`);try{let e=this.isComputedFieldDependency&&"root"===this.name&&"root"===t.name;this.queries.set(i,new f({parent:this,objectDef:g.objectDef(t.type),objectFieldDef:t,fieldArgs:m,fields:b,viewArgs:p,schema:g,metadata:y,optional:l,shapeOverride:e?v:void 0}))}catch(e){if(l&&e instanceof h.Z&&(null==y?void 0:y.shouldUseMissingFields)){this._missingOptionalFields.set(i,{fieldName:i,info:e.message}),this.transmittedFields.add(i);continue}throw e}for(let e of(t.embedded&&this.transmittedFields.add(i),t.filterFields))this.transmittedFields.add(e)}else if(t instanceof o.Z){if(b!==n._)throw(0,a.iK)(this.path,`cannot query field '${i}'`);this.computations.set(i,new u(this,t,m,p,g,this.path,l))}else{if(b!==n._)throw(0,a.iK)(this.path,`cannot query field '${i}'`);this.projectedFields.set(i,new c(t,l)),this.transmittedFields.add(i)}}}"root"!==t.name&&this.transmittedFields.add("id");let{checkCanRead:O}=this.objectFieldDef;if(O){let e={};for(let t in O){if("fieldName"===t)continue;let i=O[t];(0,s.U4)(i)&&this.fieldArgs[i.ref]?e[t]=this.fieldArgs[i.ref]:e[t]=i}let t="canRead";O.fieldName&&(t=O.fieldName.toString()),this.permissionComputation=new u(this,this.objectDef.fieldDef(t),e,p,g,this.path)}for(let e of this.objectFieldDef.dependentFields)this.transmittedFields.add(e);null==(I=null==(S=null==(w=this.context)?void 0:w.options)?void 0:S.logger)||I.debug("VIEW_QUERY_DEF.CREATE",this.debugFields)}isNullable(){return this.objectFieldDef.isNullable()}isList(){return this.objectFieldDef.isList()}get path(){return[...this.parent.path,this.objectFieldDef.name]}get name(){return this.objectDef.name}get missingOptionalFields(){var e;if(!(null==(e=this.metadata)?void 0:e.shouldUseMissingFields))throw Error("invalid missingOptionalFields access with shouldUseMissingFields=false, are you trying to call missingOptionalFields from the Livegraph client? The client should only inspect missing fields via a QueryObserver.");return Array.from(this._missingOptionalFields.values())}get debugFields(){var e;return{parent:this.parent.name,queryReturnType:this.objectDef.name,field:this.objectFieldDef.name,optional:this.optional,queryFields:JSON.stringify(Array.from(this.queries.keys())),projectedBaseFields:JSON.stringify(Array.from(this.projectedFields.keys())),canonicalShapeID:null==(e=this.shape)?void 0:e.id}}dealias(e){return this.aliasMappings.get(e)||e}missingOptionalFieldsForEmbeddedInstance(e){let t=[];for(let i of this.optionalFields.values())void 0===e[i]&&t.push({fieldName:i,info:`optional field '${i}' was missing in instance of object '${this.objectDef.name}'`});return t}projectInstance(e){let t={};if(this.objectFieldDef.embedded)for(let i of this.projectedFields.keys())t[this.dealias(i)]=i in e?e[i]:null;else for(let i of this.projectedFields.keys())t[this.dealias(i)]=e[i];for(let e of this.projectedFields.keys())this.optionalFields.has(e)&&(t[this.dealias(e)]={status:s.wy.Loaded,data:t[this.dealias(e)]});return t}projectResults(e){let t={},i=[...this.projectedFields.keys(),...this.computations.keys(),...this.queries.keys()];for(let s of i){let i=this.dealias(s);i in e?t[i]=e[i]:this.objectFieldDef.embedded&&(t[i]=null)}return t}getMissingProjectedFields(e){let t=[...this.projectedFields.keys(),...this.computations.keys(),...this.queries.keys()],i=[];for(let s of t){let t=this.dealias(s);void 0===e[t]&&i.push(t)}return i}get indexingHint(){if(void 0!==this._indexingHint)return this._indexingHint;if(!this.objectFieldDef.filter)return this._indexingHint=null,null;let e=(e,t)=>{let i=[e=>!!e&&"id"===e.field,e=>!!e&&"string"===this.objectDef.fieldDef(e.field).type.kind,e=>null!==e,e=>!0],s=i.findIndex(t=>t(e)),n=i.findIndex(e=>e(t));return s<=n?e:t},t=i=>"or"===i.type?null:"and"===i.type?i.expressions.map(t).reduce((t,i)=>e(t,i)):"in"===i.type?{field:i.left,values:i.right}:"="===i.op?{field:i.left,values:(0,s.U4)(i.right)?i.right:[i.right]}:null;return this._indexingHint=t(this.objectFieldDef.filter)||null,this._indexingHint}get isComputedFieldDependency(){return this.parent.isComputedFieldDependency}}},498142:(e,t,i)=>{i.d(t,{Z:()=>a,o:()=>l});var s=i(299711),n=i(846316),r=i(320717),o=i(693055);class a{constructor(e){this.name=e.name,this.type=e.type,this.nullable=e.nullable||!1,this.deprecated=e.deprecated}validate(e,t){if("enum"===this.type.kind&&!e.enums.has(this.type.name))throw new s.Z((0,n.oneLine)`
        field '${this.name}' of object type '${t.name}' refers to undefined
        enum type '${this.type.name}'`)}}function l(e){return!(0,r.T)(e)&&!(0,o.M)(e)}},266515:(e,t,i)=>{i.d(t,{Z:()=>c});class s{constructor(e){this.name=e.name,this.values=e.values,this.annotations=e.annotations}isValidValue(e){return this.values.some(t=>"string"==typeof t?e===t:e===t[1])}validate(e){}}var n=i(126220),r=i(846316),o=i(924620),a=i(235459),l=i(299711),d=i(921814);class u{constructor(e){this.args=e&&e.args||[{name:"userId",type:{kind:"string"},nullable:!0}],this.args.find(e=>"sessionId"===e.name)||this.args.push({name:"sessionId",type:{kind:"string"},nullable:!0}),(0,d.iU)("Session definition ",this.args),this.validateUserIdArgument(this.args)}validateUserIdArgument(e){for(let t of e)if("userId"===t.name){if(!["string","bigint"].includes(t.type.kind))throw new l.Z((0,r.oneLine)`
            Session definition error: 'userId' arg must be of type 'string' or 'bigint'
          `);return}throw new l.Z((0,r.oneLine)`
      Session definition error: 'userId' arg of type 'string' or 'bigint' is required
    `)}parseAndValidateArguments(e,t){let i={userId:null,sessionId:""};for(let s in e){let n=(0,o.PK)(this.args,s);if(n){let o=(0,a.W)(t,n,e[s]);if("error"===o.type)throw new l.Z((0,r.oneLine)`
            Session argument error: '${o.argName}' '${o.msg}'`);i[s]=o.parsedValue}else throw new l.Z((0,r.oneLine)`
          Session argument error: '${s}' is not a valid argument
          name`)}for(let t of this.args)if(!(t.name in e))throw new l.Z((0,r.oneLine)`
          Session argument error: the argument '${t.name}' is missing`);return i}}class h{constructor(e){this.typeConversionExemptions={viewArg:{},filterArg:{},computedFieldArg:{}},this.populateTypeConversions(e),this.allowAllConversions=(null==e?void 0:e.allowAllExemptions)??!0}populateTypeConversions(e){if(!(null==e?void 0:e.exemptions))return;let t=JSON.parse(JSON.stringify(null==e?void 0:e.exemptions));for(let i in null==e?void 0:e.exemptions)for(let s in t[i])for(let n in t[i][s])t[i][s][n]=new Set(e.exemptions[i][s][n]);this.typeConversionExemptions=t}isTypeConversionExempted(e,t,i,s){try{return this.allowAllConversions||this.typeConversionExemptions[e][t][i].has(s)}catch(e){return!1}}}class c{constructor(e,t){for(let i of(this.schema=e,this.queryShapeIdResolver=t,this.session=new u(e.session),this.legacyConfig=new h(e.legacyConfigDef),this.enums=new Map,e.enums||[]))this.enums.set(i.name,new s(i));for(let t of(this.objects=new Map,e.objects))this.objects.set(t.name,new n.Z(t));for(let t of e.objects)this.objects.get(t.name).constructComputedFields(t,this);this.enums.forEach(e=>e.validate(this)),this.objects.forEach(e=>e.validate(this)),this.version=e.version||"0.0.0"}typeWithKind(e,t){let i=this[e].get(t);if(i)return i;throw new l.Z(`${e} with name '${t}' isn't present in schema`)}enumDef({name:e}){return this.typeWithKind("enums",e)}objectDef({name:e}){return this.typeWithKind("objects",e)}scopedQueryShape(e,t){var i;return null==(i=this.queryShapeIdResolver)?void 0:i.shapeFromParent(e,t)}scopedQueryShapeFromRoot(e){var t;return null==(t=this.queryShapeIdResolver)?void 0:t.shapeFromRoot(e)}toJSON(){return this.schema}}},921814:(e,t,i)=>{i.d(t,{BD:()=>u,Oh:()=>l,iK:()=>a,iU:()=>d});var s=i(846316),n=i(299711),r=i(924620),o=i(235459);function a(e,t){return new n.Z(`${e.join(".")} - ${t}`)}function l(e,t,i,n,l,d){for(let h in t){let c=t[h],f=(0,r.PK)(i,h);if(!f)throw a(e,(0,s.oneLine)`
        Found arg with name '${h}', but the field doesn't accept an
        arg with this name`);if((0,r.U4)(c)){let t=(0,r.PK)("session"===c.type?d.session.args:n,c.ref);if(!t)throw a(e,(0,s.oneLine)`
          Found arg with name '${c.ref}', but there isn't a declaration of
          an arg with this name`);if(t.nullable&&!f.nullable)throw a(e,(0,s.oneLine)`
          Query arg '${c.ref}' is nullable but used as a field argument that
          is not nullable`);if(!u(t.type,f.type)&&!d.legacyConfig.isTypeConversionExempted(l?"computedFieldArg":"viewArg",t.type.kind,f.type.kind,e.join(".")+"."+t.name))throw a(e,(0,s.oneLine)`
          Query arg '${t.name}' of type ${t.type.kind} is being
          used for field argument '${f.name}' of type
          ${f.type.kind}`)}else{let t=(0,o.W)(d,f,c);if("error"===t.type)throw a(e,`Arg '${t.argName}': ${t.msg}`)}}for(let{name:s}of i)if(void 0===t[s])throw a(e,`Argument '${s}' is required`)}function d(e,t){let i=new Set;for(let{name:r}of t){if(i.has(r))throw new n.Z((0,s.oneLine)`
        ${e} declares multiple arguments named '${r}'
      `);i.add(r)}}function u(e,t){return"map"===e.kind&&"map"===t.kind?u(e.valueType,t.valueType):"list"===e.kind&&"list"===t.kind?u(e.ofType,t.ofType):"object"===e.kind&&"object"===t.kind||"objects"===e.kind&&"objects"===t.kind?e.name===t.name:e.kind===t.kind||"date"===e.kind&&"datetime"===t.kind||"bigint"===e.kind&&"string"===t.kind||"uuid"===e.kind&&"string"===t.kind}},656762:(e,t,i)=>{i.d(t,{Z:()=>c});var s=i(924620),n=i(379934),r=i(235459),o=i(320717),a=i(299711),l=i(921814),d=i(846316);let u=e=>({type:"ok",value:e,unwrap:()=>e,unwrapErr(){throw Error(`Expected Err, found Ok(${e})`)}}),h=e=>({type:"err",error:e,unwrap(){if(e instanceof Error)throw e;throw Error(`Expected Ok, found Err(${e})`)},unwrapErr:()=>e});class c{constructor(e,t,i,s,r,a,d){this.name=e,this.metadata=r,this.context=a,this.rootShapeOverride=d,this.annotations=t.annotations,this.dslDef=Object.freeze(JSON.parse(JSON.stringify(t))),this.fields=t.fields,this.root=new n.Z({parent:this,objectDef:i,objectFieldDef:new o.Z({name:e,type:{kind:"object",name:i.name}}),fieldArgs:{},fields:t.fields,viewArgs:t.args||[],schema:s,metadata:{shouldValidateDeprecated:!!(null==r?void 0:r.shouldValidateDeprecated),shouldUseMissingFields:!!(null==r?void 0:r.shouldUseMissingFields)},context:a,shapeOverride:d}),this.args=t.args||[],this.props=t.props,this.schema=s,(0,l.iU)(`View '${e}'`,this.args)}get path(){var e;return this.isComputedFieldDependency?[null==(e=this.metadata)?void 0:e.computedObjectName]:[]}get isComputedFieldDependency(){var e;return!!(null==(e=this.metadata)?void 0:e.isComputedFieldDependency)}_parseAndValidateArguments(e,t){let i={};for(let n in e){if("__requestId"===n){i[n]=e[n];continue}let o=e[n],l=(0,s.PK)(this.args,n);if(!l)return h(new a.Z((0,d.oneLine)`
View '${this.name}': argument error: '${n}' is not a valid argument
`));{let e=(0,r.W)(this.schema,l,o,t);if("error"===e.type)return h(new a.Z((0,d.oneLine)`
View '${this.name}': argument error: '${e.argName}' '${e.msg}'`));i[n]=e.parsedValue}}for(let{name:t}of this.args)if(void 0===e[t])return h(new a.Z(`View '${this.name}': Missing argument '${t}'`));return u(i)}parseAndValidateArguments(e){return this._parseAndValidateArguments(e,!0)}validateArguments(e){let t=this._parseAndValidateArguments(e,!1);return"ok"===t.type?u(void 0):h(t.error)}hasStaticQueries(){var e;let t=[this.root];for(;t.length;){let i=t.pop();if((null==(e=i.objectFieldDef.resolver)?void 0:e.realtimePolicy.type)==="Static")return!0;for(let e of i.queries.values()||[])t.push(e)}return!1}}},924620:(e,t,i)=>{function s(e){return null!==e&&"object"==typeof e&&"type"in e}i.d(t,{OE:()=>o,PK:()=>a,Q7:()=>u,U4:()=>s,l4:()=>d,wh:()=>l,wy:()=>h});var n,r,o=((n=o||{}).P0="p0",n.P1="p1",n.P2="p2",n.P3="p3",n);function a(e,t){if(e){for(let i of e)if(i.name===t)return i}return null}function l(e,t){for(let i in e){let s=e[i],n=t[i];if(void 0===s){if(void 0!==n)return!1}else if(s instanceof Array){if(!(n instanceof Array)||!function(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(s,n))return!1}else if(s!==n)return!1}return Object.keys(e).length===Object.keys(t).length}class d extends Error{}class u extends Error{constructor(e){super(),this.errorCode=e}}var h=((r=h||{}).Error="error",r.Loaded="loaded",r)},230596:(e,t,i)=>{i.d(t,{FP:()=>y,IH:()=>c,Qk:()=>d,TM:()=>p,Wg:()=>m,ZT:()=>h,_v:()=>f,_w:()=>u,hu:()=>o,iv:()=>l,jx:()=>r,uy:()=>n,vE:()=>a});var s=i(924620);function n(){let e,t;let i=new Promise((i,s)=>{e=i,t=s});return[i,e,t]}function r(e,t){if(!e){let e=Error(t);setTimeout(()=>{throw e})}}function o(e,t){if(!e)throw Error(t||"assertion failure")}function a(e){}function l(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return r(!1,"Comparison of embedded objects failed"),!1}}function d(e,t,i){var s,n;for(let r of i){let i=r[0];if("datetime"===r[1].def.type.kind){if((null==(s=e[i])?void 0:s.getTime())!==(null==(n=t[i])?void 0:n.getTime()))return!1}else if(e[i]!==t[i])return!1}return!0}function u(e,t){if(e.length!==t.length)return!1;let i=!0;return e.forEach(e=>{t.find(t=>t.fieldName===e.fieldName&&t.info===e.info)||(i=!1)}),i}function h(){}function c(e){let t=!1;return function(){t||(t=!0,e())}}function f(e){return new Promise(t=>setTimeout(t,e))}function p(e,t){let i=Error();setTimeout(()=>{try{e()}catch(e){throw e.cause=i,e}},t)}class g extends Error{}class y{constructor(e){this.config=e,y.validateConfig(e),this.timeoutMs=e.backoffInitialMs*(1+this.jitter()),this.count=0}nextBackoffMs(){if(!this.shouldAttempt())throw new g("Max attempt exhausted");let e=this.timeoutMs;return this.timeoutMs*=this.config.backoffMultiplier+this.jitter(),this.timeoutMs=Math.min(this.timeoutMs,this.config.backoffMaxMs),this.count+=1,e}shouldAttempt(){return void 0===this.config.maxAttempt||this.config.maxAttempt>this.count}reset(){this.timeoutMs=this.config.backoffInitialMs,this.count=0}attemptsSoFar(){return this.count}jitter(){return(Math.random()-.5)*this.config.spreadMultiplier}static validateConfig(e){if(e.backoffInitialMs<=0)throw Error("backoffInitialMs must be > 0");if(e.backoffMaxMs<=0)throw Error("backoffMaxMs must be > 0");if(e.backoffMultiplier<1)throw Error("backoffMultiplier must be >= 1");if(e.spreadMultiplier<0||e.spreadMultiplier>=2)throw Error("To ensure positive initial timeout, spreadMultiplier must be between 0 (inclusive) and 2 (exclusive)");if(e.backoffMultiplier-.5*e.spreadMultiplier<1)throw Error("To ensure positive and non-shrinking exponential timeout, increase backoffMultiplier or decrease spreadMultiplier such that (backoffMultiplier - 0.5 * spreadMultiplier) >= 1")}}function m(e,t){return e.status===s.wy.Error?t:e.data}},31e3:(e,t,i)=>{i.d(t,{h:()=>s});function s(e){let t=[],i=e=>{if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0===e)return;if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(let s=0;s<e.length;s++)s&&(t+=","),t+=i(e[s])||"null";return t+"]"}if(null===e)return"null";if(-1!==t.indexOf(e))throw TypeError("Converting circular structure to JSON");let s=t.push(e)-1,n=Object.keys(e).sort(),r="";for(let t of n){let s=i(e[t]);s&&(r&&(r+=","),r+=JSON.stringify(t)+":"+s)}return t.splice(s,1),"{"+r+"}"};return i(e)}},299711:(e,t,i)=>{i.d(t,{Z:()=>s});class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}},520578:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveGraphClient=t.unwrap=t.OptionalStatus=t.session=t.viewArg=t.fieldArg=t._=t.parent=t.ClientViewRegistry=t.Schema=t.DSL=t.argumentsEqual=t.ClientSession=t.Client=void 0;let a=o(i(173206));t.Client=a.default;let l=o(i(127116));t.ClientSession=l.default;var d=i(553841);Object.defineProperty(t,"argumentsEqual",{enumerable:!0,get:function(){return d.argumentsEqual}});let u=r(i(922128));t.DSL=u;let h=o(i(804348));t.Schema=h.default;var c=i(735831);Object.defineProperty(t,"ClientViewRegistry",{enumerable:!0,get:function(){return c.ClientViewRegistry}});var f=i(922128);Object.defineProperty(t,"parent",{enumerable:!0,get:function(){return f.parent}}),Object.defineProperty(t,"_",{enumerable:!0,get:function(){return f._}}),Object.defineProperty(t,"fieldArg",{enumerable:!0,get:function(){return f.fieldArg}}),Object.defineProperty(t,"viewArg",{enumerable:!0,get:function(){return f.viewArg}}),Object.defineProperty(t,"session",{enumerable:!0,get:function(){return f.session}});var p=i(553841);Object.defineProperty(t,"OptionalStatus",{enumerable:!0,get:function(){return p.OptionalStatus}});var g=i(598295);Object.defineProperty(t,"unwrap",{enumerable:!0,get:function(){return g.unwrap}});class y extends a.default{optimisticallyCreate(e,t){return this.applyMutations(e,t,"create")}optimisticallyUpdate(e,t){return this.applyMutations(e,t,"update")}optimisticallyDelete(e,t){return this.applyMutations(e,t,"delete")}optimisticallyCreateWithUUID(e,t){return this.applyMutationsWithUUID(e,t,"create")}optimisticallyUpdateWithUUID(e,t){return this.applyMutationsWithUUID(e,t,"update")}optimisticallyDeleteWithUUID(e,t){return this.applyMutationsWithUUID(e,t,"delete")}getIdFromUuid(e,t){return super.getIdFromUuid(e,t)}deprecatedOptimisticallyCreateByView(e,t,i){return this.deprecatedApplyMutationsByView(e,t,i,"create")}deprecatedOptimisticallyUpdateByView(e,t,i){return this.deprecatedApplyMutationsByView(e,t,i,"update")}deprecatedOptimisticallyDeleteByView(e,t,i){return this.deprecatedApplyMutationsByView(e,t,i,"delete")}}t.LiveGraphClient=y},173206:function(e,t,i){var s,n,r=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(n,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveGraphHealthStatus=void 0;let a=i(553841),l=o(i(127116)),d=i(598295),u=i(743399),h=o(i(317708)),c=i(290366),f=i(177875);(s=n||(t.LiveGraphHealthStatus=n={}))[s.CONNECTED=0]="CONNECTED",s[s.DISCONNECTED=1]="DISCONNECTED",s[s.RECONNECTING=2]="RECONNECTING",t.default=class{constructor(e,t,i,s,n,r={}){var o;if(this.args=e,this.viewRegistry=i,this.clientOptions=r,this.transactionId=1,this.syncDelayForDebugging=0,this.syncQueryIds=new Map,this.syncCallbacks=new Map,this.pendingGlobalOptimisticUpdates=new Set,this.globalOptimisticUpdateResolutionCallbacks=[],this.emitter=new u.EventEmitter,this.healthListeners=new Set,this.pendingOptimisticMutationList=[],this.pendingMutationList=[],this.initialSubscriptionMsgBuffer=[],this.session=new l.default(e,t,i,this.emitter,(e,t)=>{this.requestPaginationChange(e,t)},r.enableCrossViewIncompleteInstanceCheck),this.connection=new h.default(s,n,e,this.emitter,r),this.connection.addObserver(this),this.addEventListener(this.healthListener.bind(this)),!r.preloadedViews||!r.preloadedViewArgs)return;for(let e=0;e<(null!==(o=r.preloadedViews.length)&&void 0!==o?o:0);e++)this.session.subscribe(r.preloadedViews[e],r.preloadedViewArgs[e],()=>{})}cleanup(){this.connection.cleanup()}connect(){return r(this,void 0,void 0,function*(){yield this.connection.connect()})}close(){return r(this,void 0,void 0,function*(){yield this.connection.closeWithoutReconnecting()})}addEventListener(e){return this.emitter.addListener(e)}removeEventListener(e){return this.emitter.removeListener(e)}healthListener(e){if("CONNECTION_STATE"===e.type){let t=this.getHealthStatusForConnectionState(e.state);for(let e of this.healthListeners)e(t)}}getHealthStatus(){return this.getHealthStatusForConnectionState(this.connection.getState())}getHealthStatusForConnectionState(e){return"connected"===e.type?n.CONNECTED:"connecting"===e.type?n.RECONNECTING:n.DISCONNECTED}addHealthListener(e){return this.healthListeners.add(e),()=>this.removeHealthListener(e)}removeHealthListener(e){this.healthListeners.delete(e)}handleMessage(e){switch(e.messageType){case"authSuccess":if(this.args.sessionId=e.sessionId,!this.connection.ready()){(0,d.assertWithoutCrashingOnClient)(!1,"Expected connection to be in ready state");break}let t=1===this.connection.getConnectionCount();if(this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg&&t)break;for(let{viewRef:e,args:i,traceId:s}of(this.session.startReconnectionStateForPaginationQueries(),this.session.uniqueSubscriptions()))this.requestSubscription(e,i,t?"initial_load":"refresh",s);for(let e of(this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg&&(this.initialSubscriptionMsgBuffer=[]),this.syncCallbacks.keys()))this.requestSync(e,this.syncQueryIds.get(e));break;case"pendingMutations":this.hasUnresolvedGlobalOptimisticUpdates()?(this.globalOptimisticUpdateResolutionCallbacks.push(()=>{this.session.applyMutations(e.mutations)}),this.pendingMutationList.push(e.mutations),this.session.resolvePendingServerIdList(e.mutations)):this.session.applyMutations(e.mutations);break;case"synced":let i=this.syncCallbacks.get(e.transactionId);i&&i();break;case"viewSubscriptionFailed":this.emitter.emit({type:"ERROR",error:new a.ViewSubscriptionError(e.errorCode)}),this.session.cleanupFailedSubscribeView(e.liveViewKey)}}onConnectionOpen(){if(this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg){for(let e of this.initialSubscriptionMsgBuffer)this.requestSubscription(e.view,e.args,e.loadType,e.traceId);this.initialSubscriptionMsgBuffer=[]}}requestSubscription(e,t,i,s){let n={messageType:"subscribe",viewName:e._name,viewHash:e._hash,loadType:i,args:t,traceId:s};if(this.connection.ready())this.connection.send(n),this.emitter.emit({type:"SUBSCRIBE_VIEW_SERVER",view:e,args:t,traceId:s});else{let n=0===this.connection.getConnectionCount();this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg&&n&&this.initialSubscriptionMsgBuffer.push({view:e,args:t,loadType:i,traceId:s})}}requestPaginationChange(e,t){this.connection.ready()&&this.connection.send({messageType:"paginationChangeMessage",operationType:"LoadNext",queryId:e,count:t})}subscribeAndUnsubscribeInBatches(e,t,i,s){for(let n of(i.unsubscribeStaleSubscriptions(t),t)){let r=i.getStableArgs(n);if(i.subscriptions.has(r))continue;let o=this.subscribeBase(e,r,e=>{o.lastResult=e,i.recomputeViewResult(t,s)});i.subscriptions.set(r,o)}i.recomputeViewResult(t,s)}subscribeBase(e,t,i,s){let n=this.session.hasActiveSubscriptions(e._name,t),r=this.session.subscribe(e,t,i,s);return n||(this.emitter.emit({type:"SUBSCRIBE_VIEW_CLIENT",view:e,args:t,traceId:s}),this.requestSubscription(e,t,"initial_load",s)),r}getUnsubscribeFunction(e){return()=>{e.clientUnsubscribed=!0,(0,d.setTimeoutCaptureStackTrace)(()=>{e.unsubscribe(),!this.session.hasActiveSubscriptions(e.view._name,e.args)&&this.connection.ready()&&(this.connection.send({messageType:"unsubscribe",viewName:e.view._name,args:e.args}),this.emitter.emit({type:"UNSUBSCRIBE_VIEW_SERVER",view:e.view,args:e.args}))},2e3)}}subscribe(e,t,i,s){var n;let r=t;(null===(n=this.viewRegistry.get(e._name))||void 0===n?void 0:n.hasStaticQueries())&&(r=Object.assign(Object.assign({},t),{__requestId:(0,c.v4)()}));let o=this.subscribeBase(e,r,i,s);return this.getUnsubscribeFunction(o)}hasUnresolvedGlobalOptimisticUpdates(){return this.pendingGlobalOptimisticUpdates.size>0}handleBeforeOptimisticUpdateApplied(e){this.pendingGlobalOptimisticUpdates.add(e)}handleAfterOptimisticUpdateResolved(e){if(this.pendingGlobalOptimisticUpdates.delete(e),!this.hasUnresolvedGlobalOptimisticUpdates()){let e=this.globalOptimisticUpdateResolutionCallbacks;this.globalOptimisticUpdateResolutionCallbacks=[],this.emitter.emit({type:"MUTATIONS_BLOCKED_ON_OPTIMISTIC_UPDATE",count:e.length}),this.session.batchMutations(()=>{for(let t of e)t()}),this.checkMissingMutations()}}checkUUIDExistenceInPendingMutation(e,t){for(let i of t)for(let t in i)for(let s in i[t].instances){let n=i[t].instances[s];if(e===n.uuid)return!0}return!1}checkMissingMutations(){for(let e of this.pendingOptimisticMutationList)for(let t in e)for(let i in e[t]){let s=e[t][i];(null==s?void 0:s.uuid)&&(this.checkUUIDExistenceInPendingMutation(s.uuid,this.pendingMutationList)?this.emitter.emit({type:"PENDING_MUTATION_EXISTENCE",exist:!0,objectName:t,optimisticInstance:s}):this.emitter.emit({type:"PENDING_MUTATION_EXISTENCE",exist:!1,objectName:t,optimisticInstance:s}))}this.pendingOptimisticMutationList=[],this.pendingMutationList=[]}applyMutations(e,t,i){return r(this,void 0,void 0,function*(){let s;let n=this.transactionId;this.transactionId++;let r=this.session.applyShadowMutations(n,e,i);this.handleBeforeOptimisticUpdateApplied(n);try{s=yield t}catch(t){throw this.session.removeShadowMutations(n,e,!1),this.handleAfterOptimisticUpdateResolved(n),t}let o=!1;try{yield this.sync(n,r),o=!0}finally{this.pendingOptimisticMutationList.push(e),this.globalOptimisticUpdateResolutionCallbacks.push(()=>{this.session.removeShadowMutations(n,e,o)}),this.handleAfterOptimisticUpdateResolved(n)}return s})}waitForServerSideObjectsWithUUIDs(e){let t=[];for(let i in e)for(let s in e[i])t.push(this.getIdFromUuid(i,s));return Promise.all(t)}applyMutationsWithUUID(e,t,i){return r(this,void 0,void 0,function*(){let s;let n=this.transactionId;this.transactionId++;let r=this.session.applyShadowMutationsWithUUID(n,e,i);this.handleBeforeOptimisticUpdateApplied(n);try{s=yield t}catch(t){throw this.session.removeShadowMutationsWithUUID(n,e,!1),this.handleAfterOptimisticUpdateResolved(n),t}let o=!1;try{"create"===i?(this.emitter.emit({type:"WAIT_SERVER_OBJECTS_STARTED",mutations:e}),yield this.waitForServerSideObjectsWithUUIDs(e),yield(0,d.sleep)(this.syncDelayForDebugging),this.emitter.emit({type:"WAIT_SERVER_OBJECTS_ENDED",mutations:e})):yield this.sync(n,r),o=!0}finally{this.pendingOptimisticMutationList.push(e),this.globalOptimisticUpdateResolutionCallbacks.unshift(()=>{this.session.removeShadowMutationsWithUUID(n,e,o)}),this.handleAfterOptimisticUpdateResolved(n)}return s})}getIdFromUuid(e,t){return this.session.getIdFromUuid(e,t)}deprecatedApplyMutationsByView(e,t,i,s){return r(this,void 0,void 0,function*(){let n;let r=this.transactionId;this.transactionId++,this.session.applyShadowMutationsByView(e._name,r,t,s);try{n=yield i}catch(i){throw this.session.removeShadowMutationsByView(e._name,r,t,!1),i}let o=!1;try{let e=[];for(let i of this.session.getAllQueryIds()){let s=(0,f.queriedObjectType)(this.session.schema,i);s.name in t&&e.push(i)}yield this.sync(r,e),o=!0}finally{this.session.removeShadowMutationsByView(e._name,r,t,o)}return n})}requestSync(e,t){this.connection.ready()&&(this.connection.send({messageType:"sync",transactionId:e,queryIds:t}),this.emitter.emit({type:"SYNC_STARTED",transactionId:e}))}sync(e=this.transactionId++,t){return r(this,void 0,void 0,function*(){let[i,s]=(0,d.promiseResolveReject)();this.syncCallbacks.set(e,s),void 0!==t&&this.syncQueryIds.set(e,t),this.requestSync(e,t),yield i,this.syncDelayForDebugging&&(yield(0,d.sleep)(this.syncDelayForDebugging)),this.syncCallbacks.delete(e),this.syncQueryIds.delete(e),this.emitter.emit({type:"SYNC_COMPLETED",transactionId:e})})}get debug(){return Object.assign({subscriptions:this.session.getViewSubscriptionsForDebugging(),prettyPrintLiveViewTree:e=>this.session.prettyPrintLiveViewTree(e),setOptimisticUpdateResolutionDelay:e=>this.syncDelayForDebugging=e},this.connection.debug)}}},127116:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(n,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let r=i(598295),o=i(883359),a=n(i(641661)),l=n(i(549351)),d=n(i(71438)),u=i(997994),h=n(i(284434)),c=n(i(199932)),f=n(i(443517)),p=i(574902),g=i(126582);class y{constructor(e){this.emitter=e}criticalAndPage(e){}error(e){}warn(e){}info(e){}debug(e,...t){switch(e){case"VIEW_QUERY_NODE.ADD_RESULT":case"VIEW_QUERY_NODE.UPDATE_RESULT":case"VIEW_QUERY_NODE.REMOVE_RESULT":this.emitter.emit({type:e,queryId:t[0],instance:t[1]});break;case"VIEW_QUERY_NODE.INITIAL_RESULT":this.emitter.emit({type:e,queryId:t[0],instances:t[1]});break;case"CROSS_VIEW_INCOMPLETE_INSTANCES":this.emitter.emit({type:e,queryInfo:t[0],missingProjectedFields:t[1],status:t[2]})}}}class m{constructor(e,t,i,s,n,r){for(let[o,d]of(this.args=e,this.schema=t,this.viewRegistry=i,this.emitter=s,this.onPaginationChange=n,this.enableCrossViewIncompleteInstanceCheck=r,this.viewSubscriptions=new Map,this.failedViewSubscriptions=new Map,this.nextSubscriptionId=1,this.orderedMutationsByView=new Map,this.paginationQueryNodeMap=new Map,this.stores={},this.isInMutationBatch=!1,this.shouldNotifyOnMutationBatchCompletion=!1,this.contextLogger=new y(this.emitter),t.objects))this.stores[o]={queries:new a.default(d,this.emitter),computations:new l.default(d)}}getAllQueryIds(){let e=[];for(let t in this.stores){let i=this.stores[t];i&&e.push(...i.queries.getAllQueryIds())}return e}resolvePendingServerIdList(e){for(let t in e){let{instances:i}=e[t],s=this.getStores(t);s&&s.queries.resolvePendingServerIdList(i)}}applyMutations(e){for(let t in this.emitter.emit({type:"SESSION.APPLY_MUTATIONS",mutations:e}),e){let{instances:i,queries:s,computations:n}=e[t],r=this.getStores(t);r&&(r.queries.applyMutations(i,s),r.computations.applyMutations(n))}for(let t in this.notifyObservers(),e){let e=this.getStores(t);e&&e.queries.cleanupOrphans()}}applyShadowMutations(e,t,i){var s;this.emitter.emit({type:"SESSION.APPLY_SHADOW_MUTATIONS",transactionId:e,mutations:t,operationType:i});let n=new Set,o={};for(let[e,t]of this.viewSubscriptions.entries())o[e]=t.activeView().root.result().status;for(let o in t){let a=this.getStores(o);if(!a)continue;let l=t[o];for(let d in t[o]){let t=a.queries.instanceStates.get(d),h=l[d];for(let e in h){let t=null===(s=this.schema.objects.get(o))||void 0===s?void 0:s.fields.get(e);t&&(0,u.isComputedFieldDef)(t)&&console.warn(`Optimistic updates for computed fields are not supported. Optimistically updating computed field '${e}' on object '${o}' may not work`)}if(void 0===t){if("update"===i||"delete"===i){console.warn(`Update triggered on non-existent instance of object type ${o}, id ${d}`);continue}for(let t of((0,r.assert)(h),a.queries.applyShadowMutationAdd(e,d,h)))n.add(t)}else if(null===h)for(let i of a.queries.applyShadowMutationDelete(e,d,t))n.add(i);else for(let i of a.queries.applyShadowMutationUpdate(e,d,t,h))n.add(i)}}let a=[],l=[];for(let[e,t]of this.viewSubscriptions.entries())"loaded"===o[e]&&"loading"===t.activeView().root.result().status&&(a.push(t.activeView().root.queryDef.objectFieldDef.name),l.push(t.activeView().root.getLoadingPathsForDebugging()));return a.length>0&&console.error(`[Livegraph] It seems like an optimistic update did not provide sufficient data to generate a complete view result. This caused the view(s): ${a.join()} to appear as if they had been dropped. If you need to update a subtree(an object and its children objects), the full children instances need to be included. Paths that became loading: ${l}`),this.notifyObservers(),Array.from(n.values())}removeShadowMutations(e,t,i){for(let s in this.emitter.emit({type:"SESSION.REMOVE_SHADOW_MUTATIONS",transactionId:e,mutations:t,success:i}),t){let n=this.getStores(s);n&&n.queries.removeShadowMutations(e,t[s],i)}this.notifyObservers()}applyShadowMutationsWithUUID(e,t,i){var s;this.emitter.emit({type:"SESSION.APPLY_SHADOW_MUTATIONS",transactionId:e,mutations:t,operationType:i});let n=new Set,o={};for(let[e,t]of this.viewSubscriptions.entries())o[e]=t.activeView().root.result().status;for(let o in t){let a=this.getStores(o);if(!a)continue;let l=t[o];for(let d in t[o]){let t=a.queries.instanceStatesByUuid.get(d),h=l[d];for(let e in h){let t=null===(s=this.schema.objects.get(o))||void 0===s?void 0:s.fields.get(e);t&&(0,u.isComputedFieldDef)(t)&&console.warn(`Optimistic updates for computed fields are not supported. Optimistically updating computed field '${e}' on object '${o}' may not work`)}if(void 0===t){if("update"===i||"delete"===i){console.warn(`Update triggered on non-existent instance of object type ${o}, uuid ${d}`);continue}for(let t of((0,r.assert)(h),a.queries.applyShadowMutationAddWithUUID(e,d,h)))n.add(t)}else if("delete"===i)for(let i of a.queries.applyShadowMutationDeleteWithUUID(e,d,t))n.add(i);else if(null!==h)for(let i of a.queries.applyShadowMutationUpdateWithUUID(e,d,t,h))n.add(i)}}let a=[],l=[];for(let[e,t]of this.viewSubscriptions.entries())"loaded"===o[e]&&"loading"===t.activeView().root.result().status&&(a.push(t.activeView().root.queryDef.objectFieldDef.name),l.push(t.activeView().root.getLoadingPathsForDebugging()));return a.length>0&&console.error(`[Livegraph] It seems like an optimistic update did not provide sufficient data to generate a complete view result. This caused the view(s): ${a.join()} to appear as if they had been dropped. If you need to update a subtree(an object and its children objects), the full children instances need to be included. Paths that became loading: ${l}`),this.notifyObservers(),Array.from(n.values())}removeShadowMutationsWithUUID(e,t,i){for(let s in this.emitter.emit({type:"SESSION.REMOVE_SHADOW_MUTATIONS",transactionId:e,mutations:t,success:i}),t){let n=this.getStores(s);n&&n.queries.removeShadowMutationsWithUUID(e,t[s],i)}this.notifyObservers()}getIdFromUuid(e,t){let i=this.getStores(e);if(!i)throw Error(`objectName ${e} doesn't exist`);return i.queries.getIdFromUuid(t)}applyShadowMutationsByView(e,t,i,s){this.emitter.emit({type:"SESSION.APPLY_SHADOW_MUTATIONS_BY_VIEW",viewName:e,transactionId:t,mutations:i,operationType:s});let n=this.orderedMutationsByView.get(e);n||(n=[],this.orderedMutationsByView.set(e,n)),n.push({transactionId:t,mutations:i,type:s,resolved:!1});let r=(0,g.overridesFromMutations)(n);for(let[t,i]of this.viewSubscriptions)i.viewRef._name===e&&i.updateOverrides(r);this.notifyObservers()}removeShadowMutationsByView(e,t,i,s){this.emitter.emit({type:"SESSION.REMOVE_SHADOW_MUTATIONS_BY_VIEW",viewName:e,transactionId:t,mutations:i,success:s});let n=this.orderedMutationsByView.get(e);if(!n){(0,r.assertWithoutCrashingOnClient)(!1,"Removing a shadow mutation from a view that has no mutations.");return}let o=n.findIndex(e=>e.transactionId===t);o>=0&&(s?n[o].resolved=!0:n.splice(o,1));let a=n.filter(e=>!e.resolved);if(0===a.length){for(let[t,i]of this.viewSubscriptions)i.viewRef._name===e&&i.resolveOptimisticUpdates();this.orderedMutationsByView.delete(e)}else{let t=(0,g.overridesFromMutations)(n);for(let[i,s]of this.viewSubscriptions)s.viewRef._name===e&&s.updateOverrides(t)}this.notifyObservers()}subscribe(e,t,i,s){let n;let a=this.viewRegistry.get(e._name);if(!a)throw Error(`View with name ${e._name} not found`);a.validateArguments(t).unwrap();let l=(0,o.liveViewKey)(a.name,t);this.viewSubscriptions.has(l)?n=this.viewSubscriptions.get(l):(this.args.sessionId||this.emitter.emit({type:"SESSION.SUBSCRIBE_BEFORE_SESSION_ID_SET",sessionArgs:this.args,viewName:a.name}),n=new p.ViewSubscriptionObservers(l,e,a,new d.default(this.args,t,{logger:this.contextLogger,isContextForComputedField:!1,paginationQueryNodeMap:this.paginationQueryNodeMap,enableCrossViewIncompleteInstanceCheck:this.enableCrossViewIncompleteInstanceCheck}),this,s),this.viewSubscriptions.set(l,n));let u={id:this.nextSubscriptionId++,view:e,args:t,observer:i,unsubscribe:(0,r.once)(()=>{n.removeSubscription(u),0===n.getSubscriptionObservers().length&&(this.viewSubscriptions.delete(l),n.destroy())}),clientUnsubscribed:!1,lastResult:null};return n.addSubscription(u),m.nextTick(()=>{u.clientUnsubscribed||this.notifyObserver(n,u)}),u}cleanupFailedSubscribeView(e){let t=this.viewSubscriptions.get(e);if(t){for(let e of t.getSubscriptionObservers()){let t={status:"errors",data:null,errors:[]};m.nextTick(()=>{e.clientUnsubscribed||(e.observer(t),e.lastResult=t)})}this.failedViewSubscriptions.set(e,t),this.viewSubscriptions.delete(e)}}hasActiveSubscriptions(e,t){let i=(0,o.liveViewKey)(e,t),s=this.viewSubscriptions.get(i);return!!s&&s.getSubscriptionObservers().length>0}uniqueSubscriptions(){let e=[];for(let[t,i]of this.failedViewSubscriptions.entries())this.viewSubscriptions.has(t)||e.push({viewRef:i.viewRef,args:i.viewArgs()});for(let t of(this.failedViewSubscriptions.clear(),this.viewSubscriptions.values()))e.push({viewRef:t.viewRef,args:t.viewArgs(),traceId:t.traceId});return e}startReconnectionStateForPaginationQueries(){for(let e of this.paginationQueryNodeMap.values())e.startReconnectionState()}subscribeQuery(e,t){this.emitter.emit({type:"SESSION.SUBSCRIBE_QUERY",query:e});let i=this.getStores(e.objectName);return i?i.queries.subscribe(e,t):()=>{}}requestPaginationChange(e,t){this.onPaginationChange(e.queryId,t),this.notifyObservers()}subscribeComputation(e,t){this.emitter.emit({type:"SESSION.SUBSCRIBE_COMPUTATION",computation:e});let i=this.getStores(e.objectName);return i?i.computations.subscribe(e,t):()=>{}}batchMutations(e){this.isInMutationBatch=!0,this.shouldNotifyOnMutationBatchCompletion=!1;try{e()}finally{this.isInMutationBatch=!1,this.shouldNotifyOnMutationBatchCompletion&&this.notifyObservers()}}notifyObservers(){if(this.isInMutationBatch){this.shouldNotifyOnMutationBatchCompletion=!0;return}for(let e of this.viewSubscriptions.values())for(let t of e.getSubscriptionObservers())this.notifyObserver(e,t)}notifyObserver(e,t){var i;let s=e.activeView().result();t.lastResult!==s&&((null===(i=t.lastResult)||void 0===i?void 0:i.status)!=="loaded"||"loading"!==s.status)&&(this.emitter.emit({type:"SESSION.NOTIFY_OBSERVERS",view:e.viewRef,args:e.viewArgs(),result:s,subscriptionId:t.id}),t.clientUnsubscribed||(t.observer(s),t.lastResult=s))}getStores(e){let t=this.stores[e];return t||(this.emitter.emit({type:"SESSION.UNEXPECTED_OBJECT_NAME",objectName:e}),null)}static nextTick(e){setTimeout(e,0)}static tick(){return s(this,void 0,void 0,function*(){return new Promise(e=>{this.nextTick(()=>{e()})})})}getViewSubscriptionsForTesting(){return this.viewSubscriptions}getViewSubscriptionsForDebugging(){let e={};for(let[t,i]of this.viewSubscriptions.entries()){let s=i.activeView().root.result();"loading"===s.status&&(s=Object.assign(Object.assign({},s),{loadingPaths:i.activeView().root.getLoadingPathsForDebugging()})),e[t]=s}return e}prettyPrintLiveViewTree(e){let t="",i=null;if("string"==typeof e){if(!this.viewSubscriptions.has(e)){let e=[...this.viewSubscriptions.keys()].join("\n").replace(/"/g,'\\"');throw Error(`Subscription key not found, possible options: 
${e}`)}t=e,i=this.viewSubscriptions.get(t).activeView().root}else if(e instanceof h.default){let s=e.parent;t=s.key,i=e}else throw Error("Please enter a subscription key or a LiveViewInstanceNode");let s=`Logging LiveView tree for subscription: ${t} 
View Name: ${i.queryDef.objectFieldDef.name} 
`,n=[[i,0]];for(;n.length>0;){let[e,t]=n.pop();if(s+="  ".repeat(t),e instanceof h.default){e.children.forEach(e=>{n.push([e,t+1])});let i=e.instance.id;s+=`I: ${i||"Root Instance"} 
`}else if(e instanceof c.default){e.children.forEach(e=>{n.push([e,t+1])});let i=e.query.queryDef,r=[],o=e.query.context.viewArgs;o&&Object.keys(o).forEach(e=>{r.push(`${i.objectDef.name}.${e} = ${o[e]}`)}),s+=`Q: ${i.objectFieldDef.name} `,r.length>0?s+=`args:(${r.join()})
`:s+=`(${i.objectDef.name})
`}else if(e instanceof f.default){let t=e.result();"loaded"===t.status?s+=`C: ${e.fieldName} = ${t.data} 
`:s+=`C: ${e.fieldName} is loading 
`}}return s}}t.default=m},549351:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});let s=i(598295),n=i(764849);t.default=class{constructor(e){this.objectDef=e,this.states=new n.DefaultMap(()=>({state:{type:"loading"},observers:new Set}))}applyMutations(e){for(let t in e){let i=e[t],s=this.states.entry(t).orDefault();if("error"in i)s.state={type:"failed",errors:[{code:"computedFieldError",path:["computedFieldFunction"],error:Error(i.error.message)}]};else{let{value:e}=i,{fieldName:t}=i;this.objectDef.fields.has(t)&&(e=this.objectDef.readPlainObjectField(t,e),s.state={type:"loaded",value:e})}for(let e of s.observers.values())"loaded"===s.state.type?e.onUpdateResult(s.state.value):"failed"===s.state.type&&e.onErrors(s.state.errors)}}subscribe({computationId:e},t){let i=this.states.entry(e).orDefault();return(0,s.assert)(!i.observers.has(t)),i.observers.add(t),"loaded"===i.state.type?t.onUpdateResult(i.state.value):"failed"===i.state.type&&t.onErrors(i.state.errors),()=>{i.observers.delete(t),0===i.observers.size&&this.states.delete(e)}}}},317708:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(n,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});let n=i(553841),r=i(598295),o=["AWSALBTG","AWSALBTGCORS","AWSALB","AWSALBCORS"],a={backoffInitialMs:250,backoffMaxMs:12e4,backoffMultiplier:2,spreadMultiplier:.3};t.default=class{constructor(e,t,i,s,n={}){this.url=e,this.wsImpl=t,this.args=i,this.emitter=s,this.clientOptions=n,this.ws=null,this.state={type:"disconnected"},this.backoff=new r.ExponentialBackoff(a),this.onCloseResolve=null,this.alreadyConnectedOnce=!1,this.reconnectTimeout=null,this.inactivityDisconnect=null,this.preventReconnectForDebugging=!1,this.preventAutoReconnectOnNextClose=!1,this.connectionCount=0,this.observers=new Set,this.visibilityChange=()=>{var e;(null===(e=this.clientOptions.document)||void 0===e?void 0:e.visibilityState)==="visible"?(this.clearInactivityDisconnect(),this.connect()):this.scheduleInactivityDisconnect()},this._lastAckTime=new Date(0),n.document&&n.document.addEventListener("visibilitychange",this.visibilityChange),this.registerPingInterval()}cleanup(){this.clientOptions.document&&this.clientOptions.document.removeEventListener("visibilitychange",this.visibilityChange),this.clearInactivityDisconnect(),this.closeWithoutReconnecting()}registerPingInterval(){setInterval(()=>{this.ready()&&this.send({messageType:"ping"})},this.getIntervalWithJitter())}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}get debug(){return{disconnect:()=>{this.preventReconnectForDebugging=!0,this.ws&&this.ws.close(1e3,"for-testing")},reconnect:()=>{this.preventReconnectForDebugging=!1,this.connect()},sendPingNow:()=>{this.sendPingNow()}}}connect(){var e;return s(this,void 0,void 0,function*(){let[t,i]=(0,r.promiseResolveReject)(),a=!1,l=this.alreadyConnectedOnce,d=(null===(e=this.clientOptions.document)||void 0===e?void 0:e.visibilityState)==="hidden"&&l;if(this.preventReconnectForDebugging||d||"connected"===this.state.type||"connecting"===this.state.type)return"skipped";this.clearReconnect(),this.ws=this.wsImpl(this.url),this.setConnectionState({type:"connecting"});let u=this.ws;return this.ws.onopen=()=>s(this,void 0,void 0,function*(){var e,t,s,n,o;let l=this.ws;if((0,r.assertWithoutCrashingOnClient)(u===l,"Current websocket is different from newly-opened websocket"),(0,r.assert)(null!==this.ws,"websocket should be non-null"),(null===(e=this.ws)||void 0===e?void 0:e.readyState)!==(null===(t=this.ws)||void 0===t?void 0:t.OPEN))return;this.setConnectionState({type:"connected",authenticated:!1,count:this.backoff.attemptsSoFar()}),i("success"),a=!0;let d=(null===(s=this.clientOptions.tags)||void 0===s?void 0:s.clientType)||"unknown",h=Object.assign(Object.assign({},this.clientOptions.tags),(null===(n=this.clientOptions.document)||void 0===n?void 0:n.URL)&&{clientUrl:null===(o=this.clientOptions.document)||void 0===o?void 0:o.URL});this.connectionCount+=1;let c={messageType:"auth",clientType:d,args:this.args,tags:h};for(let e of(this.emitter.emit({type:"REQUEST_MESSAGE",message:c}),this.ws.send(JSON.stringify(c)),this.observers))e.onConnectionOpen()}),this.ws.onclose=e=>{var t;if(this.setConnectionState({type:"disconnected"}),this.emitter.emit({type:"CONNECTION_CLOSED",url:this.url,closeEvent:e}),4001===e.code&&"object"==typeof document)for(let e of o)document.cookie=`${e}=; max-age=-1; path=/;`;if(a||i("failure"),null===(t=this.onCloseResolve)||void 0===t||t.call(this),this.preventAutoReconnectOnNextClose){this.preventAutoReconnectOnNextClose=!1;return}this.reconnectTimeout||(this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=null,this.connect()},this.backoff.nextBackoffMs()))},this.ws.onerror=e=>{this.emitter.emit({type:"ERROR",error:e})},this.ws.onmessage=({data:e})=>{var t,i,s;let r=JSON.parse(e);if(r){switch(this.emitter.emit({type:"RESPONSE_MESSAGE",message:r}),r.messageType){case"authSuccess":this.setConnectionState({type:"connected",authenticated:!0,count:this.backoff.attemptsSoFar()}),this.backoff.reset();break;case"authFail":this.emitter.emit({type:"ERROR",error:new n.AuthError}),this.setConnectionState({type:"error",errorType:"authFail"}),this.closeWithoutReconnecting();break;case"ack":this._lastAckTime=new Date;break;case"requestError":this.setConnectionState({type:"error",errorType:"requestError"}),null===(t=this.ws)||void 0===t||t.close();break;case"requestBeforeAuth":this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg=!1,this.setConnectionState({type:"error",errorType:"requestBeforeAuth"}),null===(i=this.ws)||void 0===i||i.close();break;case"serverError":this.setConnectionState({type:"error",errorType:"serverError"}),null===(s=this.ws)||void 0===s||s.close()}for(let e of this.observers)e.handleMessage(r)}},t})}clearReconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}closeWithoutReconnecting(){var e,t;return s(this,void 0,void 0,function*(){let[i,s]=(0,r.promiseResolveReject)();this.onCloseResolve=s,this.clearReconnect(),this.preventAutoReconnectOnNextClose=!0,null!==this.ws&&(null===(e=this.ws)||void 0===e?void 0:e.readyState)!==(null===(t=this.ws)||void 0===t?void 0:t.CLOSED)&&(this.ws.close(),yield i)})}reconnect(){return s(this,void 0,void 0,function*(){return this.preventAutoReconnectOnNextClose=!1,this.connect()})}getIntervalWithJitter(){return 3e4+(Math.random()-.5)*5e3}ready(){var e,t;return"connected"===this.state.type&&!!this.ws&&(null===(e=this.ws)||void 0===e?void 0:e.readyState)===(null===(t=this.ws)||void 0===t?void 0:t.OPEN)&&(this.state.authenticated||!!this.clientOptions.enableSendingSubscriptionRequestBeforeAuthMsg)}send(e){this.ready()?(this.emitter.emit({type:"REQUEST_MESSAGE",message:e}),this.ws.send(JSON.stringify(e))):(0,r.assertWithoutCrashingOnClient)(!1,`ClientConnection.send called with message type ${e.messageType} while in non-ready state`)}sendPingNow(){this.ready()&&this.send({messageType:"ping"})}getConnectionCount(){return this.connectionCount}getLastAckTime(){return this._lastAckTime}scheduleInactivityDisconnect(){this.inactivityDisconnect=setTimeout(()=>{this.closeWithoutReconnecting()},36e5)}clearInactivityDisconnect(){this.inactivityDisconnect&&(clearTimeout(this.inactivityDisconnect),this.inactivityDisconnect=null)}setConnectionState(e){"connected"===e.type&&(this.alreadyConnectedOnce=!0),this.state=e,this.emitter.emit({type:"CONNECTION_STATE",state:e,url:this.url})}getState(){return this.state}isReconnectScheduled(){return"disconnected"===this.state.type&&null!==this.reconnectTimeout}getBackoff(){return this.backoff}}},743399:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this.listeners=new Set}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}emit(e){this.listeners.forEach(t=>{try{t(e)}catch(e){console.error(e)}})}}},562806:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InitialOnlyQueryComputationObserver=t.InitialOnlyQueryObserver=t.InitialOnlyQuerySubscriptionObservable=void 0,t.InitialOnlyQuerySubscriptionObservable=class{constructor(e){this.observable=e}subscribeQuery(e,t){return this.observable.subscribeQuery(e,new i(t))}subscribeComputation(e,t){return this.observable.subscribeComputation(e,new s(t))}requestPaginationChange(e,t){}};class i{constructor(e){this.next=e}onInitialResults(e,t){this.next.onInitialResults(e,t)}onAddResult(e){}onRemoveResult(e,t){}onUpdateResult(e){}onError(e){}detachChild(e){}restoreChild(e){}identifier(){return this.next.identifier()}}t.InitialOnlyQueryObserver=i;class s{constructor(e){this.next=e,this.receivedInitialResults=!1}onUpdateResult(e){this.receivedInitialResults||(this.next.onUpdateResult(e),this.receivedInitialResults=!0)}onErrors(e){}}t.InitialOnlyQueryComputationObserver=s},258663:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});let s=i(598295);t.default=class{constructor(e,t){this.serverId=null,this.shadowMutations=new Set,this.shadowQueries=new Set,this.serverQueries=new Set,this.serverIdResolveList=[],this.serverFields=e,this.shadowFields=e,t||(this.serverId=e.id)}fields(){return 0===this.shadowMutations.size?this.serverFields:this.shadowFields}dependentQueries(){return 0===this.shadowMutations.size?this.serverQueries:this.shadowQueries}resolvePendingServerIdList(e){for(let t of(this.serverId=e.id,this.serverIdResolveList))t(this.serverId);this.serverIdResolveList=[]}applyMutation(e){if(this.serverFields=Object.assign(Object.assign({},this.serverFields),e),this.shadowFields=Object.assign(Object.assign({},this.shadowFields),{id:e.id}),this.resolvePendingServerIdList(e),0===this.shadowMutations.size)for(let e of this.dependentQueries().values())for(let t of e.observers)t.onUpdateResult(this.serverFields,e.missingFields)}applyShadowMutation(e,t,i){0===this.shadowMutations.size&&(this.shadowFields=Object.assign({},this.serverFields),this.shadowQueries=new Set(this.serverQueries)),this.shadowMutations.add(e),i&&(this.shadowFields=Object.assign(Object.assign(Object.assign({},this.shadowFields),i),t))}removeShadowMutation(e,t){t?this.shadowMutations.delete(e):this.shadowMutations=new Set}getServerSideId(){if(this.serverId)return Promise.resolve(this.serverId);let[e,t]=(0,s.promiseResolveReject)();return this.serverIdResolveList.push(t),e}}},641661:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=i(598295),r=i(764849),o=s(i(258663));t.default=class{constructor(e,t){this.objectDef=e,this.emitter=t,this.instanceStates=new r.EntryMap,this.instanceStatesByUuid=new r.EntryMap,this.shadowInstances=new Set,this.queryStates=new r.EntryMap,this.possiblyOrphanedQueryResults=new r.EntryMap,this.possiblyOrphanInstances=new Set}getAllQueryIds(){return Array.from(this.queryStates.keys())}addInstance(e,t){if(this.emitter.emit({type:"STORE.ADD_INSTANCE",objectName:this.objectDef.name,instance:t.fields()}),(0,n.assert)("failed"!==e.results.type),!e.results.instances.has(t)){if(e.results.instances.add(t),"loaded"===e.results.type)for(let i of e.observers)i.onAddResult(t.fields(),e.missingFields);t.dependentQueries().add(e)}}removeInstance(e,t,i){if(this.emitter.emit({type:"STORE.REMOVE_INSTANCE",objectName:this.objectDef.name,instance:t.fields()}),(0,n.assert)("failed"!==e.results.type),!e.results.instances.has(t)){(0,n.assertWithoutCrashingOnClient)(!1,"tried to remove instance that does not exist");return}for(let s of(e.results.instances.delete(t),e.observers))i?s.onRemoveResult(t.fields()):s.detachChild(t.fields());t.dependentQueries().delete(e)}applyShadowMutationAdd(e,t,i){let s=this.instanceStates.entry(t).orInsertWith(()=>new o.default({id:t},!0));this.shadowInstances.add(s),s.applyShadowMutation(e,{id:t},i);let n=[];for(let[e,t]of this.queryStates.entries()){let i=t.query.matches(s.fields());i&&"failed"!==t.results.type&&(n.push(e),this.addInstance(t,s))}return n}applyShadowMutationAddWithUUID(e,t,i){let s=this.instanceStatesByUuid.entry(t).orInsertWith(()=>new o.default({id:t,uuid:t},!0));this.shadowInstances.add(s),s.applyShadowMutation(e,{uuid:t},Object.assign(Object.assign({},i),{id:t}));let n=[];for(let[e,t]of this.queryStates.entries()){let i=t.query.matches(s.fields());i&&"failed"!==t.results.type&&(n.push(e),this.addInstance(t,s))}return n}applyShadowMutationDelete(e,t,i){this.shadowInstances.add(i),i.applyShadowMutation(e,{id:t},null);let s=[];for(let e of i.dependentQueries().values())"failed"!==e.results.type&&(this.removeInstance(e,i,!1),s.push(e.queryId));return s}applyShadowMutationDeleteWithUUID(e,t,i){this.shadowInstances.add(i),i.applyShadowMutation(e,{uuid:t},null);let s=[];for(let e of i.dependentQueries().values())"failed"!==e.results.type&&(this.removeInstance(e,i,!1),s.push(e.queryId));return s}applyShadowMutationUpdate(e,t,i,s){this.shadowInstances.add(i),i.applyShadowMutation(e,{id:t},s);let n=i.fields(),r=[];for(let e of this.queryStates.values())if("failed"!==e.results.type){if(e.results.instances.has(i)){if(e.query.matches(n))for(let t of e.observers)t.onUpdateResult(n,e.missingFields);else this.removeInstance(e,i,!1);r.push(e.queryId)}else e.query.matches(n)&&(this.addInstance(e,i),r.push(e.queryId))}return r}applyShadowMutationUpdateWithUUID(e,t,i,s){this.shadowInstances.add(i),i.applyShadowMutation(e,{uuid:t},s);let n=i.fields(),r=[];for(let e of this.queryStates.values())if("failed"!==e.results.type){if(e.results.instances.has(i)){if(e.query.matches(n))for(let t of e.observers)t.onUpdateResult(n,e.missingFields);else this.removeInstance(e,i,!1);r.push(e.queryId)}else e.query.matches(n)&&(this.addInstance(e,i),r.push(e.queryId))}return r}removeShadowMutations(e,t,i){for(let s in t){let t=this.instanceStates.get(s);if(void 0!==t&&t.shadowMutations.has(e)&&(t.removeShadowMutation(e,i),0===t.shadowMutations.size)){this.shadowInstances.delete(t);let e=t.fields();for(let i of t.dependentQueries().values())for(let t of i.observers)t.restoreChild(e);for(let i of this.queryStates.values())if("failed"!==i.results.type){if(i.results.instances.has(t)){if(t.dependentQueries().has(i))for(let t of i.observers)t.onUpdateResult(e,i.missingFields);else this.removeInstance(i,t,!0)}else t.dependentQueries().has(i)&&this.addInstance(i,t)}this.checkOrphanInstance(t)}}}removeShadowMutationsWithUUID(e,t,i){for(let s in t){let t=this.instanceStatesByUuid.get(s);if(void 0!==t&&t.shadowMutations.has(e)&&(t.removeShadowMutation(e,i),0===t.shadowMutations.size)){this.shadowInstances.delete(t);let e=t.fields();for(let i of t.dependentQueries().values())for(let t of i.observers)t.restoreChild(e);for(let i of this.queryStates.values())if("failed"!==i.results.type){if(i.results.instances.has(t)){if(t.dependentQueries().has(i))for(let t of i.observers)t.onUpdateResult(e,i.missingFields);else this.removeInstance(i,t,!0)}else t.dependentQueries().has(i)&&this.addInstance(i,t)}this.checkOrphanInstance(t)}}}resolvePendingServerIdList(e){for(let t in e){let i=this.objectDef.readPlainObject(e[t]);if(i.uuid&&this.instanceStatesByUuid.has(i.uuid)){let e=this.instanceStatesByUuid.get(i.uuid);e.resolvePendingServerIdList(i)}}}applyMutations(e,t){for(let t in e){let i=this.objectDef.readPlainObject(e[t]);if(this.instanceStates.has(t))this.instanceStates.get(t).applyMutation(i);else if(i.uuid&&this.instanceStatesByUuid.has(i.uuid)){let e=this.instanceStatesByUuid.get(i.uuid);this.instanceStates.set(i.id,e),e.applyMutation(i)}else{let e=new o.default(i,!1);i.uuid&&this.instanceStatesByUuid.set(i.uuid,e),this.instanceStates.set(i.id,e),this.possiblyOrphanInstances.add(e)}}for(let i in t){let s=t[i];if(!this.queryStates.has(i)){this.possiblyOrphanedQueryResults.set(i,s);continue}let n=this.queryStates.get(i);this.setQueryStateResults(n,s,e)}}subscribe(e,t){let i=this.queryStates.entry(e.queryId).orInsertWith(()=>({queryId:e.queryId,results:{type:"loading",instances:new Set},query:e.substituted(),observers:new Set,missingFields:[]}));if((0,n.assert)(!i.observers.has(t)),i.observers.add(t),this.possiblyOrphanedQueryResults.has(e.queryId))this.setQueryStateResults(i,this.possiblyOrphanedQueryResults.get(e.queryId)),this.possiblyOrphanedQueryResults.delete(e.queryId);else if("loaded"===i.results.type){let e={};for(let t of i.results.instances.values()){let i=t.fields();e[i.id]=i}t.onInitialResults(e,!1,void 0,i.missingFields)}else"failed"===i.results.type&&t.onError(i.results.error);return()=>{if((0,n.assert)(i.observers.has(t)),i.observers.delete(t),0===i.observers.size){if("failed"!==i.results.type)for(let e of i.results.instances.values())e.dependentQueries().delete(i),this.checkOrphanInstance(e);this.queryStates.delete(e.queryId)}}}getIdFromUuid(e){if(!this.instanceStatesByUuid.has(e))throw Error(`uuid ${e} doesn't exist in object store ${this.objectDef.name}`);return this.instanceStatesByUuid.get(e).getServerSideId()}setQueryStateResults(e,t,i){if("error"in t){for(let i of(e.results={type:"failed",error:t.error},e.observers))i.onError(t.error);return}let{results:s,fullResults:r,pagination:o,missingFields:a}=t;if(e.missingFields=a||[],"loaded"===e.results.type){for(let i in s){this.instanceStates.has(i)||(0,n.assert)(this.instanceStates.has(i),`objectId ${i} is missing from ${this.objectDef.name} store. queryResults is ${JSON.stringify(t)}`);let r=this.instanceStates.get(i);if(this.shadowInstances.has(r)){!0===s[i]?r.serverQueries.add(e):r.serverQueries.delete(e);continue}!0===s[i]?this.addInstance(e,r):(this.removeInstance(e,r,!0),this.possiblyOrphanInstances.add(r))}if(r){for(let t of e.results.instances)this.shadowInstances.has(t)||s[t.fields().id]||(this.removeInstance(e,t,!0),this.possiblyOrphanInstances.add(t));for(let t of this.shadowInstances.values())s[t.fields().id]||t.serverQueries.delete(e)}}else{(0,n.assert)(r),e.results={type:"loaded",instances:"loading"===e.results.type?e.results.instances:new Set};let t={};for(let i in s){(0,n.assert)(s[i]),(0,n.assert)(this.instanceStates.has(i));let r=this.instanceStates.get(i);r.serverQueries.add(e),this.shadowInstances.has(r)||(t[i]=r.fields(),e.results.instances.add(r))}for(let i of this.shadowInstances.values()){let s=i.fields();e.query.matches(s)&&(t[s.id]=s)}for(let i of e.observers)i.onInitialResults(t,!0,o,a)}}cleanupOrphans(){for(let e of(this.possiblyOrphanedQueryResults.clear(),this.possiblyOrphanInstances))this.checkOrphanInstance(e)}checkOrphanInstance(e){let t=this.instanceStates.has(e.fields().id),i=this.instanceStates.get(e.fields().id)===e,s=0===e.dependentQueries().size,n=this.shadowInstances.has(e);if(t&&i&&s&&!n){this.instanceStates.delete(e.fields().id);let t=e.fields().uuid;t&&this.instanceStatesByUuid.delete(t)}}}},126582:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.overridesFromMutations=void 0,t.overridesFromMutations=function(e){let t=new Map;for(let i of e)for(let e in i.mutations){let s=i.mutations[e],n=t.get(e);for(let r in n||(n=new Map,t.set(e,n)),s){let t=s[r];if(t&&"delete"!==i.type){if("create"===i.type)n.has(r)&&console.warn(`Optimistically creating ${e} with id ${r} detected but an optimistic operation with that ID already exists.`),n.set(r,{type:"create",instance:Object.assign({id:r},t)});else{let e=n.get(r);e?"create"===e.type?n.set(r,{type:"create",instance:Object.assign(Object.assign({},e.instance),t)}):"update"===e.type&&n.set(r,{type:"update",delta:Object.assign(Object.assign({},e.delta),t)}):n.set(r,{type:"update",delta:t})}}else n.set(r,{type:"delete"})}}return t}},574902:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewSubscriptionObservers=void 0;let n=s(i(71438)),r=s(i(883359)),o=i(598295),a=i(562806);t.ViewSubscriptionObservers=class{constructor(e,t,i,s,n,o){this.key=e,this.viewRef=t,this.observable=n,this.traceId=o,this.frozenView=null,this.subscriptions=[],this.view=new r.default(e,i,s,n)}getSubscriptionObservers(){return this.subscriptions}addSubscription(e){this.subscriptions.push(e)}removeSubscription(e){this.subscriptions=this.subscriptions.filter(t=>t!==e)}updateOverrides(e){if(!this.frozenView){let e="loaded"===this.view.result().status;this.frozenView=new r.default(this.key,this.view.viewDef,new n.default(this.view.context.sessionArgs,this.view.context.viewArgs,this.view.context.options),new a.InitialOnlyQuerySubscriptionObservable(this.observable)),e&&(0,o.assert)("loaded"===this.frozenView.result().status,`Expected frozen view to be loaded but has loading paths: ${this.frozenView.root.getLoadingPathsForDebugging()}`)}this.frozenView.context.overrides=e,this.frozenView.overridesChanged()}resolveOptimisticUpdates(){this.frozenView=null}viewArgs(){return this.view.viewArgs}activeView(){return this.frozenView?this.frozenView:this.view}destroy(){this.view.destroy()}}},71438:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});let s=i(553841);t.default=class{constructor(e={},t={},i){var s;this.sessionArgs=e,this.viewArgs=t,this.options=i,this.statsCollector={queryNodes:0,instanceNodes:0,computations:0,queriesSubscribed:0,hiddenInstances:0,errorsNullableSoaked:0},this.overrides=null,(null===(s=this.options)||void 0===s?void 0:s.inheritedStats)&&(this.statsCollector=this.options.inheritedStats)}get tracingContext(){var e;return null===(e=this.options)||void 0===e?void 0:e.tracingContext}get isContextForComputedField(){var e;return null===(e=this.options)||void 0===e?void 0:e.isContextForComputedField}substituteFieldArgument(e){return(0,s.isArgumentRef)(e)?"session"===e.type?this.sessionArgs[e.ref]:this.viewArgs[e.ref]:e}substituteExpressionArgument(e,t,i){return(0,s.isArgumentRef)(e)?"parent"===e.type?i[e.ref]:this.substituteFieldArgument(t[e.ref]):e}substituteExpression(e,t,i){let s=e=>{switch(e.type){case"binary":case"in":return Object.assign(Object.assign({},e),{right:this.substituteExpressionArgument(e.right,t,i)});case"or":case"and":return Object.assign(Object.assign({},e),{expressions:e.expressions.map(s)})}};return e?s(e):void 0}substituteIndexingHint(e,t,i){if(!e)return null;if(Array.isArray(e.values))return e;let s=this.substituteExpressionArgument(e.values,t,i);return Array.isArray(s)||"object"!=typeof s||null===s?{field:e.field,values:Array.isArray(s)?s:[s]}:null}}},883359:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.liveViewKey=void 0;let n=s(i(284434)),r=i(598295),o=i(50630);t.liveViewKey=function(e,t){return(0,o.stableStringify)([e,t])},t.default=class{constructor(e,t,i,s,o){this.key=e,this.viewDef=t,this.context=i,this.observable=s,this.cancelNextTick=()=>{},this.initResultReady=!1,o=o||{},this.root=new n.default(this,i,{},t.root,[]),(0,r.assert)(!o.onResultsResolved||o.onNextTick),0===this.root.children.length&&o.onNextTick&&(this.cancelNextTick=o.onNextTick(()=>this.resultsUpdated())),this.onResultsResolved=o.onResultsResolved}get path(){return[this.key]}get viewArgs(){return this.context.viewArgs}resultsUpdated(){this.onResultsResolved&&this.onResultsResolved(this.result()),this.reportTime()}overridesChanged(){this.root.overridesChanged()}destroy(){this.cancelNextTick(),this.root.destroy()}result(){return this.root.result()}resultWithLoadingStates(){return this.root.resultWithLoadingStates()}resetResult(){}isLoaded(){return this.root.isLoaded()}getQueryIds(){return this.root.getQueryIds()}reportTime(){let{tracingContext:e}=this.context;if(e&&!this.initResultReady&&this.isLoaded()){this.initResultReady=!0;let t=Date.now()-e.startTime,i=this.root.getInitStats();i&&e.viewInitReporter(e.viewName,this.context.viewArgs,this.context.sessionArgs,i,this.context.statsCollector,!!this.context.isContextForComputedField,t,this.context.tracingContext.originalViewName)}}}},443517:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isLiveViewComputationNode=void 0;let i=Object.freeze({status:"loading"});class s{constructor({parent:e,computationDef:t,observable:i,context:s,instance:n}){this.initStats=null,this.parent=e,this.observable=i,this.computation=t.parameterizedComputation(s,n,e.queryDef.objectDef.naturalKey),this.computation.trackEvent("LiveViewComputationNode.constructor");let r=t.computedFieldDef.name;r in n?(this.unsubscribe=()=>{},this.onUpdateResult(n[r])):this.unsubscribe=i.subscribeComputation(this.computation,this)}get path(){return[...this.parent.path,this.computation.computationId]}get fieldName(){return this.computation.fieldName}overridesChanged(){}destroy(){this.unsubscribe()}onUpdateResult(e){this.computation.trackEvent("LiveViewComputationNode.onUpdateResult"),this._result={status:"loaded",errors:[],data:e},this.parent.resetResult(),this.parent.resultsUpdated()}onErrors(e){this.computation.trackEvent("LiveViewComputationNode.onErrors",e);let{name:t}=this.computation.fieldDef;this._result={status:"errors",data:null,errors:e.map(e=>Object.assign(Object.assign({},e),{path:[t,...e.path]}))},this.parent.resetResult(),this.parent.resultsUpdated()}recreateIfStale(e,t){}getLoadingPathsForDebugging(){return this._result?[]:[this.computation.fieldDef.name]}result(){return this._result?this._result:i}resultWithLoadingStates(){let e=this.result();return{id:this.computation.computationId,status:e.status,children:[],data:"errors"===e.status?e.errors:void 0}}isLoaded(){return!!this._result}getInitStats(){return this.initStats?this.initStats:this.isLoaded()?(this.initStats={queryNodes:0,instanceNodes:0,maxDepth:1,computations:1,failedQueries:0},this.initStats):null}}t.default=s,t.isLiveViewComputationNode=function(e){return e instanceof s}},284434:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let a=i(553841),l=r(i(199932)),d=r(i(443517)),u=i(227671),h=i(598295),c=o(i(101610));t.default=class{constructor(e,t,i,s,n){var r,o;for(let[r,o]of(this.parent=e,this.context=t,this.instance=i,this.queryDef=s,this.missingOptionalFields=n,this.children=[],this._isLoaded=!1,this.initStats=null,t.statsCollector.instanceNodes++,s.queries.entries())){let i=this.missingOptionalFields.some(e=>r===e.fieldName);i||(o.objectFieldDef.pagination?this.children.push(new c.default({parent:this,queryDef:o,observable:e.observable,context:t})):this.children.push(new l.default({parent:this,queryDef:o,observable:e.observable,context:t})))}for(let[n,r]of s.computations.entries()){let s=this.missingOptionalFields.some(e=>n===e.fieldName);s||this.children.push(new d.default({parent:this,computationDef:r,observable:e.observable,context:t,instance:i}))}null===(o=null===(r=t.options)||void 0===r?void 0:r.logger)||void 0===o||o.debug("VIEW_INSTANCE_NODE.CREATE",this.debugFields)}get debugFields(){return{object:this.queryDef.name,parent:this.parent.path,instanceFields:JSON.stringify(Array.from(Object.getOwnPropertyNames(this.instance))),queryFields:JSON.stringify(Array.from(this.queryDef.queries.keys())),projectedBaseFields:JSON.stringify(Array.from(this.queryDef.projectedFields.keys()))}}get path(){return[...this.parent.path,this.instance.id||"root"]}get queriedChildren(){return this.children.filter(l.isLiveViewQueryNode)}get computedChildren(){return this.children.filter(d.isLiveViewComputationNode)}overridesChanged(){for(let e of this.children)e.overridesChanged()}destroy(){for(let e of this.children)e.destroy()}resultsUpdated(){this.parent.resultsUpdated()}onUpdateResult(e,t){let i=(0,h.projectedInstancesEqual)(e,this.instance,this.queryDef.projectedFields)&&(0,h.missingFieldsEqual)(this.missingOptionalFields,t),s=this.instance;this.instance=e;for(let t=0;t<this.children.length;t++){let i=this.children[t],n=i.recreateIfStale(s,e);n&&(i.destroy(),this.children[t]=n)}return!i&&(this.missingOptionalFields=t,this.resetResult(),!0)}getLoadingPathsForDebugging(){let e=[];for(let t of this.children){let i=t.getLoadingPathsForDebugging();e.push.apply(e,i)}return e}result(){if(this._result)return this._result;let e=[],t=this.queryDef.projectInstance(this.instance),i=!0;for(let s of this.children){let n=s.result();switch(n.status){case"loading":if(this.queryDef.optionalFields.has(s.fieldName)&&"root"===this.queryDef.name){t[this.queryDef.dealias(s.fieldName)]={status:a.OptionalStatus.Error,error:`'root.${s.fieldName}' is missing, marked optional. Check server logs for more details.`};continue}return this._result=n,this._result;case"errors":i=!1,e.push.apply(e,n.errors);break;case"loaded":s.fieldName in this.instance&&s instanceof d.default?t[this.queryDef.dealias(s.fieldName)]=this.instance[s.fieldName]:(e.push.apply(e,n.errors),t[this.queryDef.dealias(s.fieldName)]=n.data),this.queryDef.optionalFields.has(s.fieldName)&&(t[this.queryDef.dealias(s.fieldName)]={status:a.OptionalStatus.Loaded,data:n.data})}}for(let e of this.missingOptionalFields)t[this.queryDef.dealias(e.fieldName)]={status:a.OptionalStatus.Error,error:e.info||""};return i?this._result={status:"loaded",errors:e,data:t}:this._result={status:"errors",data:null,errors:e},this._result}resultWithLoadingStates(){return{id:this.instance.id,status:this.result().status,children:this.children.map(e=>e.resultWithLoadingStates()),data:this.instance}}resetResult(){this._result=void 0,this._isLoaded=!1,this.parent.resetResult()}isLoaded(){if(this._isLoaded)return!0;for(let e of this.children)if(!e.isLoaded())return!1;return this._isLoaded=!0,this._isLoaded}getQueryIds(){let e=[];for(let t of this.queriedChildren)e.push(...t.getQueryIds());return e}getInitStats(){if(this.initStats)return this.initStats;if(!this.isLoaded())return null;for(let e of(this.initStats={queryNodes:0,instanceNodes:1,maxDepth:1,computations:0,failedQueries:0},this.children))(0,u.addLiveViewStats)(this.initStats,e.getInitStats());return this.initStats}}},101610:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=s(i(199932)),r=s(i(177875)),o=i(227671);t.default=class{constructor({parent:e,queryDef:t,observable:i,context:s}){var o,a;this.children=[],this._status={type:"loading"},this.initStats=null,this.nextCursor={start:null,end:null},this.previousPageCountsForReconnection=null,this.isPaginatedNodeFetching=!1,this.clientIsFetching=!1,this.parent=e,this.queryDef=t,this.observable=i,this.context=s,this.query=new r.default(t,s,e.instance),this.isPaginatedNodeFetching=!0,this.clientIsFetching=!0;let l=n.default.DEFAULT_INITIAL_COUNT;this.children.push(new n.default({parent:this,queryDef:this.queryDef,observable:this.observable,context:this.context,paginationData:{before:this.nextCursor.start,after:this.nextCursor.end,count:l}})),null===(a=null===(o=this.context.options)||void 0===o?void 0:o.paginationQueryNodeMap)||void 0===a||a.set(this.query.queryId,this)}get fieldName(){return this.queryDef.objectFieldDef.name}get path(){return[...this.parent.path,"pagination-"+this.fieldName]}result(){if("loading"===this._status.type)return{status:"loading",data:null,errors:null};if("failed"===this._status.type){let e=this._status.error.code;return this._result={status:"errors",data:null,errors:[{code:e,path:[this.fieldName],error:Error(this._status.error.message)}]},this._result}if(this._result)return this._result;let e=[],t=[],i=!0;for(let s of this.children){let n=s.result();switch(n.status){case"loading":return this._result=n,this._result;case"errors":for(let e of(i=!1,n.errors))t.push(Object.assign(Object.assign({},e),{path:[this.fieldName,...e.path]}));break;case"loaded":for(let e of n.errors)t.push(Object.assign(Object.assign({},e),{path:[this.fieldName,...e.path]}));Array.isArray(n.data)?e.push(...n.data):n.data&&e.push(n.data)}}if(!i)return this._result={status:"errors",data:null,errors:t},this.clientIsFetching=!1,this._result;let s=Object.assign(e,{loadNext:e=>{var t,i;(null===(t=this._result)||void 0===t?void 0:t.data)&&(this._result=Object.assign({},this._result),(null===(i=this._result.data)||void 0===i?void 0:i.isLoadingNextPage)!==void 0&&(this._result.data.isLoadingNextPage=!0),this.parent.resetResult(),this.parent.resultsUpdated(),this.loadNextPage(e))},hasNextPage:()=>this.hasNextPage(),isLoadingNextPage:!1});return this._result={status:"loaded",errors:t,data:s},this.clientIsFetching=!1,this._result}resultsUpdated(){this.children.every(e=>e.isLoaded())&&(this._status.type="loaded"),"loading"!==this._status.type&&this.parent.resultsUpdated()}resetResult(){this._result=void 0,this.parent.resetResult()}identifier(){return{viewArgs:this.context.viewArgs,sessionArgs:this.context.sessionArgs,queryId:this.query.queryId}}onError(e){this.resetResult(),this._status={type:"failed",error:e},this.parent.resultsUpdated(),this.isPaginatedNodeFetching=!1}hasNextPage(){return!!this.nextCursor.end}isLoadingNextPage(){return this.clientIsFetching}loadNextPage(e){var t,i,s,r;if(this.isPaginatedNodeFetching){null===(i=null===(t=this.context.options)||void 0===t?void 0:t.logger)||void 0===i||i.error(Error(`Trying to fetch next page for query ${this.query.queryId} when there is an ongoing fetch more request.`));return}if(this.isPaginatedNodeFetching=!0,this.clientIsFetching=!0,!this.hasNextPage()){null===(r=null===(s=this.context.options)||void 0===s?void 0:s.logger)||void 0===r||r.error(Error(`Trying to fetch next page for query ${this.query.queryId} when there are no more pages left`));return}this.children.push(new n.default({parent:this,queryDef:this.queryDef,observable:this.observable,context:this.context,paginationData:{before:this.nextCursor.start,after:this.nextCursor.end,count:e}})),this.observable.requestPaginationChange(this.query,e)}destroy(){var e,t;for(let e of this.children)e.destroy();null===(t=null===(e=this.context.options)||void 0===e?void 0:e.paginationQueryNodeMap)||void 0===t||t.delete(this.query.queryId)}recreateIfStale(e,t){for(let i=0;i<this.children.length;i++){let s=this.children[i],n=s.recreateIfStale(e,t);n&&(s.destroy(),this.children[i]=n)}}onPaginationResults(e){if(this.isPaginatedNodeFetching=!1,this.nextCursor=e,this.previousPageCountsForReconnection){if(this.previousPageCountsForReconnection.length&&this.nextCursor.end){let e=this.previousPageCountsForReconnection.shift();this.loadNextPage(e)}else this.previousPageCountsForReconnection=null}}isLoaded(){return"loaded"===this._status.type}getInitStats(){if(this.initStats)return this.initStats;if(!this.isLoaded())return null;for(let e of(this.initStats={queryNodes:1,instanceNodes:0,maxDepth:1,computations:0,failedQueries:0},this.children.values()))(0,o.addLiveViewStats)(this.initStats,e.getInitStats());return this.initStats}startReconnectionState(){for(let e of(this.previousPageCountsForReconnection=this.children.map(e=>e.paginationArgs.count),this.children))e.destroy();this.children=[],this.nextCursor={start:null,end:null};let e=this.previousPageCountsForReconnection.shift();this.children.push(new n.default({parent:this,queryDef:this.queryDef,observable:this.observable,context:this.context,paginationData:{before:this.nextCursor.start,after:this.nextCursor.end,count:e}})),this.isPaginatedNodeFetching=!0,this.clientIsFetching=!0}onInitialResults(e,t,i){throw Error("PaginationNode should never directly receive results.")}onAddResult(e){throw Error("Method not implemented.")}onRemoveResult(e,t){throw Error("Method not implemented.")}onUpdateResult(e){throw Error("Method not implemented.")}detachChild(e){throw Error("Method not implemented.")}restoreChild(e){throw Error("Method not implemented.")}overridesChanged(){throw Error("Method not implemented.")}getLoadingPathsForDebugging(){let e=[];for(let t of("loading"===this._status.type&&e.push(this.fieldName),this.children.values()))e.push(...t.getLoadingPathsForDebugging());return e}resultWithLoadingStates(){throw Error("Method not implemented.")}}},199932:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isLiveViewQueryNode=t.FAKE_PAGINATION_CHANGE_DELAY=t.DISABLED=t.LOADING=void 0;let n=s(i(177875)),r=s(i(284434)),o=i(227671),a=i(598295),l=s(i(101610));t.LOADING=Object.freeze({status:"loading",data:null,errors:null}),t.DISABLED=Object.freeze({status:"disabled",data:null,errors:null});let d=new Map;t.FAKE_PAGINATION_CHANGE_DELAY=1e3;class u{constructor({parent:e,queryDef:t,observable:i,context:s,paginationData:o}){var d,u;let h;this.children=new Map,this.detachedChildren=new Set,this._isLoaded=!1,this._status={type:"loading"},this.initStats=null,this.parent=e,this.observable=i,this.context=s,this.unsubscribe=()=>{},e instanceof l.default&&o?(h=this.parent.parent.instance,this.paginationArgs=o,this.query=new n.default(t,s,h,{before:o.before,after:o.after,count:o.count})):((0,a.assert)(e instanceof r.default),h=e.instance,this.query=new n.default(t,s,h)),s.statsCollector.queryNodes++;let{objectFieldDef:c}=t;if(this.isEmbedded||c.name in h){let e=h[c.name],t=h.id;if(e){if(Array.isArray(e)){let i={};e.forEach((e,s)=>{var n,r;let o=`${t}-${s.toString().padStart(10,"0")}`;e instanceof Object?i[o]=Object.assign({id:o},e):"string"==typeof e?i[o]={id:e}:null===(r=null===(n=this.context.options)||void 0===n?void 0:n.logger)||void 0===r||r.warn("EMBEDDED_INSTANCE_INVALID_TYPE",this.query.queryId,e)});let s=[];for(let e in h){s=this.query.queryDef.missingOptionalFieldsForEmbeddedInstance(i[e]);break}this.onInitialResults(i,!1,void 0,s)}else{let i=`${t}-0`,s=Object.assign({id:i},e),n=this.query.queryDef.missingOptionalFieldsForEmbeddedInstance(s);this.onInitialResults({[i]:s},!1,void 0,n)}}else this.onInitialResults({},!1,void 0,[])}else this.unsubscribe=this.observable.subscribeQuery(this.query,this);null===(u=null===(d=this.context.options)||void 0===d?void 0:d.logger)||void 0===u||u.debug("VIEW_QUERY_NODE.CREATE",this.debugFields)}get isEmbedded(){return this.query.queryDef.objectFieldDef.embedded}get fieldName(){return this.query.queryDef.objectFieldDef.name}get path(){return[...this.parent.path,this.fieldName]}get debugFields(){var e;return{query:this.query.queryId,canonicalShapeID:null===(e=this.query.queryDef.shape)||void 0===e?void 0:e.id,path:this.path,embedded:this.isEmbedded}}identifier(){return{viewArgs:this.context.viewArgs,sessionArgs:this.context.sessionArgs}}overridesChanged(){var e;for(let[t,i]of((null===(e=this.context.overrides)||void 0===e?void 0:e.has(this.query.objectName))&&this.resetResult(),this.children))i.overridesChanged()}destroy(){for(let e of this.children.values())e.destroy();this.unsubscribe()}onError(e){this.resetResult(),this._status={type:"failed",error:e},this.parent.resultsUpdated()}onInitialResults(e,t,i,s){var n,o;for(let d in i&&((0,a.assert)(this.parent instanceof l.default),this.parent.onPaginationResults(i)),null===(o=null===(n=this.context.options)||void 0===n?void 0:n.logger)||void 0===o||o.debug("VIEW_QUERY_NODE.INITIAL_RESULT",this.query.queryId,e),t&&this.context.statsCollector.queriesSubscribed++,(0,a.assert)("loaded"!==this._status.type,"Unexpected initial results on already loaded node"),e)this.children.set(d,new r.default(this,this.context,e[d],this.query.queryDef,s||[]));this._status={type:"loaded"},this.resetResult(),this.parent.resultsUpdated()}onAddResult(e,t){var i,s;null===(s=null===(i=this.context.options)||void 0===i?void 0:i.logger)||void 0===s||s.debug("VIEW_QUERY_NODE.ADD_RESULT",this.query.queryId,e),(0,a.assert)("loaded"===this._status.type,"Unexpected incremental results on node that hasn't loaded yet"),this.children.set(e.id,new r.default(this,this.context,e,this.query.queryDef,t||[])),this.resetResult(),this.parent.resultsUpdated()}onUpdateResult(e,t){var i,s;if(null===(s=null===(i=this.context.options)||void 0===i?void 0:i.logger)||void 0===s||s.debug("VIEW_QUERY_NODE.UPDATE_RESULT",this.query.queryId,e),(0,a.assert)("loaded"===this._status.type,"Unexpected incremental results on node that hasn't loaded yet"),(0,a.assert)(this.children.has(e.id)||e.uuid&&this.children.has(e.uuid),`onUpdateResult: this.children.has(instance.id) = ${this.children.has(e.id)}, instance.id = ${e.id}
       (instance.uuid && this.children.has(instance.uuid)) = ${e.uuid&&this.children.has(e.uuid)}, instance.uuid = ${e.uuid}`),e.uuid&&this.children.has(e.uuid)&&e.id!==e.uuid){let t=this.children.get(e.uuid);this.children.delete(e.uuid),this.children.set(e.id,t)}this.children.get(e.id).onUpdateResult(e,t||[])&&this.parent.resultsUpdated()}onRemoveResult(e){var t,i;let{id:s}=e;if(null===(i=null===(t=this.context.options)||void 0===t?void 0:t.logger)||void 0===i||i.debug("VIEW_QUERY_NODE.REMOVE_RESULT",this.query.queryId,e),(0,a.assert)("loaded"===this._status.type,"Unexpected incremental results on node that hasn't loaded yet"),(0,a.assert)(this.children.has(e.id)||e.uuid&&this.children.has(e.uuid),`onRemoveResult: this.children.has(instance.id) = ${this.children.has(e.id)}, instance.id = ${e.id}
       (instance.uuid && this.children.has(instance.uuid)) = ${e.uuid&&this.children.has(e.uuid)}, instance.uuid = ${e.uuid}`),e.uuid&&this.children.has(e.uuid)&&e.id!==e.uuid){let t=this.children.get(e.uuid);this.children.delete(e.uuid),this.children.set(e.id,t)}this.children.get(s).destroy(),this.children.delete(s),this.detachedChildren.delete(s),this.resetResult(),this.parent.resultsUpdated()}detachChild({id:e}){this.detachedChildren.add(e),this.children.delete(e),this.resetResult(),this.parent.resultsUpdated()}restoreChild(e){this.detachedChildren.delete(e.id),this.onAddResult(e),this.resetResult()}resultsUpdated(){"loading"!==this._status.type&&this.parent.resultsUpdated()}recreateIfStale(e,t){if(this.isEmbedded){if((0,a.jsonBlobsEqual)(e[this.query.queryDef.objectFieldDef.name],t[this.query.queryDef.objectFieldDef.name]))return}else if(!this.query.isContextStale(t))return;return new u({parent:this.parent,queryDef:this.query.queryDef,observable:this.observable,context:this.context})}getLoadingPathsForDebugging(){let e=[];"loading"===this._status.type&&e.push(this.fieldName);let t=[...this.children.values()],i=this.query.order();for(let s of(i&&t.sort(({instance:e},{instance:t})=>i(e,t)),t)){let t=s.getLoadingPathsForDebugging();e.push(...t.map(e=>`${this.fieldName}["${s.instance.id}"].${e}`))}return e}result(){var e,i,s,n,r,o,l,u;if("loading"===this._status.type)return t.LOADING;if("failed"===this._status.type){let e=this._status.error.code;return this._result={status:"errors",data:null,errors:[{code:e,path:[this.fieldName],error:Error(this._status.error.message)}]},this._result}if(this._result)return this._result;let h=(null===(e=this.context.overrides)||void 0===e?void 0:e.get(this.query.objectName))||d,c=[];for(let e of this.children.values()){let t=e.instance,i=e.result();if("loaded"===i.status){let s=h.get(e.instance.id);if(s){if("delete"===s.type)continue;if("create"===s.type)continue;if("update"===s.type){if(t=Object.assign(Object.assign({},t),s.delta),!this.query.substituted().matches(t))continue;i.data=this.query.queryDef.projectResults(Object.assign(Object.assign({},i.data),s.delta))}else(0,a.assertNever)(s)}}c.push({instance:t,result:i})}for(let[e,t]of h)"create"===t.type&&this.query.substituted().matches(t.instance)&&c.push({instance:t.instance,result:{status:"loaded",data:this.query.queryDef.projectResults(t.instance),errors:[]}});let f=this.query.order();f&&c.sort(({instance:e},{instance:t})=>f(e,t));let{fieldName:p}=this,g=[],y=[],m=!0;for(let{result:e}of c)switch(e.status){case"loading":return this._result=e,this._result;case"errors":for(let t of(m=!1,e.errors))g.push(Object.assign(Object.assign({},t),{path:[p,...t.path]}));break;case"loaded":for(let t of e.errors)g.push(Object.assign(Object.assign({},t),{path:[p,...t.path]}));y.push(e.data)}if(!m)return this.query.queryDef.isNullable()?(this.context.statsCollector.errorsNullableSoaked++,null===(s=null===(i=this.context.options)||void 0===i?void 0:i.logger)||void 0===s||s.info("VIEW_QUERY_NODE.NULLABLE_ERROR_SOAK",Object.assign({errors:g},this.debugFields)),this._result={status:"loaded",errors:g,data:null}):this._result={status:"errors",data:null,errors:g},this._result;if(y.length){let e=this.query.queryDef.getMissingProjectedFields(y[0]);if(e.length&&(null===(n=this.context.options)||void 0===n?void 0:n.enableCrossViewIncompleteInstanceCheck))return null===(o=null===(r=this.context.options)||void 0===r?void 0:r.logger)||void 0===o||o.debug("CROSS_VIEW_INCOMPLETE_INSTANCES",this.query.queryInfo(),e,"ff_enabled_and_set_loading"),this._result=t.LOADING,this._result;null===(u=null===(l=this.context.options)||void 0===l?void 0:l.logger)||void 0===u||u.debug("CROSS_VIEW_INCOMPLETE_INSTANCES",this.query.queryInfo(),e,"set_loaded")}return this.query.queryDef.isList()?this._result={status:"loaded",errors:g,data:y}:y.length>0?this._result={status:"loaded",errors:g,data:y[0]}:this.query.queryDef.isNullable()?this._result={status:"loaded",errors:g,data:null}:this._result={status:"errors",data:null,errors:[...g,{code:"nonNullableResult",path:[p]}]},this._result}resultWithLoadingStates(){let e=this.result();return{id:this.query.queryId,status:e.status,children:Array.from(this.children.entries()).map(([e,t])=>t.resultWithLoadingStates()),data:"errors"===e.status?e.errors:void 0}}resetResult(){this._result=void 0,this._isLoaded=!1,this.parent.resetResult()}isLoaded(){if("loading"===this._status.type)return!1;if(this._isLoaded)return!0;for(let e of this.children.values())if(!e.isLoaded())return!1;return this._isLoaded=!0,this._isLoaded}getQueryIds(){let e=[this.query.queryId];for(let[t,i]of this.children)e.push(...i.getQueryIds());return e}getInitStats(){if(this.initStats)return this.initStats;if(!this.isLoaded())return null;for(let e of(this.initStats={queryNodes:1,instanceNodes:0,maxDepth:1,computations:0,failedQueries:"failed"===this._status.type?1:0},this.children.values()))(0,o.addLiveViewStats)(this.initStats,e.getInitStats());return this.initStats}}u.DEFAULT_INITIAL_COUNT=10,t.default=u,t.isLiveViewQueryNode=function(e){return e instanceof u}},308065:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,i){this.computationDef=e,this.context=t;let s={};for(let e in t.viewArgs){let i=t.viewArgs[e];e.startsWith("_nk_")||(s[e]=i)}this.computationId=JSON.stringify([this.objectName,this.fieldName,i,s])}get fieldDef(){return this.computationDef.computedFieldDef}get objectName(){return this.fieldDef.objectDef.name}get fieldName(){return this.fieldDef.name}trackEvent(e,t){var i;null===(i=this.context.tracingContext)||void 0===i||i.trackComputationEvent(this,e,t)}}},177875:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.queriedObjectType=void 0;let n=i(553841),r=i(932854),o=s(i(497490)),a=s(i(728570)),l=s(i(236452));t.default=class{constructor(e,t,i,s){var l;this.queryDef=e,this.context=t,this.parent=i,this.paginationArgs=s;let d=[];for(let e of this.queryDef.objectFieldDef.args){let t=this.queryDef.fieldArgs[e.name];(0,n.isArgumentRef)(t)?"session"===t.type?d.push(this.context.sessionArgs[t.ref]):d.push(this.context.viewArgs[t.ref]):d.push(t)}this.usedResolverValues=(0,r.expressionArgumentRefs)(this.filter).filter(({type:e})=>"parent"===e).map(({ref:e})=>i[e]),this.usedResolverValues.push(...this.getUsedHttpResolverValues());let u=[d,this.usedResolverValues];this.isStaticQuery()&&t.viewArgs.__requestId&&u.push(t.viewArgs.__requestId),this.isPaginationQuery()&&u.push(s),this.queryId=function(e,t){let i=e.parent instanceof o.default?e.parent.objectDef.name:null;if(e.isComputedFieldDependency&&"root"===i&&"root"===e.objectFieldDef.name)return JSON.stringify(["computed","root",e.objectDef.name].concat(t));let s=JSON.stringify([i,e.objectFieldDef.name].concat(t));return s}(this.queryDef,u),this._substituted=new a.default({fields:this.queryDef.objectDef.queriedFields,filter:this.context.substituteExpression(this.filter,this.queryDef.fieldArgs,i)||null,limit:null!==(l=this.queryDef.objectFieldDef.expectedMaxCount)&&void 0!==l?l:200}),this.indexingHint=this.context.substituteIndexingHint(this.queryDef.indexingHint,this.queryDef.fieldArgs,i)}queryInfo(){return{objectName:this.queryDef.objectDef.name,parent:{objectName:this.queryDef.parent instanceof o.default?this.queryDef.parent.objectDef.name:null,fieldName:this.queryDef.objectFieldDef.name}}}get objectName(){return this.queryDef.objectFieldDef.type.name}get filter(){return this.queryDef.objectFieldDef.filter}get orderBy(){return this.queryDef.objectFieldDef.orderBy}substituted(){return this._substituted}getResolvedHttpResolverConfig(){let e=this.queryDef.objectFieldDef.resolver;if((null==e?void 0:e.type)!=="HTTP")return null;let t={};for(let i in e.queryParams){let s=e.queryParams[i],n=this.context.substituteExpressionArgument(s,this.queryDef.fieldArgs,this.parent);t[i]=n}let i=[];if("RedisPubsub"===e.realtimePolicy.type){let t=e.realtimePolicy.channelPostfix;for(let e of t){let t=this.context.substituteExpressionArgument(e,this.queryDef.fieldArgs,this.parent);i.push(t)}}return Object.assign(Object.assign({},e),{queryParams:t,realtimePolicy:"RedisPubsub"===e.realtimePolicy.type?Object.assign(Object.assign({},e.realtimePolicy),{channelPostfix:i}):e.realtimePolicy})}getUsedHttpResolverValues(){let e=this.queryDef.objectFieldDef.resolver;if((null==e?void 0:e.type)!=="HTTP")return[];let t=[];for(let i of Object.keys(e.queryParams).sort()){let s=e.queryParams[i];if(!(0,n.isArgumentRef)(s)||"parent"!==s.type)continue;let r=this.context.substituteExpressionArgument(s,this.queryDef.fieldArgs,this.parent);t.push(r)}if("RedisPubsub"===e.realtimePolicy.type){let i=e.realtimePolicy.channelPostfix;for(let e of i){if(!(0,n.isArgumentRef)(e)||"parent"!==e.type)continue;let i=this.context.substituteExpressionArgument(e,this.queryDef.fieldArgs,this.parent);t.push(i)}}return t}isContextStale(e){return(0,r.expressionArgumentRefs)(this.filter).filter(({type:e})=>"parent"===e).some(({ref:t},i)=>this.usedResolverValues[i]!==e[t])}isPaginationQuery(){return void 0!==this.paginationArgs}isStaticQuery(){var e;return(null===(e=this.queryDef.objectFieldDef.resolver)||void 0===e?void 0:e.realtimePolicy.type)==="Static"}getBinaryFilterResolvedParentValue(e){return this.filter&&"binary"===this.filter.type&&(0,n.isArgumentRef)(this.filter.right)&&this.filter.left===e&&"parent"===this.filter.right.type?this.parent[this.filter.right.ref]:null}getFirstPageSizeOrDefault(e){var t;let i=null===(t=this.queryDef.objectFieldDef.pagination)||void 0===t?void 0:t.firstPageSize;if(!i)return e;let s=this.context.substituteFieldArgument(i);return"number"==typeof s?s:e}getSelectedCursorColumns(){var e,t;let i=null===(e=this.queryDef.objectFieldDef.pagination)||void 0===e?void 0:e.selectedCursorColumn;if(!i)return null;let s=this.context.substituteFieldArgument(i),n=null===(t=this.queryDef.objectFieldDef.pagination)||void 0===t?void 0:t.cursorColumnSet;return"string"==typeof s&&n&&n[s]||null}getPaginationSortOrder(){var e;let t=null===(e=this.queryDef.objectFieldDef.pagination)||void 0===e?void 0:e.sortOrder;if(!t)return null;let i=this.context.substituteFieldArgument(t);return"ASC"===i||"DESC"===i?i:null}order(){let e=this.orderBy;return"Unordered"===e?null:(t,i)=>{for(let[s,n]of[...e||[],["id","ASC"]]){let e=t[s],r=i[s];if(null!==e||null!==r){if(null===e)return"ASC"===n?1:-1;if(null===r||e<r)return"ASC"===n?-1:1;if(e>r)return"ASC"===n?1:-1}}return 0}}},t.queriedObjectType=function(e,t){let i=JSON.parse(t);if("computed"===i[0])return{kind:"object",name:i[2]};let s=i[0],n=i[1],r=e.objectDef({kind:"object",name:s}),o=r.fieldDef(n);if(!(o instanceof l.default))throw Error(`queryId ${t} references a non-object field`);return o.type}},728570:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor({fields:e,filter:t,limit:i}){this.fields=e,this.limit=i,this.filter=t}matches(e){if(!this.filter)return!0;let t=i=>{switch(i.type){case"binary":let s=e[i.left],n=i.right;switch(i.op){case"=":return s===n;case"<>":return s!==n}if(null===s||null===n)return!1;switch(i.op){case">":return s>n;case">=":return s>=n;case"<":return s<n;case"<=":return s<=n}case"in":let r=e[i.left],o=i.right;return o.some(e=>e===r);case"or":return i.expressions.some(t);case"and":return i.expressions.every(t)}};return t(this.filter)}singleMatchingId(){if(this.filter&&"binary"===this.filter.type){let{left:e,right:t}=this.filter;if("id"===e&&"string"==typeof t)return t}return null}}},227671:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addLiveViewStats=void 0,t.addLiveViewStats=function(e,t){t&&(e.queryNodes+=t.queryNodes,e.instanceNodes+=t.instanceNodes,e.maxDepth=Math.max(e.maxDepth,t.maxDepth+1),e.computations+=t.computations,e.failedQueries+=t.failedQueries)}},764849:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultMap=t.EntryMap=void 0;class i{constructor(e,t){this.key=e,this.value=t}orInsert(){return this.value}orInsertWith(){return this.value}andModify(e){return e(this.value),this}}class s{constructor(e,t){this.key=e,this.map=t}orInsert(e){return this.map.set(this.key,e),e}orInsertWith(e){return this.orInsert(e())}andModify(){return this}}class n extends Map{entry(e){return this.has(e)?new i(e,this.get(e)):new s(e,this)}}t.EntryMap=n;class r extends i{orDefault(){return this.value}}class o extends s{orDefault(){return this.orInsert(this.map.default(this.key))}}class a extends Map{constructor(e,t){super(t),this.default=e}entry(e){return this.has(e)?new r(e,this.get(e)):new o(e,this)}}t.DefaultMap=a},822432:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseAndValidateArg=void 0,t.parseAndValidateArg=function e(t,i,s,n=!0){let{type:r,name:o}=i;if(void 0===s)return{argName:o,type:"error",msg:"must not be undefined"};if(null===s){if(!i.nullable)return{argName:o,type:"error",msg:"must not be null"}}else{if("list"===r.kind){if(!(s instanceof Array))return{argName:o,type:"error",msg:"expected an array"};let i=[];for(let a in s){let l=e(t,{name:`${o}[${a}]`,type:r.ofType},s[a],n);if("error"===l.type)return l;i.push(l.parsedValue)}return{argName:o,type:"parsing",value:s,parsedValue:i}}if("map"===r.kind){if("object"!=typeof s||s instanceof Array||s instanceof Date)return{argName:o,type:"error",msg:"expected a map"};let i={};for(let a in s){let l=e(t,{name:`${o}["${a}"]`,type:r.valueType},s[a],n);if("error"===l.type)return l;i[a]=l.parsedValue}return{argName:o,type:"parsing",value:s,parsedValue:i}}if("enum"===r.kind){let e=t.enumDef(r);if("string"!=typeof s||!e.isValidValue(s))return{argName:o,type:"error",msg:`expected one of: ${e.values.join(", ")}`}}else{let e,t;switch(r.kind){case"datetime":case"date":n?(e=`string representation of ${r.kind}`,t=e=>{if("string"!=typeof e)return null;let t=Date.parse(e);return Number.isNaN(t)?null:new Date(t)}):(e="Date",t=e=>e instanceof Date?e:null);break;case"bigint":e="string representation of bigint",t=e=>"string"!=typeof e?null:/^-?[0-9]+$/.test(e)?e:null;break;case"uuid":e="string representation of uuid",t=e=>"string"!=typeof e?null:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(e)?e:null;break;case"string":e="string",t=e=>"string"==typeof e?e:null;break;case"int":case"float":e="number",t=e=>"number"==typeof e?e:null;break;case"bool":e="boolean",t=e=>"boolean"==typeof e?e:null}let i=t(s);return null===i?{argName:o,type:"error",msg:`expected ${e}, got ${typeof s} from ${JSON.stringify(s)}`}:{argName:o,type:"parsing",value:s,parsedValue:i}}}return{argName:o,type:"parsing",value:s,parsedValue:s}}},909026:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=i(175585),r=s(i(71438)),o=s(i(308065));t.default=class{constructor(e,t,i,s,r,o,a){this.parent=e,this.computedFieldDef=t,this.fieldArgs=i,this.viewArgs=s,this.optional=a;let l=this.computedFieldDef.name;(0,n.validateArgs)([...o,l],Object.assign(Object.assign({},this.fieldArgs),this.dummyArgs(e.objectDef)),this.computedFieldDef.args,this.viewArgs,!0,r)}dummyArgs(e){if(e.naturalKey){let t={};return Array.from(e.naturalKey).forEach(i=>{let s=e.fields.get(i);switch(s.type.kind){case"string":t["_nk_"+i]="";break;case"bigint":t["_nk_"+i]="0";break;case"uuid":t["_nk_"+i]="00000000-0000-0000-0000-000000000000";break;case"int":case"float":t["_nk_"+i]=0;break;case"bool":t["_nk_"+i]=!1;break;case"enum":case"list":case"map":t["_nk_"+i]=[];break;default:throw Error("this natural key type is unsupported, add a dummy type to this switch for computed fields to work")}}),t}return{_rootId:""}}parameterizedComputation(e,t,i){var s;let n={_rootId:t.id};for(let s in Array.from(i||[]).forEach(e=>{n["_nk_"+e]=t[e]}),this.fieldArgs){let t=this.fieldArgs[s];n[s]=e.substituteFieldArgument(t)}return new o.default(this,new r.default(e.sessionArgs,n,{logger:null===(s=e.options)||void 0===s?void 0:s.logger,tracingContext:e.tracingContext,isContextForComputedField:!0,inheritedStats:e.statsCollector}),t.id)}}},997994:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isComputedFieldDef=void 0;let a=o(i(773331)),l=o(i(625836)),d=r(i(922128)),u=i(175585),h=i(979319);t.default=class{constructor(e,t,i){let s;if(this.objectDef=t,this.name=e.name,this.type=e.type,this.nullable=!1,this.deprecated=e.deprecated,this.dependencies=e.dependencies,!t.naturalKey){this.args=(e.args||[]).concat([{name:"_rootId",type:{kind:"string"}}]),this.view=new l.default(this.name,{fields:{root:[{_rootId:d.viewArg("_rootId")},e.dependencies]},args:this.args},new a.default({name:"root",fields:[{name:"root",args:[{name:"_rootId",type:{kind:"string"}}],type:{kind:"object",name:t.name},filter:["id","=",d.fieldArg("_rootId")]}]}),i,{isComputedFieldDependency:!0,computedObjectName:t.name,shouldUseMissingFields:!0});return}let n=[],r={};Array.from(t.naturalKey).forEach(i=>{let s=t.fields.get(i);if(!s)throw Error(`cannot create computed field def for ${e.name}; natural key ${i} is not found on object def for ${t.name}`);if(!(0,h.isScalarFieldDef)(s))throw Error(`cannot create computed field def for ${e.name}; natural key ${s.name} is not of scalar type on object def for ${t.name}`);n.push({name:"_nk_"+i,type:s.type}),r["_nk_"+i]=d.viewArg("_nk_"+i)}),this.args=(e.args||[]).concat(...n);let o=[];Array.from(t.naturalKey).forEach(e=>{o.push([e,"=",d.fieldArg("_nk_"+e)])}),s=o.length>1?{and:o}:o[0],this.view=new l.default(this.name,{fields:{root:[r,e.dependencies]},args:this.args},new a.default({name:"root",fields:[{name:"root",args:n,type:{kind:"object",name:t.name},filter:s}]}),i,{isComputedFieldDependency:!0,computedObjectName:t.name,shouldUseMissingFields:!0},void 0,i.scopedQueryShapeFromRoot(t.name))}get displayName(){return`${this.objectDef.name}.${this.name}`}validate(e,t){(0,u.validateArgumentDefs)(`Computed field '${this.name}' of object type '${t.name}'`,this.args)}},t.isComputedFieldDef=function(e){return"object"==typeof e.view}},922128:(e,t)=>{function i(e){return!!e&&"fields"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.prettyLoc=t.find=t.visitView=t.optional=t.alias=t.parent=t.session=t.viewArg=t.fieldArg=t.isComputedField=t.isEmbeddedObjectField=t.isObjectField=t.ifExistsPredicate=t.isFieldDecorated=t._=void 0,t._=null,t.isFieldDecorated=i,t.ifExistsPredicate=function(e){return null!==e&&Object.keys(e).every(t=>{let i=e[t];return!!i&&(!Array.isArray(i)||i.length>0)})},t.isObjectField=function(e){return"object"===e.type.kind||"objects"===e.type.kind},t.isEmbeddedObjectField=function(e){return"embedded"in e&&e.embedded},t.isComputedField=function(e){return"computed"in e},t.fieldArg=e=>({type:"field",ref:e}),t.viewArg=e=>({type:"view",ref:e}),t.session=e=>({type:"session",ref:e}),t.parent=e=>({type:"parent",ref:e}),t.alias=function(e,t){return t&&i(t)?{aliasedField:e,optional:t.optional,fields:t.fields}:{aliasedField:e,fields:t}},t.optional=function(e){return e?i(e)?e.aliasedField?{aliasedField:e.aliasedField,optional:!0,fields:e.fields}:{optional:!0,fields:e.fields}:{optional:!0,fields:e}:{optional:!0,fields:null}},t.visitView=function(e,t,s){let n=(e,r,o)=>{e&&(Array.isArray(e)?(s(e,r,o),n(e[1],r,o)):Object.keys(e).map(a=>{let l=e[a],d=[...r,a];if(i(l)){let e=(null==l?void 0:l.optional)?d:null==o?void 0:o.nearestOptionalParent,i=null==l?void 0:l.aliasedField;t(l,d,{nearestOptionalParent:e,alias:i}),l&&(s(l.fields,d,{nearestOptionalParent:e,alias:i}),n(l.fields,d,{nearestOptionalParent:e,alias:i}))}else s(l,d,{nearestOptionalParent:null==o?void 0:o.nearestOptionalParent}),n(l,d,{nearestOptionalParent:null==o?void 0:o.nearestOptionalParent})}))};n(e.fields,["root"])},t.find=function(e,t){let s=(e,t)=>{let r=t[0];if(void 0!==r&&e){if(Array.isArray(e))return s(e[1],t);{let o=e[r];return t.length<=1?o:void 0===o?void 0:i(o)?n(o,t.slice(1)):s(o,t.slice(1))}}},n=(e,t)=>{let i=t[0];if(void 0!==i&&e)return s(e.fields,t)};return"root"===t[0]?s(e.fields,t.slice(1)):s(e.fields,t)},t.prettyLoc=function(e){return e.join(".")}},584164:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.name=e.name,this.values=e.values,this.annotations=e.annotations}isValidValue(e){return this.values.some(t=>"string"==typeof t?e===t:e===t[1])}validate(e){}}},932854:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.expressionArgumentRefs=t.expressionFields=void 0;let s=i(553841);t.expressionFields=function(e){let t=new Set,i=e=>{switch(e.type){case"binary":case"in":t.add(e.left);break;case"or":case"and":e.expressions.forEach(i)}};return e&&i(e),t},t.expressionArgumentRefs=function(e){let t=[],i=e=>{switch(e.type){case"binary":case"in":(0,s.isArgumentRef)(e.right)&&t.push(e.right);break;case"or":case"and":e.expressions.forEach(i)}};return e&&i(e),t}},434620:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){var t;this.typeConversionExemptions={viewArg:{},filterArg:{},computedFieldArg:{}},this.populateTypeConversions(e),this.allowAllConversions=null===(t=null==e?void 0:e.allowAllExemptions)||void 0===t||t}populateTypeConversions(e){if(!(null==e?void 0:e.exemptions))return;let t=JSON.parse(JSON.stringify(null==e?void 0:e.exemptions));for(let i in null==e?void 0:e.exemptions)for(let s in t[i])for(let n in t[i][s])t[i][s][n]=new Set(e.exemptions[i][s][n]);this.typeConversionExemptions=t}isTypeConversionExempted(e,t,i,s){try{return this.allowAllConversions||this.typeConversionExemptions[e][t][i].has(s)}catch(e){return!1}}}},773331:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=i(598295),r=i(922128),o=s(i(236452)),a=s(i(979319)),l=s(i(997994)),d=s(i(356914)),u=i(846316);function h(e){return"date"===e.kind||"datetime"===e.kind}function c(e){return(0,n.assert)("string"==typeof e),new Date(e)}t.default=class{constructor(e){for(let t of(this.queriedFields=[],this.pendingComputedFields=new Set,this.name=e.name,this.fields=new Map,this.embedded=e.embedded,this.naturalKey=e.naturalKey,this.annotations=e.annotations,this.deprecated=e.deprecated,e.fields))(0,r.isObjectField)(t)?(this.fields.set(t.name,new o.default(t)),(0,r.isEmbeddedObjectField)(t)&&this.queriedFields.push(t.name)):(0,r.isComputedField)(t)?this.pendingComputedFields.add(t.name):(this.fields.set(t.name,new a.default(t)),this.queriedFields.push(t.name));this.needsTransform=e.fields.some(({type:e})=>h(e)||"list"===e.kind&&h(e.ofType))}constructComputedFields(e,t){for(let i of e.fields)(0,r.isComputedField)(i)&&(this.fields.set(i.name,new l.default(i,this,t)),this.pendingComputedFields.delete(i.name))}validate(e){if("root"===this.name)for(let e of this.fields.values())if(e instanceof o.default){if(e.embedded)throw new d.default((0,u.oneLine)`
               root fields cannot be embedded type, but '${e.name}'
               is embedded`)}else throw new d.default((0,u.oneLine)`
            root fields must be of object type, but '${e.name}' is
            '${e.type.kind}'`);else this.embedded||this.fieldDef("id");for(let t of this.fields.values())t.validate(e,this)}fieldDef(e){let t=this.fields.get(e);if(t)return t;if(this.pendingComputedFields.has(e))throw new d.default((0,u.oneLine)`
        field '${e}' is a computed field of '${this.name}', but computed fields haven't yet been constructed.
        You may need to re-order objects in the Schema definition.
      `);throw new d.default((0,u.oneLine)`
      field '${e}' isn't present in object type '${this.name}'`)}readPlainObject(e){if(!this.needsTransform)return e;let t={id:e.id};for(let[i,{type:s}]of this.fields.entries()){if(!(i in e))continue;let n=e[i];t[i]=this.readPlainObjectField(i,n,s)}return t}readPlainObjectField(e,t,i){if(!this.needsTransform)return t;if(i||(i=this.fields.get(e).type),null!==t){if(h(i))return c(t);if("list"===i.kind&&h(i.ofType))return t.map(c)}return t}}},236452:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isObjectFieldDef=void 0;let a=i(553841),l=r(i(922128)),d=i(932854),u=o(i(356914)),h=i(175585),c=i(846316),f=i(997994);t.default=class{constructor(e){var t;if(this.name=e.name,this.type=e.type,this.nullable=e.nullable||!1,this.deprecated=e.deprecated,l.isEmbeddedObjectField(e))this.embedded=!0,this.args=[],this.checkCanRead=void 0;else{if(this.embedded=!1,this.args=e.args||[],this.expectedMaxCount=e.expectedMaxCount,this.filter=e.filter?function e(t){if("or"in t)return{type:"or",expressions:t.or.map(e)};if("and"in t)return{type:"and",expressions:t.and.map(e)};let[i,s,n]=t;return"in"===s?{type:"in",left:i,right:n}:{type:"binary",left:i,op:s,right:n}}(e.filter):void 0,e.neverCheckCanRead&&e.checkCanRead)throw Error("neverCheckCanRead: true cannot be declared alongside checkCanRead.");this.neverCheckCanRead=e.neverCheckCanRead||!1,this.checkCanRead=e.checkCanRead||void 0,this.pagination=e.pagination,this.resolver=e.resolver}this.orderBy=(t=e.orderBy)?"Unordered"===t?"Unordered":t.map(e=>e instanceof Array?e:[e,"ASC"]):void 0}isNullable(){return this.nullable}isList(){return"objects"===this.type.kind}get filterFields(){let e=new Set;for(let{type:t,ref:i}of(0,d.expressionArgumentRefs)(this.filter))"parent"===t&&e.add(i);return e}get dependentFields(){let e=new Set;if(this.orderBy&&"Unordered"!==this.orderBy)for(let[t]of this.orderBy)e.add(t);for(let t of(0,d.expressionFields)(this.filter))e.add(t);return e}validate(e,t){var i,s,n,r,o,l,d,p,g,y,m,b,v,w,S,I,O,_,D,E,C,R,F;e.objects.has(this.type.name)||this.throwFieldError(t,`refers to undefined object type '${this.type.name}'`);let j=new Set;if(this.checkCanRead)for(let i in 0===Object.keys(this.checkCanRead).length&&this.throwFieldError(t,"uses checkCanRead attribute and it doesn't take any arguments. checkCanRead must take arguments such as { userId: fieldArg('userId') } or { userId: session('userId') }. This also means the corresponding canRead field must take these arguments as well."),this.checkCanRead){let s=this.checkCanRead[i];(0,a.isArgumentRef)(s)&&((0,a.argumentDefByName)(this.args,s.ref)||(0,a.argumentDefByName)(e.session.args,s.ref)?j.add(s.ref):this.throwFieldError(t,`uses argument '${s.ref}' in its checkCanRead call but does not declare it`))}let A=e.objectDef(this.type);this.embedded&&!A.embedded&&this.throwFieldError(t,`refers to object '${this.type.name}' as an embedded field, but object '${this.type.name}' is not marked as embedded`),A.embedded&&!this.embedded&&this.throwFieldError(t,`refers to embedded object type '${this.type.name}' without marking as embedded. Add embedded: true`),this.isResolvable(t)||this.throwFieldError(t,"does not contain a filter or resolver and is not embedded"),this.checkCanRead&&(this.checkCanRead.fieldName||A.fields.has("canRead")||this.throwFieldError(t,`has checkCanRead set to true but '${A.name}' does not have a 'canRead' field`),this.checkCanRead.fieldName&&!A.fields.has(this.checkCanRead.fieldName.toString())&&this.throwFieldError(t,`has checkCanRead set to true and with fieldName set to '${this.checkCanRead.fieldName.toString()}' but '${A.name}' does not have a this field`),this.checkCanRead.fieldName&&"bool"!==A.fields.get(this.checkCanRead.fieldName.toString()).type.kind&&this.throwFieldError(t,`has checkCanRead set to true and with fieldName set to '${this.checkCanRead.fieldName.toString()}' but '${this.checkCanRead.fieldName.toString()}' return type is not bool`)),(0,h.validateArgumentDefs)(`field '${this.name}' of object type '${t.name}'`,this.args);let N=e=>{let i=A.fields.get(e.left);return i||this.throwFilterError(t,`refers to field '${e.left}', which does not exist on object '${this.type.name}'`),i},k=e=>{if((0,a.isArgumentRef)(e.right)&&"field"===e.right.type){let i=(0,a.argumentDefByName)(this.args,e.right.ref);return i||this.throwFieldError(t,`uses argument '${e.right.ref}' in its filter but does not declare it`),j.add(e.right.ref),i}if((0,a.isArgumentRef)(e.right)&&"parent"===e.right.type){let i=t.fields.get(e.right.ref);return i||this.throwFieldError(t,`refers to unknown parent field '${e.right.ref}' in its filter`),i}throw new u.default((0,c.oneLine)`
        Filter condition of '${this.name}' in object type ${t.name} expects an argument or parent field,
        but is a ${typeof e.right} with the value '${e.right}'`)},M=i=>{if(!i)return;let s=null,n=null;switch(i.type){case"binary":if(["list","map","object","objects"].indexOf((s=N(i)).type.kind)>-1)throw new u.default((0,c.oneLine)`
              Cannot filter on field '${i.left}' in object type '${t.name}'. Filter on type
              '${s.type.kind}' is not supported.`);if(("date"===s.type.kind||"datetime"===s.type.kind)&&("="===i.op||"<>"===i.op)&&null!==i.right)throw new u.default((0,c.oneLine)`
              Cannot filter on field '${i.left}' in object type '${t.name}'. '${i.op}' filter
              on type '${s.type.kind}' is not is not supported for non-null values.`);if((0,f.isComputedFieldDef)(s))throw new u.default((0,c.oneLine)`
              Cannot filter on field '${i.left}' in object type '${t.name}'. Filters on computed fields
              are not supported since filter conditions get translated directly to SQL queries and there are no
              column in the database corresponding directly to the computed field.`);if((0,a.isArgumentRef)(i.right)){if(n=k(i),!(0,h.compatibleTypes)(n.type,s.type)&&!e.legacyConfig.isTypeConversionExempted("filterArg",n.type.kind,s.type.kind,`${t.name}.${this.name}.${i.left}`))throw new u.default((0,c.oneLine)`
                Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                LHS is a '${s.type.kind}' but RHS is a '${n.type.kind}'`)}else if(null!==i.right)switch(s.type.kind){case"int":case"float":if("number"!=typeof i.right)throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a number but RHS is a '${typeof i.right}'`);break;case"string":case"bigint":case"uuid":if("string"!=typeof i.right)throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a string but RHS is a '${typeof i.right}'`);break;case"enum":if("string"!=typeof i.right)throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a string but RHS is a '${typeof i.right}'`);let r=e.enumDef(s.type);if(!r.isValidValue(i.right))throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to invalid enum value '${i.right}'.
                      Expecting one of ${r.values.join(", ")}`);break;case"bool":if("boolean"!=typeof i.right)throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a boolean but RHS is a '${typeof i.right}'`);break;case"datetime":case"date":if(!(i.right instanceof Date))throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a date but RHS is a '${typeof i.right}'`);break;default:throw new u.default((0,c.oneLine)`
                    Filter on field '${i.left}' in object type '${t.name}' has unexpected type ${s.type.kind}`)}else if([">","<",">=","<="].indexOf(i.op)>-1)throw new u.default((0,c.oneLine)`
                  Cannot filter on field '${i.left}' in object type '${t.name}'. '${i.op}' filter
                  on type '${s.type.kind}' is not is not supported for null values.`);break;case"in":if(["list","map","object","objects","date","datetime"].indexOf((s=N(i)).type.kind)>-1)throw new u.default((0,c.oneLine)`
              Cannot filter on field '${i.left}' in object type '${t.name}'. Filter on type
              ${s.type.kind} is not supported.`);if((0,a.isArgumentRef)(i.right)){if("list"!==(n=k(i)).type.kind)throw new u.default((0,c.oneLine)`
                Cannot filter on field '${i.left}' in object type '${t.name}' because
                argument ${i.right.ref} has invalid type ${n.type.kind}`);if(!(0,h.compatibleTypes)(n.type.ofType,s.type))throw new u.default((0,c.oneLine)`
                Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                LHS is a '${s.type.kind}' but RHS is a list of '${n.type.ofType.kind}'`)}else if(i.right.length>0)switch(s.type.kind){case"int":case"float":if("number"!=typeof i.right[0])throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a number but RHS is a list of ${typeof i.right[0]}`);break;case"string":if("string"!=typeof i.right[0])throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a string but RHS is a list of ${typeof i.right[0]}`);break;case"enum":if("string"!=typeof i.right[0])throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a string but RHS is a list of ${typeof i.right[0]}`);let o=e.enumDef(s.type);for(let e of i.right)if(!o.isValidValue(e))throw new u.default((0,c.oneLine)`
                        Cannot filter on field '${i.left}' in object type '${t.name}' due to invalid enum value '${e}'.
                        Expecting one of ${o.values.join(", ")}`);break;case"bool":if("boolean"!=typeof i.right[0])throw new u.default((0,c.oneLine)`
                      Cannot filter on field '${i.left}' in object type '${t.name}' due to inconsistent type.
                      LHS is a boolean but RHS is a list of ${typeof i.right[0]}`);break;default:throw new u.default((0,c.oneLine)`
                    Filter on field '${i.left}' in object type '${t.name}' has unexpected type ${s.type.kind}`)}break;case"or":case"and":i.expressions.map(e=>M(e))}};for(let e in M(this.filter),this.resolver&&!((null===(i=this.resolver.queryParams)||void 0===i?void 0:i.userId)&&(0,a.isArgumentRef)(this.resolver.queryParams.userId))&&this.throwFieldError(t,`uses resolver and it doesn't define userId in its queryParams attribute.
      This is required. Please choose one of the following options and add to queryParams:
      1. If current userId comes from viewArgs, e.g. session('userId'):
         queryParams: { userId: fieldArg('userId') }
         and add an field arg to ${this.name} object field. When using it in views, fill the arg with session('userId').
      2. If current userId can come from parent object:
         queryParams: { userId: parent('the_user_id_field_name') }
      `),(null===(s=this.resolver)||void 0===s?void 0:s.queryParams)||{}){let i=null===(n=this.resolver)||void 0===n?void 0:n.queryParams[e];i&&(0,a.isArgumentRef)(i)&&("field"===i.type&&((0,a.argumentDefByName)(this.args,i.ref)||this.throwFieldError(t,`uses argument ${i.ref}' in its resolver config but does not declare it`),j.add(i.ref)),"parent"!==i.type||t.fields.get(i.ref)||this.throwFieldError(t,`refers to unknown parent field '${i.ref}' in its resolver config`))}if((null===(r=this.resolver)||void 0===r?void 0:r.realtimePolicy.type)==="RedisPubsub")for(let e of(null===(o=this.resolver)||void 0===o?void 0:o.realtimePolicy.channelPostfix)||[])(0,a.isArgumentRef)(e)&&("field"===e.type&&((0,a.argumentDefByName)(this.args,e.ref)||this.throwFieldError(t,`uses argument '${e.ref}' in its resolver config but does not declare it`),j.add(e.ref)),"parent"!==e.type||t.fields.get(e.ref)||this.throwFieldError(t,`refers to unknown parent field '${e.ref}' in its resolver config`));if((null===(l=this.pagination)||void 0===l?void 0:l.firstPageSize)&&(0,a.isArgumentRef)(null===(d=this.pagination)||void 0===d?void 0:d.firstPageSize)){let e=(0,a.argumentDefByName)(this.args,null===(p=this.pagination)||void 0===p?void 0:p.firstPageSize.ref);e||this.throwFieldError(t,`uses argument '${null===(g=this.pagination)||void 0===g?void 0:g.firstPageSize.ref}' in its pagination config but does not declare it`),"int"!==e.type.kind&&this.throwFieldError(t,`uses argument '${null===(y=this.pagination)||void 0===y?void 0:y.firstPageSize.ref}' in its pagination config but it's not int type. It's ${e.type.kind}`),j.add(null===(m=this.pagination)||void 0===m?void 0:m.firstPageSize.ref)}if((null===(b=this.pagination)||void 0===b?void 0:b.selectedCursorColumn)&&(0,a.isArgumentRef)(null===(v=this.pagination)||void 0===v?void 0:v.selectedCursorColumn)){let e=(0,a.argumentDefByName)(this.args,null===(w=this.pagination)||void 0===w?void 0:w.selectedCursorColumn.ref);e||this.throwFieldError(t,`uses argument '${null===(S=this.pagination)||void 0===S?void 0:S.selectedCursorColumn.ref}' in its pagination cursor column config but does not declare it`),"string"!==e.type.kind&&this.throwFieldError(t,`uses argument '${null===(I=this.pagination)||void 0===I?void 0:I.selectedCursorColumn.ref}' in its pagination cursor column config but it's not string type. It's ${e.type.kind}`),j.add(null===(O=this.pagination)||void 0===O?void 0:O.selectedCursorColumn.ref)}if((null===(_=this.pagination)||void 0===_?void 0:_.sortOrder)&&(0,a.isArgumentRef)(null===(D=this.pagination)||void 0===D?void 0:D.sortOrder)){let e=(0,a.argumentDefByName)(this.args,null===(E=this.pagination)||void 0===E?void 0:E.sortOrder.ref);e||this.throwFieldError(t,`uses argument '${null===(C=this.pagination)||void 0===C?void 0:C.sortOrder.ref}' in its pagination sort order config but does not declare it`),"string"!==e.type.kind&&this.throwFieldError(t,`uses argument '${null===(R=this.pagination)||void 0===R?void 0:R.sortOrder.ref}' in its pagination sort order config but it's not string type. It's ${e.type.kind}`),j.add(null===(F=this.pagination)||void 0===F?void 0:F.sortOrder.ref)}for(let e of this.args)if(!j.has(e.name)){if("initialPageSize"===e.name)continue;this.throwFieldError(t,`declares argument '${e.name}' but does not use it`)}}throwFilterError(e,t){throw new u.default(`filter condition of '${this.name}' of type '${this.type.name}' on '${e.name}' ${t}`)}throwFieldError(e,t){throw new u.default(`field '${this.name}' of type '${this.type.name}' on '${e.name}' ${t}`)}isResolvable(e){return this.filter||this.resolver||this.embedded&&"root"!==e.name}},t.isObjectFieldDef=function(e){return"boolean"==typeof e.embedded}},497490:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=i(553841),r=i(922128),o=s(i(236452)),a=s(i(997994)),l=s(i(909026)),d=i(175585),u=s(i(356914)),h=s(i(719757));class c{isNullable(){return this.objectFieldDef.isNullable()}isList(){return this.objectFieldDef.isList()}get path(){return[...this.parent.path,this.objectFieldDef.name]}get name(){return this.objectDef.name}get missingOptionalFields(){var e;if(!(null===(e=this.metadata)||void 0===e?void 0:e.shouldUseMissingFields))throw Error("invalid missingOptionalFields access with shouldUseMissingFields=false, are you trying to call missingOptionalFields from the Livegraph client? The client should only inspect missing fields via a QueryObserver.");return Array.from(this._missingOptionalFields.values())}constructor({parent:e,objectDef:t,objectFieldDef:i,fieldArgs:s,fields:f,viewArgs:p,schema:g,metadata:y,optional:m,context:b,shapeOverride:v}){var w,S,I;for(let n of(this.queries=new Map,this.computations=new Map,this.projectedFields=new Map,this.transmittedFields=new Set,this.aliasMappings=new Map,this.optionalFields=new Set,this._missingOptionalFields=new Map,this.parent=e,this.objectDef=t,this.objectFieldDef=i,this.fieldArgs=s,this.optional=m,this.context=b,this.metadata=y,this.shape=null!=v?v:g.scopedQueryShape(this.parent.name,this.objectFieldDef.name),i.args))n.name in this.fieldArgs||(void 0!==n.defaultValue?this.fieldArgs=Object.assign(Object.assign({},this.fieldArgs),{[n.name]:n.defaultValue}):"initialPageSize"===n.name&&(this.fieldArgs=Object.assign(Object.assign({},this.fieldArgs),{initialPageSize:0})));if((null==y?void 0:y.shouldValidateDeprecated)&&this.objectDef.deprecated&&!this.objectDef.deprecated.skipValidation)throw new u.default(`Object ${this.objectDef.name} was deprecated on ${this.objectDef.deprecated.date} and cannot be used in views. Reason: ${this.objectDef.deprecated.reason}`);for(let e in(0,d.validateArgs)(this.path,this.fieldArgs,i.args,p,this.isComputedFieldDependency,g),f){let t,i=e,s=f[e],n=!1;s&&(0,r.isFieldDecorated)(s)&&(s.aliasedField&&(i=s.aliasedField,this.aliasMappings.set(i,e)),(n=!!s.optional)&&this.optionalFields.add(i),s=s.fields);let[m,b]=Array.isArray(s)?s:[{},s];try{t=this.objectDef.fieldDef(i)}catch(e){if(e instanceof u.default){if(n&&(null==y?void 0:y.shouldUseMissingFields)){this._missingOptionalFields.set(i,{fieldName:i,info:e.message}),this.transmittedFields.add(i);continue}throw e}}if(t){if((null==y?void 0:y.shouldValidateDeprecated)&&t.deprecated&&!t.deprecated.skipValidation)throw new u.default(`The field ${i} was deprecated on ${t.deprecated.date} and cannot be used in views. Reason: ${t.deprecated.reason}`);if(t instanceof o.default){if(b===r._)throw(0,d.pathError)(this.path,`expected nested fields for '${i}' but got '_'`);try{let e=this.isComputedFieldDependency&&"root"===this.name&&"root"===t.name;this.queries.set(i,new c({parent:this,objectDef:g.objectDef(t.type),objectFieldDef:t,fieldArgs:m,fields:b,viewArgs:p,schema:g,metadata:y,optional:n,shapeOverride:e?v:void 0}))}catch(e){if(n&&e instanceof u.default&&(null==y?void 0:y.shouldUseMissingFields)){this._missingOptionalFields.set(i,{fieldName:i,info:e.message}),this.transmittedFields.add(i);continue}throw e}for(let e of(t.embedded&&this.transmittedFields.add(i),t.filterFields))this.transmittedFields.add(e)}else if(t instanceof a.default){if(b!==r._)throw(0,d.pathError)(this.path,`cannot query field '${i}'`);this.computations.set(i,new l.default(this,t,m,p,g,this.path,n))}else{if(b!==r._)throw(0,d.pathError)(this.path,`cannot query field '${i}'`);this.projectedFields.set(i,new h.default(t,n)),this.transmittedFields.add(i)}}}"root"!==t.name&&this.transmittedFields.add("id");let{checkCanRead:O}=this.objectFieldDef;if(O){let e={};for(let t in O){if("fieldName"===t)continue;let i=O[t];(0,n.isArgumentRef)(i)&&this.fieldArgs[i.ref]?e[t]=this.fieldArgs[i.ref]:e[t]=i}let t="canRead";O.fieldName&&(t=O.fieldName.toString()),this.permissionComputation=new l.default(this,this.objectDef.fieldDef(t),e,p,g,this.path)}for(let e of this.objectFieldDef.dependentFields)this.transmittedFields.add(e);null===(I=null===(S=null===(w=this.context)||void 0===w?void 0:w.options)||void 0===S?void 0:S.logger)||void 0===I||I.debug("VIEW_QUERY_DEF.CREATE",this.debugFields)}get debugFields(){var e;return{parent:this.parent.name,queryReturnType:this.objectDef.name,field:this.objectFieldDef.name,optional:this.optional,queryFields:JSON.stringify(Array.from(this.queries.keys())),projectedBaseFields:JSON.stringify(Array.from(this.projectedFields.keys())),canonicalShapeID:null===(e=this.shape)||void 0===e?void 0:e.id}}dealias(e){return this.aliasMappings.get(e)||e}missingOptionalFieldsForEmbeddedInstance(e){let t=[];for(let i of this.optionalFields.values())void 0===e[i]&&t.push({fieldName:i,info:`optional field '${i}' was missing in instance of object '${this.objectDef.name}'`});return t}projectInstance(e){let t={};if(this.objectFieldDef.embedded)for(let i of this.projectedFields.keys())t[this.dealias(i)]=i in e?e[i]:null;else for(let i of this.projectedFields.keys())t[this.dealias(i)]=e[i];for(let e of this.projectedFields.keys())this.optionalFields.has(e)&&(t[this.dealias(e)]={status:n.OptionalStatus.Loaded,data:t[this.dealias(e)]});return t}projectResults(e){let t={},i=[...this.projectedFields.keys(),...this.computations.keys(),...this.queries.keys()];for(let s of i){let i=this.dealias(s);i in e?t[i]=e[i]:this.objectFieldDef.embedded&&(t[i]=null)}return t}getMissingProjectedFields(e){let t=[...this.projectedFields.keys(),...this.computations.keys(),...this.queries.keys()],i=[];for(let s of t){let t=this.dealias(s);void 0===e[t]&&i.push(t)}return i}get indexingHint(){if(void 0!==this._indexingHint)return this._indexingHint;if(!this.objectFieldDef.filter)return this._indexingHint=null,null;let e=(e,t)=>{let i=[e=>!!e&&"id"===e.field,e=>!!e&&"string"===this.objectDef.fieldDef(e.field).type.kind,e=>null!==e,e=>!0],s=i.findIndex(t=>t(e)),n=i.findIndex(e=>e(t));return s<=n?e:t},t=i=>"or"===i.type?null:"and"===i.type?i.expressions.map(t).reduce((t,i)=>e(t,i)):"in"===i.type?{field:i.left,values:i.right}:"="===i.op?{field:i.left,values:(0,n.isArgumentRef)(i.right)?i.right:[i.right]}:null;return this._indexingHint=t(this.objectFieldDef.filter)||null,this._indexingHint}get isComputedFieldDependency(){return this.parent.isComputedFieldDependency}}t.default=c},735831:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientViewRegistry=void 0;let n=s(i(625836));t.ClientViewRegistry=class{constructor(e,t){for(let i in this.views=new Map,e)this.views.set(i,new n.default(i,e[i],t.objects.get("root"),t,{shouldValidateDeprecated:!0,shouldUseMissingFields:!1}))}get(e){return this.views.get(e)||null}}},719757:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.def=e,this.optional=t}}},979319:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isScalarFieldDef=void 0;let n=s(i(356914)),r=i(846316),o=i(236452),a=i(997994);t.default=class{constructor(e){this.name=e.name,this.type=e.type,this.nullable=e.nullable||!1,this.deprecated=e.deprecated}validate(e,t){if("enum"===this.type.kind&&!e.enums.has(this.type.name))throw new n.default((0,r.oneLine)`
        field '${this.name}' of object type '${t.name}' refers to undefined
        enum type '${this.type.name}'`)}},t.isScalarFieldDef=function(e){return!(0,o.isObjectFieldDef)(e)&&!(0,a.isComputedFieldDef)(e)}},804348:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=s(i(584164)),r=s(i(773331)),o=s(i(345187)),a=s(i(356914)),l=s(i(434620));t.default=class{constructor(e,t){for(let i of(this.schema=e,this.queryShapeIdResolver=t,this.session=new o.default(e.session),this.legacyConfig=new l.default(e.legacyConfigDef),this.enums=new Map,e.enums||[]))this.enums.set(i.name,new n.default(i));for(let t of(this.objects=new Map,e.objects))this.objects.set(t.name,new r.default(t));for(let t of e.objects)this.objects.get(t.name).constructComputedFields(t,this);this.enums.forEach(e=>e.validate(this)),this.objects.forEach(e=>e.validate(this)),this.version=e.version||"0.0.0"}typeWithKind(e,t){let i=this[e].get(t);if(i)return i;throw new a.default(`${e} with name '${t}' isn't present in schema`)}enumDef({name:e}){return this.typeWithKind("enums",e)}objectDef({name:e}){return this.typeWithKind("objects",e)}scopedQueryShape(e,t){var i;return null===(i=this.queryShapeIdResolver)||void 0===i?void 0:i.shapeFromParent(e,t)}scopedQueryShapeFromRoot(e){var t;return null===(t=this.queryShapeIdResolver)||void 0===t?void 0:t.shapeFromRoot(e)}toJSON(){return this.schema}}},345187:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=i(846316),r=i(553841),o=i(822432),a=s(i(356914)),l=i(175585);t.default=class{constructor(e){this.args=e&&e.args||[{name:"userId",type:{kind:"string"},nullable:!0}],this.args.find(e=>"sessionId"===e.name)||this.args.push({name:"sessionId",type:{kind:"string"},nullable:!0}),(0,l.validateArgumentDefs)("Session definition ",this.args),this.validateUserIdArgument(this.args)}validateUserIdArgument(e){for(let t of e)if("userId"===t.name){if(!["string","bigint"].includes(t.type.kind))throw new a.default((0,n.oneLine)`
            Session definition error: 'userId' arg must be of type 'string' or 'bigint'
          `);return}throw new a.default((0,n.oneLine)`
      Session definition error: 'userId' arg of type 'string' or 'bigint' is required
    `)}parseAndValidateArguments(e,t){let i={userId:null,sessionId:""};for(let s in e){let l=(0,r.argumentDefByName)(this.args,s);if(l){let r=(0,o.parseAndValidateArg)(t,l,e[s]);if("error"===r.type)throw new a.default((0,n.oneLine)`
            Session argument error: '${r.argName}' '${r.msg}'`);i[s]=r.parsedValue}else throw new a.default((0,n.oneLine)`
          Session argument error: '${s}' is not a valid argument
          name`)}for(let t of this.args)if(!(t.name in e))throw new a.default((0,n.oneLine)`
          Session argument error: the argument '${t.name}' is missing`);return i}}},175585:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.compatibleTypes=t.validateArgumentDefs=t.validateArgs=t.pathError=void 0;let n=i(846316),r=s(i(356914)),o=i(553841),a=i(822432);function l(e,t){return new r.default(`${e.join(".")} - ${t}`)}function d(e,t){return"map"===e.kind&&"map"===t.kind?d(e.valueType,t.valueType):"list"===e.kind&&"list"===t.kind?d(e.ofType,t.ofType):"object"===e.kind&&"object"===t.kind||"objects"===e.kind&&"objects"===t.kind?e.name===t.name:e.kind===t.kind||"date"===e.kind&&"datetime"===t.kind||"bigint"===e.kind&&"string"===t.kind||"uuid"===e.kind&&"string"===t.kind}t.pathError=l,t.validateArgs=function(e,t,i,s,r,u){for(let h in t){let c=t[h],f=(0,o.argumentDefByName)(i,h);if(!f)throw l(e,(0,n.oneLine)`
        Found arg with name '${h}', but the field doesn't accept an
        arg with this name`);if((0,o.isArgumentRef)(c)){let t=(0,o.argumentDefByName)("session"===c.type?u.session.args:s,c.ref);if(!t)throw l(e,(0,n.oneLine)`
          Found arg with name '${c.ref}', but there isn't a declaration of
          an arg with this name`);if(t.nullable&&!f.nullable)throw l(e,(0,n.oneLine)`
          Query arg '${c.ref}' is nullable but used as a field argument that
          is not nullable`);if(!d(t.type,f.type)&&!u.legacyConfig.isTypeConversionExempted(r?"computedFieldArg":"viewArg",t.type.kind,f.type.kind,e.join(".")+"."+t.name))throw l(e,(0,n.oneLine)`
          Query arg '${t.name}' of type ${t.type.kind} is being
          used for field argument '${f.name}' of type
          ${f.type.kind}`)}else{let t=(0,a.parseAndValidateArg)(u,f,c);if("error"===t.type)throw l(e,`Arg '${t.argName}': ${t.msg}`)}}for(let{name:s}of i)if(void 0===t[s])throw l(e,`Argument '${s}' is required`)},t.validateArgumentDefs=function(e,t){let i=new Set;for(let{name:s}of t){if(i.has(s))throw new r.default((0,n.oneLine)`
        ${e} declares multiple arguments named '${s}'
      `);i.add(s)}},t.compatibleTypes=d},625836:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=i(553841),r=s(i(497490)),o=i(822432),a=s(i(236452)),l=s(i(356914)),d=i(175585),u=i(846316),h=i(284451);t.default=class{constructor(e,t,i,s,n,o,l){this.name=e,this.metadata=n,this.context=o,this.rootShapeOverride=l,this.annotations=t.annotations,this.dslDef=Object.freeze(JSON.parse(JSON.stringify(t))),this.fields=t.fields,this.root=new r.default({parent:this,objectDef:i,objectFieldDef:new a.default({name:e,type:{kind:"object",name:i.name}}),fieldArgs:{},fields:t.fields,viewArgs:t.args||[],schema:s,metadata:{shouldValidateDeprecated:!!(null==n?void 0:n.shouldValidateDeprecated),shouldUseMissingFields:!!(null==n?void 0:n.shouldUseMissingFields)},context:o,shapeOverride:l}),this.args=t.args||[],this.props=t.props,this.schema=s,(0,d.validateArgumentDefs)(`View '${e}'`,this.args)}get path(){var e;return this.isComputedFieldDependency?[null===(e=this.metadata)||void 0===e?void 0:e.computedObjectName]:[]}get isComputedFieldDependency(){var e;return!!(null===(e=this.metadata)||void 0===e?void 0:e.isComputedFieldDependency)}_parseAndValidateArguments(e,t){let i={};for(let s in e){if("__requestId"===s){i[s]=e[s];continue}let r=e[s],a=(0,n.argumentDefByName)(this.args,s);if(!a)return(0,h.err)(new l.default((0,u.oneLine)`
View '${this.name}': argument error: '${s}' is not a valid argument
`));{let e=(0,o.parseAndValidateArg)(this.schema,a,r,t);if("error"===e.type)return(0,h.err)(new l.default((0,u.oneLine)`
View '${this.name}': argument error: '${e.argName}' '${e.msg}'`));i[s]=e.parsedValue}}for(let{name:t}of this.args)if(void 0===e[t])return(0,h.err)(new l.default(`View '${this.name}': Missing argument '${t}'`));return(0,h.ok)(i)}parseAndValidateArguments(e){return this._parseAndValidateArguments(e,!0)}validateArguments(e){let t=this._parseAndValidateArguments(e,!1);return"ok"===t.type?(0,h.ok)(void 0):(0,h.err)(t.error)}hasStaticQueries(){var e;let t=[this.root];for(;t.length;){let i=t.pop();if((null===(e=i.objectFieldDef.resolver)||void 0===e?void 0:e.realtimePolicy.type)==="Static")return!0;for(let e of i.queries.values()||[])t.push(e)}return!1}}},553841:(e,t)=>{var i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalStatus=t.ViewSubscriptionError=t.OutdatedSchemaError=t.AuthError=t.argumentsEqual=t.argumentDefByName=t.ViewPriority=t.isArgumentRef=void 0,t.isArgumentRef=function(e){return null!==e&&"object"==typeof e&&"type"in e},function(e){e.P0="p0",e.P1="p1",e.P2="p2",e.P3="p3"}(i||(t.ViewPriority=i={})),t.argumentDefByName=function(e,t){if(e){for(let i of e)if(i.name===t)return i}return null},t.argumentsEqual=function(e,t){for(let i in e){let s=e[i],n=t[i];if(void 0===s){if(void 0!==n)return!1}else if(s instanceof Array){if(!(n instanceof Array)||!function(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(s,n))return!1}else if(s!==n)return!1}return Object.keys(e).length===Object.keys(t).length},t.AuthError=class extends Error{},t.OutdatedSchemaError=class extends Error{},t.ViewSubscriptionError=class extends Error{constructor(e){super(),this.errorCode=e}},function(e){e.Error="error",e.Loaded="loaded"}(s||(t.OptionalStatus=s={}))},598295:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(n,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.unwrap=t.safeError=t.serializeError=t.plain=t.retryWithExponentialBackoff=t.ExponentialBackoff=t.RetriesExhaustedError=t.logIfItTakesTooLong=t.setTimeoutCaptureStackTrace=t.sleep=t.once=t.noop=t.missingFieldsEqual=t.projectedInstancesEqual=t.jsonBlobsEqual=t.union=t.assertNever=t.assertNotNullish=t.assert=t.assertWithoutCrashingOnClient=t.promiseResolveReject=t.isEmpty=void 0;let n=i(553841);function r(e,t){if(!e){let e=Error(t);setTimeout(()=>{throw e})}}function o(e){return new Promise(t=>setTimeout(t,e))}t.isEmpty=function(e){for(let t in e)if(e.hasOwnProperty(t))return!1;return!0},t.promiseResolveReject=function(){let e,t;let i=new Promise((i,s)=>{e=i,t=s});return[i,e,t]},t.assertWithoutCrashingOnClient=r,t.assert=function(e,t){if(!e)throw Error(t||"assertion failure")},t.assertNotNullish=function(e,t){if(null==e)throw Error(t||"assertion failure")},t.assertNever=function(e){},t.union=function(...e){let t=new Set;for(let i of e)for(let e of i)t.add(e);return t},t.jsonBlobsEqual=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return r(!1,"Comparison of embedded objects failed"),!1}},t.projectedInstancesEqual=function(e,t,i){var s,n;for(let r of i){let i=r[0];if("datetime"===r[1].def.type.kind){if((null===(s=e[i])||void 0===s?void 0:s.getTime())!==(null===(n=t[i])||void 0===n?void 0:n.getTime()))return!1}else if(e[i]!==t[i])return!1}return!0},t.missingFieldsEqual=function(e,t){if(e.length!==t.length)return!1;let i=!0;return e.forEach(e=>{t.find(t=>t.fieldName===e.fieldName&&t.info===e.info)||(i=!1)}),i},t.noop=function(){},t.once=function(e){let t=!1;return function(){t||(t=!0,e())}},t.sleep=o,t.setTimeoutCaptureStackTrace=function(e,t){let i=Error();setTimeout(()=>{try{e()}catch(e){throw e.cause=i,e}},t)},t.logIfItTakesTooLong=function(e,t,i){let s=Symbol("timeout");return Promise.race([e.catch(()=>{}),o(i).then(()=>s)]).then(e=>{e===s&&t()}),e};class a extends Error{}t.RetriesExhaustedError=a;class l{constructor(e){this.config=e,l.validateConfig(e),this.timeoutMs=e.backoffInitialMs*(1+this.jitter()),this.count=0}nextBackoffMs(){if(!this.shouldAttempt())throw new a("Max attempt exhausted");let e=this.timeoutMs;return this.timeoutMs*=this.config.backoffMultiplier+this.jitter(),this.timeoutMs=Math.min(this.timeoutMs,this.config.backoffMaxMs),this.count+=1,e}shouldAttempt(){return void 0===this.config.maxAttempt||this.config.maxAttempt>this.count}reset(){this.timeoutMs=this.config.backoffInitialMs,this.count=0}attemptsSoFar(){return this.count}jitter(){return(Math.random()-.5)*this.config.spreadMultiplier}static validateConfig(e){if(e.backoffInitialMs<=0)throw Error("backoffInitialMs must be > 0");if(e.backoffMaxMs<=0)throw Error("backoffMaxMs must be > 0");if(e.backoffMultiplier<1)throw Error("backoffMultiplier must be >= 1");if(e.spreadMultiplier<0||e.spreadMultiplier>=2)throw Error("To ensure positive initial timeout, spreadMultiplier must be between 0 (inclusive) and 2 (exclusive)");if(e.backoffMultiplier-.5*e.spreadMultiplier<1)throw Error("To ensure positive and non-shrinking exponential timeout, increase backoffMultiplier or decrease spreadMultiplier such that (backoffMultiplier - 0.5 * spreadMultiplier) >= 1")}}t.ExponentialBackoff=l,t.retryWithExponentialBackoff=(e,t,i)=>s(void 0,void 0,void 0,function*(){let s;let{onRetry:n}=i,r=new l(t);for(;r.shouldAttempt();)try{return yield e()}catch(e){s=e,null==n||n(e),yield o(r.nextBackoffMs())}throw s}),t.plain=function(e){return JSON.parse(JSON.stringify(e))},t.serializeError=function(e,t){return t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t},t.safeError=function(e){return e instanceof Error?e:Error(String(e))},t.unwrap=function(e,t){return e.status===n.OptionalStatus.Error?t:e.data}},284451:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.err=t.ok=void 0,t.ok=e=>({type:"ok",value:e,unwrap:()=>e,unwrapErr(){throw Error(`Expected Err, found Ok(${e})`)}}),t.err=e=>({type:"err",error:e,unwrap(){if(e instanceof Error)throw e;throw Error(`Expected Ok, found Err(${e})`)},unwrapErr:()=>e})},50630:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stableStringify=void 0,t.stableStringify=function(e){let t=[],i=e=>{if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0===e)return;if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(let s=0;s<e.length;s++)s&&(t+=","),t+=i(e[s])||"null";return t+"]"}if(null===e)return"null";if(-1!==t.indexOf(e))throw TypeError("Converting circular structure to JSON");let s=t.push(e)-1,n=Object.keys(e).sort(),r="";for(let t of n){let s=i(e[t]);s&&(r&&(r+=","),r+=JSON.stringify(t)+":"+s)}return t.splice(s,1),"{"+r+"}"};return i(e)}},356914:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}}}]);

//# debugId=2c2371d7-7c61-5662-81ef-e1f02ddaff26

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/e743285f5e49c2f34cc7c998224de4fd057ed119/livegraph-9adc6eb480324b87.min.js.map